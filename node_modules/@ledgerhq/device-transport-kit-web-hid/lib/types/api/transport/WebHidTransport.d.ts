import { type ApduReceiverServiceFactory, type ApduSenderServiceFactory, type ConnectError, DeviceConnectionStateMachine, type DeviceConnectionStateMachineParams, type DeviceId, type DeviceModelDataSource, type DisconnectHandler, type DmkError, type LoggerPublisherService, type Transport, TransportConnectedDevice, type TransportDiscoveredDevice, type TransportFactory, type TransportIdentifier } from "@ledgerhq/device-management-kit";
import { type Either } from "purify-ts";
import { type Observable } from "rxjs";
import { WebHidApduSender, type WebHidApduSenderConstructorArgs, type WebHidApduSenderDependencies } from "./WebHidApduSender";
export declare const webHidIdentifier: TransportIdentifier;
export declare class WebHidTransport implements Transport {
    private readonly _deviceModelDataSource;
    private readonly _loggerServiceFactory;
    private readonly _apduSenderFactory;
    private readonly _apduReceiverFactory;
    private readonly _deviceConnectionStateMachineFactory;
    private readonly _deviceApduSenderFactory;
    /** List of HID devices that have been discovered */
    private _transportDiscoveredDevices;
    /** Map of *connected* HIDDevice to their device connection */
    private _deviceConnectionsByHidDevice;
    /**
     * Set of device connections for which the HIDDevice has been
     * disconnected, so they are waiting for a reconnection
     */
    private _deviceConnectionsPendingReconnection;
    /** AbortController to stop listening to HID connection events */
    private _connectionListenersAbortController;
    private _logger;
    private readonly connectionType;
    private readonly identifier;
    constructor(_deviceModelDataSource: DeviceModelDataSource, _loggerServiceFactory: (tag: string) => LoggerPublisherService, _apduSenderFactory: ApduSenderServiceFactory, _apduReceiverFactory: ApduReceiverServiceFactory, _deviceConnectionStateMachineFactory?: (args: DeviceConnectionStateMachineParams<WebHidApduSenderDependencies>) => DeviceConnectionStateMachine<WebHidApduSenderDependencies>, _deviceApduSenderFactory?: (args: WebHidApduSenderConstructorArgs, loggerFactory: (tag: string) => LoggerPublisherService) => WebHidApduSender);
    /**
     * Get the WebHID API if supported or error
     * @returns `Either<WebHidTransportNotSupportedError, HID>`
     */
    private get hidApi();
    isSupported(): boolean;
    getIdentifier(): TransportIdentifier;
    /**
     * Wrapper around `navigator.hid.getDevices()`.
     * It will return the list of plugged in HID devices to which the user has
     * previously granted access through `navigator.hid.requestDevice()`.
     */
    private getDevices;
    /**
     * Map a HIDDevice to an TransportDiscoveredDevice, either by creating a new one or returning an existing one
     */
    private mapHIDDeviceToTransportDiscoveredDevice;
    /**
     * Listen to known devices (devices to which the user has granted access)
     */
    listenToAvailableDevices(): Observable<TransportDiscoveredDevice[]>;
    private updateTransportDiscoveredDevices;
    /**
     * Wrapper around navigator.hid.requestDevice()
     * In a browser, it will show a native dialog to select a HID device.
     */
    private promptDeviceAccess;
    startDiscovering(): Observable<TransportDiscoveredDevice>;
    stopDiscovering(): void;
    private startListeningToConnectionEvents;
    private stopListeningToConnectionEvents;
    /**
     * Connect to a HID USB device and update the internal state of the associated device
     */
    connect({ deviceId, onDisconnect, }: {
        deviceId: DeviceId;
        onDisconnect: DisconnectHandler;
    }): Promise<Either<ConnectError, TransportConnectedDevice>>;
    private getDeviceModel;
    private getHidUsbProductId;
    /**
     * Disconnect from a HID USB device
     */
    disconnect(params: {
        connectedDevice: TransportConnectedDevice;
    }): Promise<Either<DmkError, void>>;
    /**
     * Type guard to check if the event is a HID connection event
     * @param event
     * @private
     */
    private isHIDConnectionEvent;
    /**
     * Handle the disconnection event of a HID device
     * @param event
     */
    private handleDeviceDisconnectionEvent;
    private handleDeviceReconnection;
    /**
     * Handle the connection event of a HID device
     * @param event
     */
    private handleDeviceConnectionEvent;
    destroy(): void;
}
export declare const webHidTransportFactory: TransportFactory;
//# sourceMappingURL=WebHidTransport.d.ts.map