import{Maybe as m}from"purify-ts";import{StaticDeviceModelDataSource as y}from"../../../api/device-model/data/StaticDeviceModelDataSource";import{defaultApduReceiverServiceStubBuilder as h}from"../../../api/device-session/service/DefaultApduReceiverService.stub";import{defaultApduSenderServiceStubBuilder as S}from"../../../api/device-session/service/DefaultApduSenderService.stub";import{TransportMock as f}from"../../../api/transport/model/__mocks__/TransportMock";import{NoTransportProvidedError as T,TransportAlreadyExistsError as v}from"../../../api/transport/model/Errors";import{DefaultLoggerPublisherService as b}from"../../logger-publisher/service/DefaultLoggerPublisherService";import{DefaultTransportService as c}from"./DefaultTransportService";let t,o,u,n,a,p,l,d,s,r,i;describe("TransportService",()=>{beforeEach(()=>{u=new b([],"transport-service"),t=vi.fn().mockImplementation(()=>S(void 0,()=>u)),o=vi.fn().mockImplementation(()=>h(void 0,()=>u)),s=new y,n={},p=new f,d=new f,vi.spyOn(p,"getIdentifier").mockReturnValue("transport"),vi.spyOn(d,"getIdentifier").mockReturnValue("transport2"),a=vi.fn().mockImplementation(()=>p),l=vi.fn().mockImplementation(()=>d),i=vi.fn().mockImplementation(()=>u)}),afterEach(()=>{vi.resetAllMocks()}),describe("constructor",()=>{describe("when no transports are provided",()=>{let e;beforeEach(()=>{e=vi.spyOn(u,"warn")}),it("should throw an error",()=>{try{r=new c([],n,i,s,t,o)}catch(g){expect(e).toHaveBeenCalledWith("No transports provided, please check your configuration"),expect(g).toBeInstanceOf(T)}})}),describe("when transports are provided",()=>{it("should add 1 transport",()=>{r=new c([a],n,i,s,t,o),expect(r.getAllTransports()).toEqual([p])}),it("should add multiple transports",()=>{r=new c([a,l],n,i,s,t,o);const e=r.getAllTransports();expect(e).toEqual([p,d])}),it("should not add duplicate transports",()=>{try{new c([a,a],n,i,s,t,o)}catch(e){expect(e).toBeInstanceOf(v)}})})}),describe("addTransport",()=>{beforeEach(()=>{r=new c([a],n,i,s,t,o)}),it("can add a new transport",()=>{r.addTransport(l);const e=r.getAllTransports();expect(e).toEqual([p,d])}),it("calls the transport factory function with the correct arguments",()=>{r.addTransport(l),expect(l).toHaveBeenCalledWith({loggerServiceFactory:i,config:n,apduSenderServiceFactory:t,apduReceiverServiceFactory:o,deviceModelDataSource:s})}),it("throw if transport already exists",()=>{try{r.addTransport(a)}catch(e){expect(e).toBeInstanceOf(v)}})}),describe("getTransport",()=>{beforeEach(()=>{r=new c([a],n,i,s,t,o)}),it("returns the transport",()=>{const e=r.getTransport("transport");expect(e).toEqual(m.of(p))}),it("returns Nothing if the transport identifier does not exist",()=>{const e=r.getTransport("transport2");expect(e).toEqual(m.empty())})}),describe("getAllTransports",()=>{it("returns all transports (1 transport)",()=>{r=new c([a],n,i,s,t,o);const e=r.getAllTransports();expect(e).toEqual([p])}),it("returns all transports (2 transports)",()=>{r=new c([a,l],n,i,s,t,o);const e=r.getAllTransports();expect(e).toEqual([p,d])})})});
//# sourceMappingURL=DefaultTransportService.test.js.map
