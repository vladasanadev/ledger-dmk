var m=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var g=(n,r,e,t)=>{for(var o=t>1?void 0:t?u(r,e):r,s=n.length-1,p;s>=0;s--)(p=n[s])&&(o=(t?p(r,e,o):p(o))||o);return t&&o&&m(r,e,o),o},i=(n,r)=>(e,t)=>r(e,t,n);import{inject as a,injectable as f}from"inversify";import{Left as h,Maybe as T,Right as S}from"purify-ts";import{NoTransportProvidedError as F,TransportAlreadyExistsError as _}from"../../../api/transport/model/Errors";import{deviceModelTypes as M}from"../../device-model/di/deviceModelTypes";import{deviceSessionTypes as v}from"../../device-session/di/deviceSessionTypes";import{loggerTypes as A}from"../../logger-publisher/di/loggerTypes";import{transportDiTypes as y}from"../../transport/di/transportDiTypes";let c=class{constructor(r,e,t,o,s,p){this._config=e;this._loggerModuleFactory=t;this._deviceModelDataSource=o;this._apduSenderServiceFactory=s;this._apduReceiverServiceFactory=p;if(this._logger=t("TransportService"),r.length===0)throw this._logger.warn("No transports provided, please check your configuration"),new F("No transports provided, please check your configuration");for(const l of r){const d=this.addTransport(l);if(d.isLeft())throw d.extract()}}_transports=new Map;_logger;addTransport(r){const e=r({deviceModelDataSource:this._deviceModelDataSource,loggerServiceFactory:this._loggerModuleFactory,config:this._config,apduSenderServiceFactory:this._apduSenderServiceFactory,apduReceiverServiceFactory:this._apduReceiverServiceFactory});return this.addTransportInternal(e)}addTransportInternal(r){return this.getTransport(r.getIdentifier()).isJust()?(this._logger.warn(`Transport ${r.getIdentifier()} already exists, please check your configuration`),h(new _(`Transport ${r.getIdentifier()} already exists, please check your configuration`))):(this._transports.set(r.getIdentifier(),r),S(void 0))}getTransport(r){return T.fromNullable(this._transports.get(r))}getAllTransports(){return Array.from(this._transports.values())}closeConnection(r){this.getTransport(r.transport).map(t=>t.disconnect({connectedDevice:r}))}};c=g([f(),i(0,a(y.TransportsInput)),i(1,a(y.DmkConfig)),i(2,a(A.LoggerPublisherServiceFactory)),i(3,a(M.DeviceModelDataSource)),i(4,a(v.ApduSenderServiceFactory)),i(5,a(v.ApduReceiverServiceFactory))],c);export{c as DefaultTransportService};
//# sourceMappingURL=DefaultTransportService.js.map
