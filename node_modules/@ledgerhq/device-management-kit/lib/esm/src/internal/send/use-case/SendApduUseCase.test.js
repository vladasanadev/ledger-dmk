import{Left as l}from"purify-ts";import{connectedDeviceStubBuilder as v}from"../../../api/transport/model/TransportConnectedDevice.stub";import{DEVICE_SESSION_REFRESHER_DEFAULT_OPTIONS as u}from"../../device-session/data/DeviceSessionRefresherConst";import{deviceSessionStubBuilder as p}from"../../device-session/model/DeviceSession.stub";import{DeviceSessionNotFound as D,ReceiverApduError as S}from"../../device-session/model/Errors";import{DefaultDeviceSessionService as g}from"../../device-session/service/DefaultDeviceSessionService";import{DefaultLoggerPublisherService as x}from"../../logger-publisher/service/DefaultLoggerPublisherService";import{AxiosManagerApiDataSource as A}from"../../manager-api/data/AxiosManagerApiDataSource";import{DefaultManagerApiService as C}from"../../manager-api/service/DefaultManagerApiService";import{DefaultSecureChannelDataSource as h}from"../../secure-channel/data/DefaultSecureChannelDataSource";import{DefaultSecureChannelService as w}from"../../secure-channel/service/DefaultSecureChannelService";import{SendApduUseCase as i}from"../../send/use-case/SendApduUseCase";vi.mock("@internal/manager-api/data/AxiosManagerApiDataSource");let e,o,m,s,d,a;const t="fakeSessionId";describe("SendApduUseCase",()=>{beforeEach(()=>{e=new x([],"send-apdu-use-case"),o=new g(()=>e),m=new A({}),s=new C(m),d=new h({}),a=new w(d)}),it("should send an APDU to a connected device",async()=>{const r=p({},()=>e,s,a,u);o.addDeviceSession(r);const c=await new i(o,()=>e).execute({sessionId:t,apdu:new Uint8Array([0,1,2,3])});r.close(),expect(r.connectedDevice.sendApdu).toHaveBeenCalledTimes(1),expect(c).toBeDefined()}),it("should throw an error if the deviceSession is not found",async()=>{const n=new i(o,()=>e).execute({sessionId:t,apdu:new Uint8Array([0,1,2,3])});await expect(n).rejects.toBeInstanceOf(D)}),it("should throw an error if the apdu receiver failed",async()=>{const r=v({sendApdu:vi.fn(async()=>Promise.resolve(l(new S)))}),n=p({connectedDevice:r},()=>e,s,a,u);o.addDeviceSession(n);const f=new i(o,()=>e).execute({sessionId:t,apdu:new Uint8Array([0,1,2,3])});n.close(),await expect(f).rejects.toBeInstanceOf(S)})});
//# sourceMappingURL=SendApduUseCase.test.js.map
