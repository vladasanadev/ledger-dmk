{
  "version": 3,
  "sources": ["../../../../../../src/internal/secure-channel/data/DefaultSecureChannelDataSource.ts"],
  "sourcesContent": ["import { inject, injectable } from \"inversify\";\nimport WebSocket from \"isomorphic-ws\";\nimport { Either, Left, Right } from \"purify-ts\";\nimport URL from \"url\";\n\nimport { type DmkConfig } from \"@api/DmkConfig\";\nimport { secureChannelTypes } from \"@internal/secure-channel/di/secureChannelTypes\";\nimport { WebSocketConnectionError } from \"@internal/secure-channel/model/Errors\";\nimport {\n  GenuineCheckParams,\n  InstallAppsParams,\n  ListInstalledAppsParams,\n  UninstallAppsParams,\n  UpdateFirmwareParams,\n  UpdateMcuParams,\n} from \"@internal/secure-channel/model/Params\";\n\nimport { SecureChannelDataSource } from \"./SecureChannelDataSource\";\n\n@injectable()\nexport class DefaultSecureChannelDataSource implements SecureChannelDataSource {\n  private readonly webSocketBaseUrl: string;\n\n  constructor(\n    @inject(secureChannelTypes.DmkConfig)\n    { webSocketUrl }: DmkConfig,\n  ) {\n    this.webSocketBaseUrl = webSocketUrl;\n  }\n\n  genuineCheck(\n    params: GenuineCheckParams,\n  ): Either<WebSocketConnectionError, WebSocket> {\n    const address = URL.format({\n      pathname: `${this.webSocketBaseUrl}/genuine`,\n      query: params,\n    });\n    return this._connectWebSocket(address);\n  }\n\n  installApp(\n    params: InstallAppsParams,\n  ): Either<WebSocketConnectionError, WebSocket> {\n    const address = URL.format({\n      pathname: `${this.webSocketBaseUrl}/install`,\n      query: params,\n    });\n    return this._connectWebSocket(address);\n  }\n\n  listInstalledApps(\n    params: ListInstalledAppsParams,\n  ): Either<WebSocketConnectionError, WebSocket> {\n    const address = URL.format({\n      pathname: `${this.webSocketBaseUrl}/apps/list`,\n      query: params,\n    });\n    return this._connectWebSocket(address);\n  }\n\n  uninstallApp(\n    params: UninstallAppsParams,\n  ): Either<WebSocketConnectionError, WebSocket> {\n    const address = URL.format({\n      pathname: `${this.webSocketBaseUrl}/install`,\n      query: params,\n    });\n    return this._connectWebSocket(address);\n  }\n\n  updateFirmware(\n    params: UpdateFirmwareParams,\n  ): Either<WebSocketConnectionError, WebSocket> {\n    const address = URL.format({\n      pathname: `${this.webSocketBaseUrl}/install`,\n      query: params,\n    });\n    return this._connectWebSocket(address);\n  }\n\n  updateMcu(\n    params: UpdateMcuParams,\n  ): Either<WebSocketConnectionError, WebSocket> {\n    const address = URL.format({\n      pathname: `${this.webSocketBaseUrl}/mcu`,\n      query: params,\n    });\n    return this._connectWebSocket(address);\n  }\n\n  _connectWebSocket(\n    address: string,\n  ): Either<WebSocketConnectionError, WebSocket> {\n    try {\n      return Right(new WebSocket(address));\n    } catch (error) {\n      return Left(new WebSocketConnectionError(error));\n    }\n  }\n}\n"],
  "mappings": "iOAAA,OAAS,UAAAA,EAAQ,cAAAC,MAAkB,YACnC,OAAOC,MAAe,gBACtB,OAAiB,QAAAC,EAAM,SAAAC,MAAa,YACpC,OAAOC,MAAS,MAGhB,OAAS,sBAAAC,MAA0B,iDACnC,OAAS,4BAAAC,MAAgC,wCAalC,IAAMC,EAAN,KAAwE,CAC5D,iBAEjB,YAEE,CAAE,aAAAC,CAAa,EACf,CACA,KAAK,iBAAmBA,CAC1B,CAEA,aACEC,EAC6C,CAC7C,MAAMC,EAAUC,EAAI,OAAO,CACzB,SAAU,GAAG,KAAK,gBAAgB,WAClC,MAAOF,CACT,CAAC,EACD,OAAO,KAAK,kBAAkBC,CAAO,CACvC,CAEA,WACED,EAC6C,CAC7C,MAAMC,EAAUC,EAAI,OAAO,CACzB,SAAU,GAAG,KAAK,gBAAgB,WAClC,MAAOF,CACT,CAAC,EACD,OAAO,KAAK,kBAAkBC,CAAO,CACvC,CAEA,kBACED,EAC6C,CAC7C,MAAMC,EAAUC,EAAI,OAAO,CACzB,SAAU,GAAG,KAAK,gBAAgB,aAClC,MAAOF,CACT,CAAC,EACD,OAAO,KAAK,kBAAkBC,CAAO,CACvC,CAEA,aACED,EAC6C,CAC7C,MAAMC,EAAUC,EAAI,OAAO,CACzB,SAAU,GAAG,KAAK,gBAAgB,WAClC,MAAOF,CACT,CAAC,EACD,OAAO,KAAK,kBAAkBC,CAAO,CACvC,CAEA,eACED,EAC6C,CAC7C,MAAMC,EAAUC,EAAI,OAAO,CACzB,SAAU,GAAG,KAAK,gBAAgB,WAClC,MAAOF,CACT,CAAC,EACD,OAAO,KAAK,kBAAkBC,CAAO,CACvC,CAEA,UACED,EAC6C,CAC7C,MAAMC,EAAUC,EAAI,OAAO,CACzB,SAAU,GAAG,KAAK,gBAAgB,OAClC,MAAOF,CACT,CAAC,EACD,OAAO,KAAK,kBAAkBC,CAAO,CACvC,CAEA,kBACEA,EAC6C,CAC7C,GAAI,CACF,OAAOE,EAAM,IAAIC,EAAUH,CAAO,CAAC,CACrC,OAASI,EAAO,CACd,OAAOC,EAAK,IAAIC,EAAyBF,CAAK,CAAC,CACjD,CACF,CACF,EA/EaP,EAANU,EAAA,CADNC,EAAW,EAKPC,EAAA,EAAAC,EAAOC,EAAmB,SAAS,IAJ3Bd",
  "names": ["inject", "injectable", "WebSocket", "Left", "Right", "URL", "secureChannelTypes", "WebSocketConnectionError", "DefaultSecureChannelDataSource", "webSocketUrl", "params", "address", "URL", "Right", "WebSocket", "error", "Left", "WebSocketConnectionError", "__decorateClass", "injectable", "__decorateParam", "inject", "secureChannelTypes"]
}
