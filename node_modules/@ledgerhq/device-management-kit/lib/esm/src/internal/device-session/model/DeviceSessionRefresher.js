import{timer as n}from"rxjs";import{DeviceModelId as c}from"../../../api/device/DeviceModel";import{DEVICE_SESSION_REFRESHER_MINIMUM_POLLING_INTERVAL as t,DEVICE_SESSION_REFRESHER_POLLING_INTERVAL as o}from"../../device-session/data/DeviceSessionRefresherConst";import{SessionEvents as h}from"../../device-session/model/DeviceSessionEventDispatcher";class d{constructor(i,s,e,r){this._sessionEventDispatcher=e;this._refresherOptions=s,this._logger=i("device-session-refresher"),this._connectedDeviceID=r.deviceModel.id}_refresherSubscription;_refresherOptions;_logger;_connectedDeviceID;startRefresher(){if(this._refresherOptions.isRefresherDisabled)return;const i=this.getValidPollingInterval(this._refresherOptions,this._logger)*2;this._refresherSubscription=n(0,i).subscribe(()=>{this._sessionEventDispatcher.dispatch({eventName:h.REFRESH_NEEDED})})}stopRefresher(){this._refresherSubscription&&(this._refresherSubscription.unsubscribe(),this._refresherSubscription=void 0,this._logger.info("Refresher stopped."))}restartRefresher(){this.stopRefresher(),this.startRefresher(),this._logger.info("Refresher restarted.")}destroy(){this.stopRefresher()}getValidPollingInterval=(i,s)=>{const{pollingInterval:e}=i;switch(this._connectedDeviceID){case c.NANO_S:{const r=o*2;return e!==void 0&&e<r?(s.warn(`Polling interval of ${e} is too low, setting to minimum as ${r}`),r):e??r}default:return e!==void 0&&e<t?(s.warn(`Polling interval of ${e} is too low, setting to minimum as ${t}`),t):e??o}}}export{d as DeviceSessionRefresher};
//# sourceMappingURL=DeviceSessionRefresher.js.map
