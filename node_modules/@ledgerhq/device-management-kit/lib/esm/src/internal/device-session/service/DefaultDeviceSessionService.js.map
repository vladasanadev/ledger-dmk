{
  "version": 3,
  "sources": ["../../../../../../src/internal/device-session/service/DefaultDeviceSessionService.ts"],
  "sourcesContent": ["import { inject, injectable } from \"inversify\";\nimport { Either, Maybe } from \"purify-ts\";\nimport { Observable, ReplaySubject } from \"rxjs\";\n\nimport { LoggerPublisherService } from \"@api/logger-publisher/service/LoggerPublisherService\";\nimport { DeviceId } from \"@api/types\";\nimport { DeviceSession } from \"@internal/device-session/model/DeviceSession\";\nimport { DeviceSessionNotFound } from \"@internal/device-session/model/Errors\";\nimport { DeviceSessionService } from \"@internal/device-session/service/DeviceSessionService\";\nimport { loggerTypes } from \"@internal/logger-publisher/di/loggerTypes\";\n\n@injectable()\nexport class DefaultDeviceSessionService implements DeviceSessionService {\n  private _sessions: DeviceSession[];\n  private readonly _sessionsSubject: ReplaySubject<DeviceSession>;\n  private readonly _logger: LoggerPublisherService;\n\n  constructor(\n    @inject(loggerTypes.LoggerPublisherServiceFactory)\n    loggerModuleFactory: (tag: string) => LoggerPublisherService,\n  ) {\n    this._sessions = [];\n    this._sessionsSubject = new ReplaySubject();\n    this._logger = loggerModuleFactory(\"DeviceSessionService\");\n  }\n\n  public get sessionsObs(): Observable<DeviceSession> {\n    return this._sessionsSubject.asObservable();\n  }\n\n  addDeviceSession(deviceSession: DeviceSession): DeviceSessionService {\n    const found = this._sessions.find((s) => s.id === deviceSession.id);\n    if (found) {\n      this._logger.warn(\"DeviceSession already exists\", {\n        data: { deviceSession },\n      });\n      return this;\n    }\n    this._sessions.push(deviceSession);\n    this._sessionsSubject.next(deviceSession);\n    this._logger.info(\"DeviceSession added\", {\n      data: { sessionId: deviceSession.id },\n    });\n    return this;\n  }\n\n  removeDeviceSession(sessionId: string): DeviceSessionService {\n    const found = this._sessions.find((s) => s.id === sessionId);\n    if (found) {\n      found.close();\n      this._sessions = this._sessions.filter((s) => s.id !== sessionId);\n      this._logger.info(\"DeviceSession removed\", { data: { sessionId } });\n      return this;\n    }\n    this._logger.warn(\"DeviceSession not found\", { data: { sessionId } });\n    return this;\n  }\n\n  getDeviceSessionById(\n    sessionId: string,\n  ): Either<DeviceSessionNotFound, DeviceSession> {\n    return Maybe.fromNullable(\n      this._sessions.find((s) => s.id === sessionId),\n    ).toEither(new DeviceSessionNotFound());\n  }\n\n  getDeviceSessionsByDeviceId(\n    deviceId: DeviceId,\n  ): Either<DeviceSessionNotFound, DeviceSession[]> {\n    return Maybe.fromPredicate(\n      ({ length }) => length > 0,\n      this._sessions.filter((s) => s.connectedDevice.id === deviceId),\n    ).toEither(new DeviceSessionNotFound());\n  }\n\n  getDeviceSessions(): DeviceSession[] {\n    return this._sessions;\n  }\n}\n"],
  "mappings": "iOAAA,OAAS,UAAAA,EAAQ,cAAAC,MAAkB,YACnC,OAAiB,SAAAC,MAAa,YAC9B,OAAqB,iBAAAC,MAAqB,OAK1C,OAAS,yBAAAC,MAA6B,wCAEtC,OAAS,eAAAC,MAAmB,4CAGrB,IAAMC,EAAN,KAAkE,CAC/D,UACS,iBACA,QAEjB,YAEEC,EACA,CACA,KAAK,UAAY,CAAC,EAClB,KAAK,iBAAmB,IAAIC,EAC5B,KAAK,QAAUD,EAAoB,sBAAsB,CAC3D,CAEA,IAAW,aAAyC,CAClD,OAAO,KAAK,iBAAiB,aAAa,CAC5C,CAEA,iBAAiBE,EAAoD,CAEnE,OADc,KAAK,UAAU,KAAMC,GAAMA,EAAE,KAAOD,EAAc,EAAE,GAEhE,KAAK,QAAQ,KAAK,+BAAgC,CAChD,KAAM,CAAE,cAAAA,CAAc,CACxB,CAAC,EACM,OAET,KAAK,UAAU,KAAKA,CAAa,EACjC,KAAK,iBAAiB,KAAKA,CAAa,EACxC,KAAK,QAAQ,KAAK,sBAAuB,CACvC,KAAM,CAAE,UAAWA,EAAc,EAAG,CACtC,CAAC,EACM,KACT,CAEA,oBAAoBE,EAAyC,CAC3D,MAAMC,EAAQ,KAAK,UAAU,KAAMF,GAAMA,EAAE,KAAOC,CAAS,EAC3D,OAAIC,GACFA,EAAM,MAAM,EACZ,KAAK,UAAY,KAAK,UAAU,OAAQF,GAAMA,EAAE,KAAOC,CAAS,EAChE,KAAK,QAAQ,KAAK,wBAAyB,CAAE,KAAM,CAAE,UAAAA,CAAU,CAAE,CAAC,EAC3D,OAET,KAAK,QAAQ,KAAK,0BAA2B,CAAE,KAAM,CAAE,UAAAA,CAAU,CAAE,CAAC,EAC7D,KACT,CAEA,qBACEA,EAC8C,CAC9C,OAAOE,EAAM,aACX,KAAK,UAAU,KAAM,GAAM,EAAE,KAAOF,CAAS,CAC/C,EAAE,SAAS,IAAIG,CAAuB,CACxC,CAEA,4BACEC,EACgD,CAChD,OAAOF,EAAM,cACX,CAAC,CAAE,OAAAG,CAAO,IAAMA,EAAS,EACzB,KAAK,UAAU,OAAQ,GAAM,EAAE,gBAAgB,KAAOD,CAAQ,CAChE,EAAE,SAAS,IAAID,CAAuB,CACxC,CAEA,mBAAqC,CACnC,OAAO,KAAK,SACd,CACF,EAlEaR,EAANW,EAAA,CADNC,EAAW,EAOPC,EAAA,EAAAC,EAAOC,EAAY,6BAA6B,IANxCf",
  "names": ["inject", "injectable", "Maybe", "ReplaySubject", "DeviceSessionNotFound", "loggerTypes", "DefaultDeviceSessionService", "loggerModuleFactory", "ReplaySubject", "deviceSession", "s", "sessionId", "found", "Maybe", "DeviceSessionNotFound", "deviceId", "length", "__decorateClass", "injectable", "__decorateParam", "inject", "loggerTypes"]
}
