{
  "version": 3,
  "sources": ["../../../../../../src/internal/device-session/service/RefresherService.ts"],
  "sourcesContent": ["import { v4 as uuidv4 } from \"uuid\";\n\nimport { type LoggerPublisherService } from \"@api/types\";\n\nexport interface RefresherController {\n  start(): void;\n  stop(): void;\n}\n\nexport class RefresherService {\n  private readonly _refresherBlockers = new Set<string>();\n  private readonly _logger: LoggerPublisherService;\n\n  constructor(\n    loggerModuleFactory: (tag: string) => LoggerPublisherService,\n    private readonly _refresher: RefresherController,\n  ) {\n    this._logger = loggerModuleFactory(\"refresher-service\");\n  }\n\n  public disableRefresher(id: string): () => void {\n    const uniqueId = `${id}-${uuidv4()}`;\n    this.addRefresherBlocker(uniqueId);\n\n    this._logger.debug(\"Refresher disabled\", {\n      data: {\n        blockerId: uniqueId,\n        blockers: Array.from(this._refresherBlockers),\n      },\n    });\n\n    let hasBeenReenabled = false;\n\n    return () => {\n      if (hasBeenReenabled) return;\n      hasBeenReenabled = true;\n      this.removeRefresherBlocker(uniqueId);\n\n      this._logger.debug(\"Refresher re-enabled\", {\n        data: {\n          blockerId: uniqueId,\n          blockers: Array.from(this._refresherBlockers),\n        },\n      });\n    };\n  }\n\n  private addRefresherBlocker(blockerId: string): void {\n    const prevBlockersCount = this._refresherBlockers.size;\n    this._refresherBlockers.add(blockerId);\n\n    if (prevBlockersCount === 0) {\n      this._refresher.stop();\n    }\n  }\n\n  private removeRefresherBlocker(blockerId: string): void {\n    const prevBlockersCount = this._refresherBlockers.size;\n    this._refresherBlockers.delete(blockerId);\n\n    if (prevBlockersCount > 0 && this._refresherBlockers.size === 0) {\n      this._refresher.start();\n    }\n  }\n}\n"],
  "mappings": "AAAA,OAAS,MAAMA,MAAc,OAStB,MAAMC,CAAiB,CAI5B,YACEC,EACiBC,EACjB,CADiB,gBAAAA,EAEjB,KAAK,QAAUD,EAAoB,mBAAmB,CACxD,CARiB,mBAAqB,IAAI,IACzB,QASV,iBAAiBE,EAAwB,CAC9C,MAAMC,EAAW,GAAGD,CAAE,IAAIJ,EAAO,CAAC,GAClC,KAAK,oBAAoBK,CAAQ,EAEjC,KAAK,QAAQ,MAAM,qBAAsB,CACvC,KAAM,CACJ,UAAWA,EACX,SAAU,MAAM,KAAK,KAAK,kBAAkB,CAC9C,CACF,CAAC,EAED,IAAIC,EAAmB,GAEvB,MAAO,IAAM,CACPA,IACJA,EAAmB,GACnB,KAAK,uBAAuBD,CAAQ,EAEpC,KAAK,QAAQ,MAAM,uBAAwB,CACzC,KAAM,CACJ,UAAWA,EACX,SAAU,MAAM,KAAK,KAAK,kBAAkB,CAC9C,CACF,CAAC,EACH,CACF,CAEQ,oBAAoBE,EAAyB,CACnD,MAAMC,EAAoB,KAAK,mBAAmB,KAClD,KAAK,mBAAmB,IAAID,CAAS,EAEjCC,IAAsB,GACxB,KAAK,WAAW,KAAK,CAEzB,CAEQ,uBAAuBD,EAAyB,CACtD,MAAMC,EAAoB,KAAK,mBAAmB,KAClD,KAAK,mBAAmB,OAAOD,CAAS,EAEpCC,EAAoB,GAAK,KAAK,mBAAmB,OAAS,GAC5D,KAAK,WAAW,MAAM,CAE1B,CACF",
  "names": ["uuidv4", "RefresherService", "loggerModuleFactory", "_refresher", "id", "uniqueId", "hasBeenReenabled", "blockerId", "prevBlockersCount"]
}
