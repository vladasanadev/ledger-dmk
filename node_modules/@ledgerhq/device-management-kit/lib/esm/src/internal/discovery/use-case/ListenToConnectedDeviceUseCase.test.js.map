{
  "version": 3,
  "sources": ["../../../../../../src/internal/discovery/use-case/ListenToConnectedDeviceUseCase.test.ts"],
  "sourcesContent": ["import { type DmkConfig } from \"@api/DmkConfig\";\nimport { type LoggerPublisherService } from \"@api/logger-publisher/service/LoggerPublisherService\";\nimport { ConnectedDevice } from \"@api/transport/model/ConnectedDevice\";\nimport { connectedDeviceStubBuilder } from \"@api/transport/model/TransportConnectedDevice.stub\";\nimport { DEVICE_SESSION_REFRESHER_DEFAULT_OPTIONS } from \"@internal/device-session/data/DeviceSessionRefresherConst\";\nimport { deviceSessionStubBuilder } from \"@internal/device-session/model/DeviceSession.stub\";\nimport { DefaultDeviceSessionService } from \"@internal/device-session/service/DefaultDeviceSessionService\";\nimport { type DeviceSessionService } from \"@internal/device-session/service/DeviceSessionService\";\nimport { ListenToConnectedDeviceUseCase } from \"@internal/discovery/use-case/ListenToConnectedDeviceUseCase\";\nimport { DefaultLoggerPublisherService } from \"@internal/logger-publisher/service/DefaultLoggerPublisherService\";\nimport { AxiosManagerApiDataSource } from \"@internal/manager-api/data/AxiosManagerApiDataSource\";\nimport { type ManagerApiDataSource } from \"@internal/manager-api/data/ManagerApiDataSource\";\nimport { DefaultManagerApiService } from \"@internal/manager-api/service/DefaultManagerApiService\";\nimport { type ManagerApiService } from \"@internal/manager-api/service/ManagerApiService\";\nimport { DefaultSecureChannelDataSource } from \"@internal/secure-channel/data/DefaultSecureChannelDataSource\";\nimport { type SecureChannelDataSource } from \"@internal/secure-channel/data/SecureChannelDataSource\";\nimport { DefaultSecureChannelService } from \"@internal/secure-channel/service/DefaultSecureChannelService\";\nimport { type SecureChannelService } from \"@internal/secure-channel/service/SecureChannelService\";\n\nvi.mock(\"@internal/manager-api/data/AxiosManagerApiDataSource\");\n\nlet logger: LoggerPublisherService;\nlet sessionService: DeviceSessionService;\nlet managerApiDataSource: ManagerApiDataSource;\nlet managerApi: ManagerApiService;\nlet secureChannelDataSource: SecureChannelDataSource;\nlet secureChannel: SecureChannelService;\n\nconst fakeSessionId = \"test-list-connected-device-session-id\";\n\ndescribe(\"ListenToConnectedDevice\", () => {\n  beforeEach(() => {\n    logger = new DefaultLoggerPublisherService(\n      [],\n      \"listen-to-connected-device-use-case\",\n    );\n    managerApiDataSource = new AxiosManagerApiDataSource({} as DmkConfig);\n    managerApi = new DefaultManagerApiService(managerApiDataSource);\n    secureChannelDataSource = new DefaultSecureChannelDataSource(\n      {} as DmkConfig,\n    );\n    secureChannel = new DefaultSecureChannelService(secureChannelDataSource);\n    sessionService = new DefaultDeviceSessionService(() => logger);\n  });\n\n  it(\"should emit an instance of ConnectedDevice\", () =>\n    new Promise<void>((resolve, reject) => {\n      // given\n      const connectedDevice = connectedDeviceStubBuilder({\n        id: \"test-list-connected-device-id\",\n      });\n      const deviceSession = deviceSessionStubBuilder(\n        { id: fakeSessionId, connectedDevice },\n        () => logger,\n        managerApi,\n        secureChannel,\n        DEVICE_SESSION_REFRESHER_DEFAULT_OPTIONS,\n      );\n      const observable = new ListenToConnectedDeviceUseCase(\n        sessionService,\n        () => logger,\n      ).execute();\n\n      const subscription = observable.subscribe({\n        next(emittedConnectedDevice) {\n          // then\n          try {\n            expect(emittedConnectedDevice).toEqual(\n              new ConnectedDevice({\n                transportConnectedDevice: connectedDevice,\n                sessionId: fakeSessionId,\n              }),\n            );\n            terminate();\n          } catch (error) {\n            reject(error);\n          }\n        },\n      });\n\n      function terminate() {\n        subscription.unsubscribe();\n        deviceSession.close();\n        resolve();\n      }\n\n      // when\n      sessionService.addDeviceSession(deviceSession);\n    }));\n});\n"],
  "mappings": "AAEA,OAAS,mBAAAA,MAAuB,uCAChC,OAAS,8BAAAC,MAAkC,qDAC3C,OAAS,4CAAAC,MAAgD,4DACzD,OAAS,4BAAAC,MAAgC,oDACzC,OAAS,+BAAAC,MAAmC,+DAE5C,OAAS,kCAAAC,MAAsC,8DAC/C,OAAS,iCAAAC,MAAqC,mEAC9C,OAAS,6BAAAC,MAAiC,uDAE1C,OAAS,4BAAAC,MAAgC,yDAEzC,OAAS,kCAAAC,MAAsC,+DAE/C,OAAS,+BAAAC,MAAmC,+DAG5C,GAAG,KAAK,sDAAsD,EAE9D,IAAIC,EACAC,EACAC,EACAC,EACAC,EACAC,EAEJ,MAAMC,EAAgB,wCAEtB,SAAS,0BAA2B,IAAM,CACxC,WAAW,IAAM,CACfN,EAAS,IAAIL,EACX,CAAC,EACD,qCACF,EACAO,EAAuB,IAAIN,EAA0B,CAAC,CAAc,EACpEO,EAAa,IAAIN,EAAyBK,CAAoB,EAC9DE,EAA0B,IAAIN,EAC5B,CAAC,CACH,EACAO,EAAgB,IAAIN,EAA4BK,CAAuB,EACvEH,EAAiB,IAAIR,EAA4B,IAAMO,CAAM,CAC/D,CAAC,EAED,GAAG,6CAA8C,IAC/C,IAAI,QAAc,CAACO,EAASC,IAAW,CAErC,MAAMC,EAAkBnB,EAA2B,CACjD,GAAI,+BACN,CAAC,EACKoB,EAAgBlB,EACpB,CAAE,GAAIc,EAAe,gBAAAG,CAAgB,EACrC,IAAMT,EACNG,EACAE,EACAd,CACF,EAMMoB,EALa,IAAIjB,EACrBO,EACA,IAAMD,CACR,EAAE,QAAQ,EAEsB,UAAU,CACxC,KAAKY,EAAwB,CAE3B,GAAI,CACF,OAAOA,CAAsB,EAAE,QAC7B,IAAIvB,EAAgB,CAClB,yBAA0BoB,EAC1B,UAAWH,CACb,CAAC,CACH,EACAO,EAAU,CACZ,OAASC,EAAO,CACdN,EAAOM,CAAK,CACd,CACF,CACF,CAAC,EAED,SAASD,GAAY,CACnBF,EAAa,YAAY,EACzBD,EAAc,MAAM,EACpBH,EAAQ,CACV,CAGAN,EAAe,iBAAiBS,CAAa,CAC/C,CAAC,CAAC,CACN,CAAC",
  "names": ["ConnectedDevice", "connectedDeviceStubBuilder", "DEVICE_SESSION_REFRESHER_DEFAULT_OPTIONS", "deviceSessionStubBuilder", "DefaultDeviceSessionService", "ListenToConnectedDeviceUseCase", "DefaultLoggerPublisherService", "AxiosManagerApiDataSource", "DefaultManagerApiService", "DefaultSecureChannelDataSource", "DefaultSecureChannelService", "logger", "sessionService", "managerApiDataSource", "managerApi", "secureChannelDataSource", "secureChannel", "fakeSessionId", "resolve", "reject", "connectedDevice", "deviceSession", "subscription", "emittedConnectedDevice", "terminate", "error"]
}
