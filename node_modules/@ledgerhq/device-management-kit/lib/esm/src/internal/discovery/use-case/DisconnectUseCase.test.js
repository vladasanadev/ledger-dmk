import{Left as D,Maybe as y,Right as s}from"purify-ts";import{TransportMock as C}from"../../../api/transport/model/__mocks__/TransportMock";import{DisconnectError as S}from"../../../api/transport/model/Errors";import{connectedDeviceStubBuilder as h}from"../../../api/transport/model/TransportConnectedDevice.stub";import{DEVICE_SESSION_REFRESHER_DEFAULT_OPTIONS as u}from"../../device-session/data/DeviceSessionRefresherConst";import{deviceSessionStubBuilder as v}from"../../device-session/model/DeviceSession.stub";import{DeviceSessionNotFound as w}from"../../device-session/model/Errors";import{DefaultDeviceSessionService as g}from"../../device-session/service/DefaultDeviceSessionService";import{DefaultLoggerPublisherService as T}from"../../logger-publisher/service/DefaultLoggerPublisherService";import{AxiosManagerApiDataSource as k}from"../../manager-api/data/AxiosManagerApiDataSource";import{DefaultManagerApiService as A}from"../../manager-api/service/DefaultManagerApiService";import{DefaultSecureChannelDataSource as E}from"../../secure-channel/data/DefaultSecureChannelDataSource";import{DefaultSecureChannelService as I}from"../../secure-channel/service/DefaultSecureChannelService";import{DefaultTransportService as O}from"../../transport/service/DefaultTransportService";import{DisconnectUseCase as a}from"./DisconnectUseCase";vi.mock("@internal/transport/service/DefaultTransportService");let e,p,c=[];const r=vi.fn().mockReturnValue(new T([],"DisconnectUseCaseTest"));let i,m,f,d,l;const n="sessionId";describe("DisconnectUseCase",()=>{beforeAll(()=>{p=new C,c=[p],e=new g(r),i=new O,vi.spyOn(i,"getTransport").mockReturnValue(y.of(p))}),it("should disconnect from a device",async()=>{const t=h();f=new k({}),m=new A(f),d=new E({}),l=new I(d);const o=v({id:n,connectedDevice:t},r,m,l,u);vi.spyOn(e,"getDeviceSessionById").mockImplementation(()=>s(o)),vi.spyOn(o,"close"),vi.spyOn(e,"removeDeviceSession"),vi.spyOn(c[0],"disconnect").mockImplementation(()=>Promise.resolve(s(void 0))),await new a(i,e,r).execute({sessionId:n}),expect(o.close).toHaveBeenCalled(),expect(e.removeDeviceSession).toHaveBeenCalledWith(n),expect(c[0].disconnect).toHaveBeenCalledWith({connectedDevice:t})}),it("should throw an error when deviceSession not found",async()=>{const t=new a(i,e,r);try{await t.execute({sessionId:n})}catch(o){expect(o).toStrictEqual(new w)}}),it("should throw an error if usb hid disconnection fails",async()=>{vi.spyOn(e,"getDeviceSessionById").mockImplementation(()=>s(v({id:n},r,m,l,u))),vi.spyOn(c[0],"disconnect").mockResolvedValue(D(new S));const t=new a(i,e,r);try{await t.execute({sessionId:n})}catch(o){expect(o).toStrictEqual(new S)}})});
//# sourceMappingURL=DisconnectUseCase.test.js.map
