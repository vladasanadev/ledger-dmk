{
  "version": 3,
  "sources": ["../../../../../../src/internal/discovery/use-case/DisconnectUseCase.ts"],
  "sourcesContent": ["import { inject, injectable } from \"inversify\";\nimport { EitherAsync } from \"purify-ts\";\n\nimport { LoggerPublisherService } from \"@api/logger-publisher/service/LoggerPublisherService\";\nimport { TransportNotSupportedError } from \"@api/transport/model/Errors\";\nimport type { DeviceSessionId } from \"@api/types\";\nimport { deviceSessionTypes } from \"@internal/device-session/di/deviceSessionTypes\";\nimport type { DeviceSessionService } from \"@internal/device-session/service/DeviceSessionService\";\nimport { loggerTypes } from \"@internal/logger-publisher/di/loggerTypes\";\nimport { transportDiTypes } from \"@internal/transport/di/transportDiTypes\";\nimport { type TransportService } from \"@internal/transport/service/TransportService\";\n\n/**\n * The arguments for the DisconnectUseCase.\n */\nexport type DisconnectUseCaseArgs = {\n  /**\n   * Device session identifier from `DeviceManagementKit.connect`.\n   */\n  sessionId: DeviceSessionId;\n};\n\n/**\n * Disconnects to a discovered device.\n */\n@injectable()\nexport class DisconnectUseCase {\n  private readonly _transportService: TransportService;\n  private readonly _sessionService: DeviceSessionService;\n  private readonly _logger: LoggerPublisherService;\n\n  constructor(\n    @inject(transportDiTypes.TransportService)\n    transportService: TransportService,\n    @inject(deviceSessionTypes.DeviceSessionService)\n    sessionService: DeviceSessionService,\n    @inject(loggerTypes.LoggerPublisherServiceFactory)\n    loggerFactory: (tag: string) => LoggerPublisherService,\n  ) {\n    this._sessionService = sessionService;\n    this._transportService = transportService;\n    this._logger = loggerFactory(\"DisconnectUseCase\");\n  }\n\n  async execute({ sessionId }: DisconnectUseCaseArgs): Promise<void> {\n    this._logger.debug(\"Disconnecting from device\", {\n      data: {\n        test: this._sessionService\n          .getDeviceSessions()\n          .map((session) => session.id),\n      },\n    });\n    return EitherAsync(async ({ liftEither }) => {\n      const session = await liftEither(\n        this._sessionService.getDeviceSessionById(sessionId).ifLeft((error) => {\n          this._logger.error(\"Device session not found\", {\n            data: { sessionId, error },\n          });\n        }),\n      );\n\n      const transportIdentifier = session.connectedDevice.transport;\n      const transport = await liftEither(\n        this._transportService\n          .getTransport(transportIdentifier)\n          .toEither(\n            new TransportNotSupportedError(new Error(\"Unknown transport\")),\n          ),\n      );\n\n      session.close();\n      this._sessionService.removeDeviceSession(sessionId);\n\n      await transport.disconnect({\n        connectedDevice: session.connectedDevice,\n      });\n    }).caseOf({\n      Left: (error) => {\n        this._logger.error(\"Error disconnecting from device\", {\n          data: { error },\n        });\n        throw error;\n      },\n      Right: () => {},\n    });\n  }\n}\n"],
  "mappings": "iOAAA,OAAS,UAAAA,EAAQ,cAAAC,MAAkB,YACnC,OAAS,eAAAC,MAAmB,YAG5B,OAAS,8BAAAC,MAAkC,8BAE3C,OAAS,sBAAAC,MAA0B,iDAEnC,OAAS,eAAAC,MAAmB,4CAC5B,OAAS,oBAAAC,MAAwB,0CAiB1B,IAAMC,EAAN,KAAwB,CACZ,kBACA,gBACA,QAEjB,YAEEC,EAEAC,EAEAC,EACA,CACA,KAAK,gBAAkBD,EACvB,KAAK,kBAAoBD,EACzB,KAAK,QAAUE,EAAc,mBAAmB,CAClD,CAEA,MAAM,QAAQ,CAAE,UAAAC,CAAU,EAAyC,CACjE,YAAK,QAAQ,MAAM,4BAA6B,CAC9C,KAAM,CACJ,KAAM,KAAK,gBACR,kBAAkB,EAClB,IAAKC,GAAYA,EAAQ,EAAE,CAChC,CACF,CAAC,EACMC,EAAY,MAAO,CAAE,WAAAC,CAAW,IAAM,CAC3C,MAAMF,EAAU,MAAME,EACpB,KAAK,gBAAgB,qBAAqBH,CAAS,EAAE,OAAQI,GAAU,CACrE,KAAK,QAAQ,MAAM,2BAA4B,CAC7C,KAAM,CAAE,UAAAJ,EAAW,MAAAI,CAAM,CAC3B,CAAC,CACH,CAAC,CACH,EAEMC,EAAsBJ,EAAQ,gBAAgB,UAC9CK,EAAY,MAAMH,EACtB,KAAK,kBACF,aAAaE,CAAmB,EAChC,SACC,IAAIE,EAA2B,IAAI,MAAM,mBAAmB,CAAC,CAC/D,CACJ,EAEAN,EAAQ,MAAM,EACd,KAAK,gBAAgB,oBAAoBD,CAAS,EAElD,MAAMM,EAAU,WAAW,CACzB,gBAAiBL,EAAQ,eAC3B,CAAC,CACH,CAAC,EAAE,OAAO,CACR,KAAOG,GAAU,CACf,WAAK,QAAQ,MAAM,kCAAmC,CACpD,KAAM,CAAE,MAAAA,CAAM,CAChB,CAAC,EACKA,CACR,EACA,MAAO,IAAM,CAAC,CAChB,CAAC,CACH,CACF,EA5DaR,EAANY,EAAA,CADNC,EAAW,EAOPC,EAAA,EAAAC,EAAOC,EAAiB,gBAAgB,GAExCF,EAAA,EAAAC,EAAOE,EAAmB,oBAAoB,GAE9CH,EAAA,EAAAC,EAAOG,EAAY,6BAA6B,IAVxClB",
  "names": ["inject", "injectable", "EitherAsync", "TransportNotSupportedError", "deviceSessionTypes", "loggerTypes", "transportDiTypes", "DisconnectUseCase", "transportService", "sessionService", "loggerFactory", "sessionId", "session", "EitherAsync", "liftEither", "error", "transportIdentifier", "transport", "TransportNotSupportedError", "__decorateClass", "injectable", "__decorateParam", "inject", "transportDiTypes", "deviceSessionTypes", "loggerTypes"]
}
