{
  "version": 3,
  "sources": ["../../../../../../src/internal/manager-api/service/DefaultManagerApiService.test.ts"],
  "sourcesContent": ["import { Left, Right } from \"purify-ts\";\nimport { type Mocked } from \"vitest\";\n\nimport { getOsVersionCommandResponseMockBuilder } from \"@api/command/os/__mocks__/GetOsVersionCommand\";\nimport { DeviceModelId } from \"@api/device/DeviceModel\";\nimport {\n  BTC_APP,\n  BTC_APP_METADATA,\n  ETH_APP,\n  ETH_APP_METADATA,\n} from \"@api/device-action/__test-utils__/data\";\nimport { type DmkConfig } from \"@api/DmkConfig\";\nimport { AxiosManagerApiDataSource } from \"@internal/manager-api/data/AxiosManagerApiDataSource\";\nimport { HttpFetchApiError } from \"@internal/manager-api/model/Errors\";\nimport {\n  type FinalFirmware,\n  type OsuFirmware,\n} from \"@internal/manager-api/model/Firmware\";\n\nimport { DefaultManagerApiService } from \"./DefaultManagerApiService\";\nimport { type ManagerApiService } from \"./ManagerApiService\";\n\nvi.mock(\"@internal/manager-api/data/AxiosManagerApiDataSource\");\nlet dataSource: Mocked<AxiosManagerApiDataSource>;\nlet service: ManagerApiService;\ndescribe(\"ManagerApiService\", () => {\n  beforeEach(() => {\n    dataSource = new AxiosManagerApiDataSource(\n      {} as DmkConfig,\n    ) as Mocked<AxiosManagerApiDataSource>;\n    service = new DefaultManagerApiService(dataSource);\n  });\n\n  describe(\"getAppList\", () => {\n    it(\"should call api with the correct parameters\", () => {\n      // given\n      const deviceInfo = getOsVersionCommandResponseMockBuilder(\n        DeviceModelId.STAX,\n      );\n      // when\n      service.getAppList(deviceInfo);\n      // then\n      expect(dataSource.getAppList).toHaveBeenCalledWith({\n        targetId: \"857735172\",\n        firmwareVersionName: \"1.3.0\",\n      });\n    });\n  });\n\n  describe(\"getAppsByHash\", () => {\n    describe(\"success cases\", () => {\n      it(\"with no apps, should return an empty list\", async () => {\n        dataSource.getAppsByHash.mockResolvedValue(Right([]));\n        expect(await service.getAppsByHash([])).toEqual(Right([]));\n      });\n\n      it(\"with one app, should return the metadata\", async () => {\n        dataSource.getAppsByHash.mockResolvedValue(Right([BTC_APP_METADATA]));\n        expect(await service.getAppsByHash([BTC_APP.appFullHash])).toEqual(\n          Right([BTC_APP_METADATA]),\n        );\n      });\n\n      it(\"with two app, should return the metadata of both apps\", async () => {\n        dataSource.getAppsByHash.mockResolvedValue(\n          Right([BTC_APP_METADATA, ETH_APP_METADATA]),\n        );\n        expect(\n          await service.getAppsByHash(\n            [BTC_APP, ETH_APP].map((app) => app.appFullHash),\n          ),\n        ).toEqual(Right([BTC_APP_METADATA, ETH_APP_METADATA]));\n      });\n\n      it(\"with one app and one without `appFullHash`, should return the metadata of the correct app\", async () => {\n        dataSource.getAppsByHash.mockResolvedValue(Right([BTC_APP_METADATA]));\n        const APP_WITH_NO_HASH = { ...ETH_APP, appFullHash: \"\" };\n        expect(\n          await service.getAppsByHash(\n            [BTC_APP, APP_WITH_NO_HASH].map((app) => app.appFullHash),\n          ),\n        ).toEqual(Right([BTC_APP_METADATA]));\n      });\n    });\n\n    describe(\"error cases\", () => {\n      it(\"should return an error when the data source fails with a known error\", async () => {\n        const error = new HttpFetchApiError(new Error(\"Failed to fetch data\"));\n        dataSource.getAppsByHash.mockRejectedValue(error);\n        expect(await service.getAppsByHash([BTC_APP.appFullHash])).toEqual(\n          Left(error),\n        );\n      });\n\n      it(\"should return an error when the data source fails with an unknown error\", async () => {\n        const error = new Error(\"unkown error\");\n        dataSource.getAppsByHash.mockRejectedValue(error);\n        expect(await service.getAppsByHash([BTC_APP.appFullHash])).toEqual(\n          Left(new HttpFetchApiError(error)),\n        );\n      });\n    });\n  });\n\n  describe(\"getDeviceVersion\", () => {\n    it(\"should call api with the correct parameters\", () => {\n      // given\n      const deviceInfo = getOsVersionCommandResponseMockBuilder(\n        DeviceModelId.STAX,\n      );\n      // when\n      service.getDeviceVersion(deviceInfo);\n      // then\n      expect(dataSource.getDeviceVersion).toHaveBeenCalledWith({\n        targetId: \"857735172\",\n      });\n    });\n  });\n\n  describe(\"getFirmwareVersion\", () => {\n    it(\"should call api with the correct parameters\", () => {\n      // given\n      const mockGetDeviceVersion = {\n        id: 17,\n        target_id: \"857735172\",\n      };\n      const deviceInfo = getOsVersionCommandResponseMockBuilder(\n        DeviceModelId.STAX,\n      );\n      // when\n      service.getFirmwareVersion(deviceInfo, mockGetDeviceVersion);\n      // then\n      expect(dataSource.getFirmwareVersion).toHaveBeenCalledWith({\n        deviceId: 17,\n        version: \"1.3.0\",\n      });\n    });\n  });\n\n  describe(\"getOsuFirmwareVersion\", () => {\n    it(\"should call api with the correct parameters\", () => {\n      // given\n      const mockGetDeviceVersion = {\n        id: 17,\n        target_id: \"857735172\",\n      };\n      const deviceInfo = getOsVersionCommandResponseMockBuilder(\n        DeviceModelId.STAX,\n      );\n      // when\n      service.getOsuFirmwareVersion(deviceInfo, mockGetDeviceVersion);\n      // then\n      expect(dataSource.getOsuFirmwareVersion).toHaveBeenCalledWith({\n        deviceId: 17,\n        version: \"1.3.0\",\n      });\n    });\n  });\n\n  describe(\"getLatestFirmwareVersion\", () => {\n    it(\"should call api with the correct parameters\", () => {\n      // given\n      const deviceVersion = {\n        id: 17,\n        target_id: \"857735172\",\n      };\n      const currentFirmware = {\n        id: 159,\n      } as FinalFirmware;\n      // when\n      service.getLatestFirmwareVersion(currentFirmware, deviceVersion);\n      // then\n      expect(dataSource.getLatestFirmwareVersion).toHaveBeenCalledWith({\n        currentFinalFirmwareId: 159,\n        deviceId: 17,\n      });\n    });\n  });\n\n  describe(\"getNextFirmwareVersion\", () => {\n    it(\"should call api with the correct parameters\", () => {\n      // given\n      const osuFirmware = {\n        nextFinalFirmware: 159,\n      } as OsuFirmware;\n      // when\n      service.getNextFirmwareVersion(osuFirmware);\n      // then\n      expect(dataSource.getFirmwareVersionById).toHaveBeenCalledWith(159);\n    });\n  });\n\n  describe(\"getLanguagePackages\", () => {\n    it(\"should call api with the correct parameters\", () => {\n      // given\n      const deviceVersion = {\n        id: 17,\n        target_id: \"857735172\",\n      };\n      const currentFirmware = {\n        id: 159,\n      } as FinalFirmware;\n      // when\n      service.getLanguagePackages(deviceVersion, currentFirmware);\n      // then\n      expect(dataSource.getLanguagePackages).toHaveBeenCalledWith({\n        deviceId: 17,\n        currentFinalFirmwareId: 159,\n      });\n    });\n  });\n\n  describe(\"getMcuList\", () => {\n    it(\"should call api with the correct parameters\", () => {\n      // when\n      service.getMcuList();\n      // then\n      expect(dataSource.getMcuList).toHaveBeenCalled();\n    });\n  });\n});\n"],
  "mappings": "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",
  "names": ["Left", "Right", "getOsVersionCommandResponseMockBuilder", "DeviceModelId", "BTC_APP", "BTC_APP_METADATA", "ETH_APP", "ETH_APP_METADATA", "AxiosManagerApiDataSource", "HttpFetchApiError", "DefaultManagerApiService", "dataSource", "service", "deviceInfo", "app", "APP_WITH_NO_HASH", "error", "mockGetDeviceVersion", "deviceVersion", "currentFirmware", "osuFirmware"]
}
