var d=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var u=(p,e,r,i)=>{for(var t=i>1?void 0:i?A(e,r):e,n=p.length-1,m;n>=0;n--)(m=p[n])&&(t=(i?m(e,r,t):m(t))||t);return i&&t&&d(e,r,t),t},g=(p,e)=>(r,i)=>e(r,i,p);import o from"axios";import{inject as _,injectable as w}from"inversify";import{EitherAsync as a}from"purify-ts";import{managerApiTypes as D}from"../../manager-api/di/managerApiTypes";import{AppType as c}from"../../manager-api/model/Application";import{DEFAULT_PROVIDER as F}from"../../manager-api/model/Const";import{DEFAULT_FIRMWARE_DISTRIBUTION_SALT as L}from"../../manager-api/model/Const";import{HttpFetchApiError as s}from"../../manager-api/model/Errors";import{AppTypeDto as l}from"./ManagerApiDto";let y=class{_managerApiBaseUrl;_provider=F;_firmwareDistributionSalt=L;constructor({managerApiUrl:e,provider:r,firmwareDistributionSalt:i}){this._managerApiBaseUrl=e,this._provider=r,this._firmwareDistributionSalt=i}setProvider(e){this._provider===e||e<1||(this._provider=e)}getProvider(){return this._provider}getAppList(e){const{targetId:r,firmwareVersionName:i}=e;return a(()=>o.get(`${this._managerApiBaseUrl}/v2/apps/by-target`,{params:{target_id:r,provider:this._provider,firmware_version_name:i}})).map(t=>t.data).chain(t=>this.mapApplicationDtoToApplication(t)).mapLeft(t=>new s(t))}getMcuList(){return a(()=>o.get(`${this._managerApiBaseUrl}/mcu_versions`,{})).map(e=>e.data).chain(e=>this.mapMcuDtoToMcu(e)).mapLeft(e=>new s(e))}getDeviceVersion(e){const{targetId:r}=e;return a(()=>o.get(`${this._managerApiBaseUrl}/get_device_version`,{params:{target_id:r,provider:this._provider}})).map(i=>i.data).chain(i=>this.mapDeviceVersionDto(i)).mapLeft(i=>new s(i))}getFirmwareVersion(e){const{deviceId:r,version:i}=e;return a(()=>o.get(`${this._managerApiBaseUrl}/get_firmware_version`,{params:{device_version:r,version_name:i,provider:this._provider}})).map(t=>t.data).chain(t=>this.mapFinalFirmwareDto(t)).mapLeft(t=>new s(t))}getFirmwareVersionById(e){return a(()=>o.get(`${this._managerApiBaseUrl}/firmware_final_versions/${e}`,{})).map(r=>r.data).chain(r=>this.mapFinalFirmwareDto(r)).mapLeft(r=>new s(r))}getOsuFirmwareVersion(e){const{deviceId:r,version:i}=e;return a(()=>o.get(`${this._managerApiBaseUrl}/get_osu_version`,{params:{device_version:r,version_name:i,provider:this._provider}})).map(t=>t.data).chain(t=>this.mapOsuFirmwareDto(t)).mapLeft(t=>new s(t))}getLatestFirmwareVersion(e){const r="34.27.0",{currentFinalFirmwareId:i,deviceId:t}=e;return a(()=>o.get(`${this._managerApiBaseUrl}/get_latest_firmware`,{params:{current_se_firmware_final_version:i,device_version:t,provider:this._provider,salt:this._firmwareDistributionSalt,livecommonversion:r}})).map(n=>n.data).chain(n=>this.mapLatestFirmwareDto(n)).mapLeft(n=>new s(n))}getAppsByHash(e){const{hashes:r}=e;return a(()=>o.post(`${this._managerApiBaseUrl}/v2/apps/hash`,r)).map(i=>i.data).chain(i=>this.mapNullableApplicationDtoToApplication(i)).mapLeft(i=>new s(i))}getLanguagePackages(e){const{deviceId:r,currentFinalFirmwareId:i}=e;return a(()=>o.get(`${this._managerApiBaseUrl}/language-packages`,{params:{device_version:r,current_se_firmware_final_version:i}})).map(t=>t.data).chain(t=>this.mapLanguagesDtoToLanguages(t)).mapLeft(t=>new s(t))}mapAppTypeDtoToAppType(e){if(e===null)return null;switch(e){case l.currency:return c.currency;case l.plugin:return c.plugin;case l.tool:return c.tool;case l.swap:return c.swap}}mapApplicationDtoToApplication(e){return a(()=>Promise.resolve(e.map(r=>this.mapApplicationDto(r))))}mapNullableApplicationDtoToApplication(e){return a(()=>Promise.resolve(e.map(r=>r===null?null:this.mapApplicationDto(r))))}mapApplicationDto(e){if(typeof e!="object"||typeof e.versionId!="number"||typeof e.versionName!="string"||e.versionDisplayName!==null&&typeof e.versionDisplayName!="string"||typeof e.version!="string"||e.currencyId!==null&&typeof e.currencyId!="string"||e.description!==null&&typeof e.description!="string"||e.applicationType!==null&&typeof e.applicationType!="string"||typeof e.dateModified!="string"||e.icon!==null&&typeof e.icon!="string"||e.authorName!==null&&typeof e.authorName!="string"||e.supportURL!==null&&typeof e.supportURL!="string"||e.contactURL!==null&&typeof e.contactURL!="string"||e.sourceURL!==null&&typeof e.sourceURL!="string"||e.compatibleWallets!==null&&typeof e.compatibleWallets!="string"||typeof e.hash!="string"||typeof e.perso!="string"||typeof e.firmware!="string"||typeof e.firmwareKey!="string"||typeof e.delete!="string"||typeof e.deleteKey!="string"||e.bytes!==null&&typeof e.bytes!="number"||e.warning!==null&&typeof e.warning!="string"||typeof e.isDevTools!="boolean"||e.category!==null&&typeof e.category!="number"||e.parent!==null&&typeof e.parent!="number"||e.parentName!==null&&typeof e.parentName!="string")throw new Error(`Incomplete application: ${JSON.stringify(e)}`);const{applicationType:r,hash:i,perso:t,firmware:n,firmwareKey:m,delete:f,deleteKey:h,...v}=e;return{...v,hash:i,perso:t,firmware:n,firmwareKey:m,delete:f,deleteKey:h,applicationType:this.mapAppTypeDtoToAppType(r)}}mapMcuDtoToMcu(e){return a(()=>Promise.resolve(e.map(r=>{if(typeof r!="object"||typeof r.id!="number"||typeof r.name!="string")throw new Error(`Incomplete MCU version: ${JSON.stringify(r)}`);return{id:r.id,name:r.name}})))}mapDeviceVersionDto(e){return a(()=>{if(typeof e!="object"||typeof e.id!="number")throw new Error(`Incomplete device version: ${JSON.stringify(e)}`);const r={id:e.id};return Promise.resolve(r)})}mapFinalFirmwareDto(e){return a(()=>{if(typeof e!="object"||typeof e.id!="number"||typeof e.version!="string"||typeof e.perso!="string"||e.firmware!==null&&typeof e.firmware!="string"||e.firmware_key!==null&&typeof e.firmware_key!="string"||e.hash!==null&&typeof e.hash!="string"||e.bytes!==null&&typeof e.bytes!="number"||!Array.isArray(e.mcu_versions))throw new Error(`Incomplete final firmware: ${JSON.stringify(e)}`);const r={id:e.id,version:e.version,perso:e.perso,firmware:e.firmware,firmwareKey:e.firmware_key,hash:e.hash,bytes:e.bytes,mcuVersions:e.mcu_versions};return Promise.resolve(r)})}mapLatestFirmwareDto(e){return a(()=>{if(e.result!=="success"||!e.se_firmware_osu_version)throw new Error(`Latest firmware could not be retrieved: ${e.result}`);const r=e.se_firmware_osu_version;return Promise.resolve(r)}).chain(r=>this.mapOsuFirmwareDto(r))}mapOsuFirmwareDto(e){return a(()=>{if(typeof e!="object"||typeof e.id!="number"||typeof e.perso!="string"||typeof e.firmware!="string"||typeof e.firmware_key!="string"||e.hash!==null&&typeof e.hash!="string"||typeof e.next_se_firmware_final_version!="number")throw new Error(`Incomplete latest firmware: ${JSON.stringify(e)}`);const r={id:e.id,perso:e.perso,firmware:e.firmware,firmwareKey:e.firmware_key,hash:e.hash,nextFinalFirmware:e.next_se_firmware_final_version};return Promise.resolve(r)})}mapLanguagesDtoToLanguages(e){return a(()=>Promise.resolve(e.map(r=>this.mapLanguageDto(r))))}mapLanguageDto(e){if(typeof e!="object"||typeof e.language!="string"||typeof e.languagePackageVersionId!="number"||typeof e.version!="string"||typeof e.language_package_id!="number"||typeof e.apdu_install_url!="string"||typeof e.apdu_uninstall_url!="string"||typeof e.bytes!="number"||typeof e.date_creation!="string"||typeof e.date_last_modified!="string")throw new Error(`Incomplete language version: ${JSON.stringify(e)}`);return{language:e.language,languagePackageVersionId:e.languagePackageVersionId,version:e.version,languagePackageId:e.language_package_id,apduInstallUrl:e.apdu_install_url,apduUninstallUrl:e.apdu_uninstall_url,bytes:e.bytes,dateCreation:e.date_creation,dateLastModified:e.date_last_modified}}};y=u([w(),g(0,_(D.DmkConfig))],y);export{y as AxiosManagerApiDataSource};
//# sourceMappingURL=AxiosManagerApiDataSource.js.map
