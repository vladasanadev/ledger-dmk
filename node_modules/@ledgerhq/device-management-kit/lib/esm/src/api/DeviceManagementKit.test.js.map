{
  "version": 3,
  "sources": ["../../../../src/api/DeviceManagementKit.test.ts"],
  "sourcesContent": ["import { type ServiceIdentifier } from \"inversify\";\n\nimport { type LocalConfigDataSource } from \"@internal/config/data/ConfigDataSource\";\nimport { StubLocalConfigDataSource } from \"@internal/config/data/LocalConfigDataSource.stub\";\nimport { configTypes } from \"@internal/config/di/configTypes\";\nimport { deviceSessionTypes } from \"@internal/device-session/di/deviceSessionTypes\";\nimport { discoveryTypes } from \"@internal/discovery/di/discoveryTypes\";\nimport { managerApiTypes } from \"@internal/manager-api/di/managerApiTypes\";\nimport { sendTypes } from \"@internal/send/di/sendTypes\";\nimport pkg from \"@root/package.json\";\nimport { StubUseCase } from \"@root/src/di.stub\";\n\nimport { commandTypes } from \"./command/di/commandTypes\";\nimport { ConsoleLogger } from \"./logger-subscriber/service/ConsoleLogger\";\nimport { DeviceManagementKit } from \"./DeviceManagementKit\";\nimport { type DmkConfig } from \"./DmkConfig\";\n\nvi.mock(\"./logger-subscriber/service/ConsoleLogger\");\n\nlet dmk: DeviceManagementKit;\nlet logger: ConsoleLogger;\ndescribe(\"DeviceManagementKit\", () => {\n  describe(\"clean\", () => {\n    beforeEach(() => {\n      logger = new ConsoleLogger();\n      dmk = new DeviceManagementKit({\n        stub: false,\n        loggers: [logger],\n        config: {\n          managerApiUrl: \"http://fake.url\",\n          mockUrl: \"http://fake-mock.url\",\n          webSocketUrl: \"http://fake-websocket.url\",\n          firmwareDistributionSalt: \"salt\",\n        } as DmkConfig,\n      });\n    });\n\n    it(\"should create an instance\", () => {\n      expect(dmk).toBeDefined();\n      expect(dmk).toBeInstanceOf(DeviceManagementKit);\n    });\n\n    it(\"should return a clean `version`\", async () => {\n      expect(await dmk.getVersion()).toBe(pkg.version);\n    });\n\n    it(\"should have startDiscovery method\", () => {\n      expect(dmk.startDiscovering).toBeDefined();\n    });\n\n    it(\"should have stopDiscovery method\", () => {\n      expect(dmk.stopDiscovering).toBeDefined();\n    });\n\n    it(\"should have connect method\", () => {\n      expect(dmk.connect).toBeDefined();\n    });\n\n    it(\"should have reconnect method\", () => {\n      expect(dmk.reconnect).toBeDefined();\n    });\n\n    it(\"should have sendApdu method\", () => {\n      expect(dmk.sendApdu).toBeDefined();\n    });\n\n    it(\"should have getConnectedDevice method\", () => {\n      expect(dmk.getConnectedDevice).toBeDefined();\n    });\n\n    it(\"should have sendCommand method\", () => {\n      expect(dmk.sendCommand).toBeDefined();\n    });\n\n    it(\"should have listConnectedDevices method\", () => {\n      expect(dmk.listConnectedDevices).toBeDefined();\n    });\n\n    it(\"should have listenToConnectedDevice method\", () => {\n      expect(dmk.listenToConnectedDevice).toBeDefined();\n    });\n\n    it(\"should have disableDeviceSessionRefresher method\", () => {\n      expect(dmk.disableDeviceSessionRefresher).toBeDefined();\n    });\n\n    it(\"should have setProvider method\", () => {\n      expect(dmk.setProvider).toBeDefined();\n    });\n\n    it(\"should have isEnvironmentSupported method\", () => {\n      expect(dmk.isEnvironmentSupported).toBeDefined();\n    });\n\n    describe(\"isEnvironmentSupported\", () => {\n      it(\"should return true when at least one transport is supported\", () => {\n        // Mock the TransportService to return transports where at least one is supported\n        const mockTransport1 = {\n          isSupported: vi.fn().mockReturnValue(false),\n        };\n        const mockTransport2 = {\n          isSupported: vi.fn().mockReturnValue(true),\n        };\n        const mockTransportService = {\n          getAllTransports: vi\n            .fn()\n            .mockReturnValue([mockTransport1, mockTransport2]),\n        };\n\n        // Mock the container to return our mock TransportService\n        vi.spyOn(dmk.container, \"get\").mockReturnValue(mockTransportService);\n\n        const result = dmk.isEnvironmentSupported();\n\n        expect(result).toBe(true);\n        expect(mockTransportService.getAllTransports).toHaveBeenCalled();\n        expect(mockTransport1.isSupported).toHaveBeenCalled();\n        expect(mockTransport2.isSupported).toHaveBeenCalled();\n      });\n\n      it(\"should return false when no transports are supported\", () => {\n        // Mock the TransportService to return transports where none are supported\n        const mockTransport1 = {\n          isSupported: vi.fn().mockReturnValue(false),\n        };\n        const mockTransport2 = {\n          isSupported: vi.fn().mockReturnValue(false),\n        };\n        const mockTransportService = {\n          getAllTransports: vi\n            .fn()\n            .mockReturnValue([mockTransport1, mockTransport2]),\n        };\n\n        // Mock the container to return our mock TransportService\n        vi.spyOn(dmk.container, \"get\").mockReturnValue(mockTransportService);\n\n        const result = dmk.isEnvironmentSupported();\n\n        expect(result).toBe(false);\n        expect(mockTransportService.getAllTransports).toHaveBeenCalled();\n        expect(mockTransport1.isSupported).toHaveBeenCalled();\n        expect(mockTransport2.isSupported).toHaveBeenCalled();\n      });\n\n      it(\"should return false when no transports are available\", () => {\n        // Mock the TransportService to return an empty array\n        const mockTransportService = {\n          getAllTransports: vi.fn().mockReturnValue([]),\n        };\n\n        // Mock the container to return our mock TransportService\n        vi.spyOn(dmk.container, \"get\").mockReturnValue(mockTransportService);\n\n        const result = dmk.isEnvironmentSupported();\n\n        expect(result).toBe(false);\n        expect(mockTransportService.getAllTransports).toHaveBeenCalled();\n      });\n    });\n  });\n\n  describe(\"stubbed\", () => {\n    beforeEach(() => {\n      dmk = new DeviceManagementKit({\n        stub: true,\n        loggers: [],\n        config: {\n          managerApiUrl: \"http://fake.url\",\n          mockUrl: \"http://fake-mock.url\",\n          webSocketUrl: \"http://fake-websocket.url\",\n          firmwareDistributionSalt: \"salt\",\n        } as DmkConfig,\n      });\n    });\n\n    it(\"should create a stubbed dmk\", () => {\n      expect(dmk).toBeDefined();\n      expect(dmk).toBeInstanceOf(DeviceManagementKit);\n    });\n\n    it(\"should return a stubbed config\", () => {\n      expect(\n        dmk.container.get<LocalConfigDataSource>(\n          configTypes.LocalConfigDataSource,\n        ),\n      ).toBeInstanceOf(StubLocalConfigDataSource);\n    });\n\n    it(\"should return a stubbed version\", async () => {\n      expect(await dmk.getVersion()).toBe(\"0.0.0-stub.1\");\n    });\n\n    it.each([\n      [discoveryTypes.StartDiscoveringUseCase],\n      [discoveryTypes.StopDiscoveringUseCase],\n      [discoveryTypes.ConnectUseCase],\n      [sendTypes.SendApduUseCase],\n      [commandTypes.SendCommandUseCase],\n      [discoveryTypes.GetConnectedDeviceUseCase],\n      [discoveryTypes.DisconnectUseCase],\n      [deviceSessionTypes.GetDeviceSessionStateUseCase],\n      [discoveryTypes.ListConnectedDevicesUseCase],\n      [discoveryTypes.ListenToConnectedDeviceUseCase],\n      [managerApiTypes.SetProviderUseCase],\n    ])(\n      \"should have %s use case\",\n      (diSymbol: ServiceIdentifier<StubUseCase>) => {\n        const uc = dmk.container.get<StubUseCase>(diSymbol);\n        expect(uc).toBeInstanceOf(StubUseCase);\n        expect(uc.execute()).toBe(\"stub\");\n      },\n    );\n  });\n});\n"],
  "mappings": "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",
  "names": ["StubLocalConfigDataSource", "configTypes", "deviceSessionTypes", "discoveryTypes", "managerApiTypes", "sendTypes", "pkg", "StubUseCase", "commandTypes", "ConsoleLogger", "DeviceManagementKit", "dmk", "logger", "mockTransport1", "mockTransport2", "mockTransportService", "result", "diSymbol", "uc"]
}
