{
  "version": 3,
  "sources": ["../../../../../../src/api/device-action/__test-utils__/setupTestMachine.ts"],
  "sourcesContent": ["import { Left, Right } from \"purify-ts\";\nimport { type Mock } from \"vitest\";\nimport { assign, createMachine } from \"xstate\";\n\nimport { UserInteractionRequired } from \"@api/device-action/model/UserInteractionRequired\";\nimport { UnknownDAError } from \"@api/device-action/os/Errors\";\nimport { GetDeviceMetadataDeviceAction } from \"@api/device-action/os/GetDeviceMetadata/GetDeviceMetadataDeviceAction\";\nimport { type GetDeviceMetadataDAOutput } from \"@api/device-action/os/GetDeviceMetadata/types\";\nimport { GetDeviceStatusDeviceAction } from \"@api/device-action/os/GetDeviceStatus/GetDeviceStatusDeviceAction\";\nimport { GoToDashboardDeviceAction } from \"@api/device-action/os/GoToDashboard/GoToDashboardDeviceAction\";\nimport { InstallOrUpdateAppsDeviceAction } from \"@api/device-action/os/InstallOrUpdateApps/InstallOrUpdateAppsDeviceAction\";\nimport {\n  type InstallOrUpdateAppsDAIntermediateValue,\n  type InstallOrUpdateAppsDAOutput,\n} from \"@api/device-action/os/InstallOrUpdateApps/types\";\nimport { ListAppsDeviceAction } from \"@api/device-action/os/ListApps/ListAppsDeviceAction\";\nimport { OpenAppDeviceAction } from \"@api/device-action/os/OpenAppDeviceAction/OpenAppDeviceAction\";\nimport { type DmkError } from \"@api/Error\";\nimport { ListInstalledAppsDeviceAction } from \"@api/secure-channel/device-action/ListInstalledApps/ListInstalledAppsDeviceAction\";\nimport { type InstalledApp } from \"@api/secure-channel/device-action/ListInstalledApps/types\";\n\nimport { type BTC_APP } from \"./data\";\n\ntype App = typeof BTC_APP;\n\nexport const setupListAppsMock = (apps: App[], error = false) => {\n  (ListAppsDeviceAction as Mock).mockImplementation(() => ({\n    makeStateMachine: vi.fn().mockImplementation(() =>\n      createMachine({\n        id: \"MockListAppsDeviceAction\",\n        initial: \"ready\",\n        states: {\n          ready: {\n            after: {\n              0: \"done\",\n            },\n            entry: assign({\n              intermediateValue: () => ({\n                requiredUserInteraction: UserInteractionRequired.AllowListApps,\n              }),\n            }),\n          },\n          done: {\n            type: \"final\",\n          },\n        },\n        output: () => {\n          return error\n            ? Left(new UnknownDAError(\"ListApps failed\"))\n            : Right(apps);\n        },\n      }),\n    ),\n  }));\n};\n\nexport const setupGetDeviceMetadataMock = (\n  metadata: GetDeviceMetadataDAOutput,\n  error = false,\n) => {\n  (GetDeviceMetadataDeviceAction as Mock).mockImplementation(() => ({\n    makeStateMachine: vi.fn().mockImplementation(() =>\n      createMachine({\n        id: \"MockGetDeviceMetadataDeviceAction\",\n        initial: \"ready\",\n        states: {\n          ready: {\n            after: {\n              0: \"done\",\n            },\n            entry: assign({\n              intermediateValue: () => ({\n                requiredUserInteraction: UserInteractionRequired.None,\n              }),\n            }),\n          },\n          done: {\n            type: \"final\",\n          },\n        },\n        output: () => {\n          return error\n            ? Left(new UnknownDAError(\"GetDeviceMetadata failed\"))\n            : Right(metadata);\n        },\n      }),\n    ),\n  }));\n};\n\nexport const setupInstallOrUpdateAppsMock = (\n  result: InstallOrUpdateAppsDAOutput,\n  intermediateValue: InstallOrUpdateAppsDAIntermediateValue,\n  error = false,\n) => {\n  (InstallOrUpdateAppsDeviceAction as Mock).mockImplementation(() => ({\n    makeStateMachine: vi.fn().mockImplementation(() =>\n      createMachine({\n        id: \"MockInstallOrUpdateAppsDeviceAction\",\n        initial: \"ready\",\n        states: {\n          ready: {\n            after: {\n              0: \"done\",\n            },\n            entry: assign({\n              intermediateValue: () => intermediateValue,\n            }),\n          },\n          done: {\n            type: \"final\",\n          },\n        },\n        output: () => {\n          return error\n            ? Left(new UnknownDAError(\"InstallOrUpdateApps failed\"))\n            : Right(result);\n        },\n      }),\n    ),\n  }));\n};\n\nexport const setupOpenAppMock = (error: boolean = false) => {\n  (OpenAppDeviceAction as Mock).mockImplementation(() => ({\n    makeStateMachine: vi.fn().mockImplementation(() =>\n      createMachine({\n        initial: \"ready\",\n        states: {\n          ready: {\n            entry: assign({\n              intermediateValue: {\n                requiredUserInteraction: UserInteractionRequired.ConfirmOpenApp,\n              },\n            }),\n            after: {\n              0: \"done\",\n            },\n          },\n          done: {\n            type: \"final\",\n          },\n        },\n        output: () => {\n          return error\n            ? Left(new UnknownDAError(\"OpenApp failed\"))\n            : Right(undefined);\n        },\n      }),\n    ),\n  }));\n};\n\nexport const setupGoToDashboardMock = (error: boolean = false) => {\n  (GoToDashboardDeviceAction as Mock).mockImplementation(() => ({\n    makeStateMachine: vi.fn().mockImplementation(() =>\n      createMachine({\n        id: \"MockGoToDashboardDeviceAction\",\n        initial: \"ready\",\n        states: {\n          ready: {\n            after: {\n              0: \"done\",\n            },\n            entry: assign({\n              intermediateValue: () => ({\n                requiredUserInteraction: UserInteractionRequired.None,\n              }),\n            }),\n          },\n          done: {\n            type: \"final\",\n          },\n        },\n        output: () => {\n          return error\n            ? Left(new UnknownDAError(\"GoToDashboard failed\"))\n            : Right(undefined);\n        },\n      }),\n    ),\n  }));\n};\n\nexport const setupGetDeviceStatusMock = (\n  outputs: ReadonlyArray<\n    { currentApp: string; currentAppVersion: string } | DmkError\n  > = [\n    {\n      currentApp: \"BOLOS\",\n      currentAppVersion: \"1.0.0\",\n    },\n  ],\n) => {\n  const outputFn = vi.fn();\n\n  for (const output of outputs) {\n    outputFn.mockImplementationOnce(() =>\n      \"currentApp\" in output ? Right(output) : Left(output),\n    );\n  }\n  (GetDeviceStatusDeviceAction as Mock).mockImplementation(() => ({\n    makeStateMachine: vi.fn().mockImplementation(() =>\n      createMachine({\n        id: \"MockGetDeviceStatusDeviceAction\",\n        initial: \"ready\",\n        states: {\n          ready: {\n            after: {\n              0: \"done\",\n            },\n            entry: assign({\n              intermediateValue: () => ({\n                requiredUserInteraction: UserInteractionRequired.None,\n              }),\n            }),\n          },\n          done: {\n            type: \"final\",\n          },\n        },\n        output: outputFn,\n      }),\n    ),\n  }));\n};\n\nexport const setupListInstalledAppsMock = (\n  outputs: Array<{ installedApps: InstalledApp[] } | DmkError> = [],\n) => {\n  (ListInstalledAppsDeviceAction as Mock).mockImplementation(() => ({\n    makeStateMachine: vi.fn().mockImplementation(() =>\n      createMachine({\n        id: \"MockListInstalledAppsDeviceAction\",\n        initial: \"ready\",\n        states: {\n          ready: {\n            after: {\n              0: \"done\",\n            },\n            entry: assign({\n              intermediateValue: () => ({\n                requiredUserInteraction: UserInteractionRequired.None,\n              }),\n            }),\n          },\n          done: {\n            type: \"final\",\n          },\n        },\n        output: outputs\n          .reduce(\n            (mockFn, output) =>\n              mockFn.mockImplementationOnce(() =>\n                \"installedApps\" in output ? Right(output) : Left(output),\n              ),\n            vi.fn(),\n          )\n          .mockImplementation(() => Right([])),\n      }),\n    ),\n  }));\n};\n"],
  "mappings": "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",
  "names": ["Left", "Right", "assign", "createMachine", "UserInteractionRequired", "UnknownDAError", "GetDeviceMetadataDeviceAction", "GetDeviceStatusDeviceAction", "GoToDashboardDeviceAction", "InstallOrUpdateAppsDeviceAction", "ListAppsDeviceAction", "OpenAppDeviceAction", "ListInstalledAppsDeviceAction", "setupListAppsMock", "apps", "error", "setupGetDeviceMetadataMock", "metadata", "setupInstallOrUpdateAppsMock", "result", "intermediateValue", "setupOpenAppMock", "setupGoToDashboardMock", "setupGetDeviceStatusMock", "outputs", "outputFn", "output", "setupListInstalledAppsMock", "mockFn"]
}
