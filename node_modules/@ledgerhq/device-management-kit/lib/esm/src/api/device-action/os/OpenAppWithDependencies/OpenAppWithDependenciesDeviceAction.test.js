import{makeDeviceActionInternalApiMock as v}from"../../../device-action/__test-utils__/makeInternalApi";import{setupGetDeviceMetadataMock as p,setupInstallOrUpdateAppsMock as A,setupOpenAppMock as U}from"../../../device-action/__test-utils__/setupTestMachine";import{testDeviceActionStates as l}from"../../../device-action/__test-utils__/testDeviceActionStates";import{DeviceActionStatus as e}from"../../../device-action/model/DeviceActionState";import{UserInteractionRequired as t}from"../../../device-action/model/UserInteractionRequired";import{UnknownDAError as D,UnsupportedFirmwareDAError as P}from"../../../device-action/os/Errors";import{OpenAppWithDependenciesDeviceAction as d}from"./OpenAppWithDependenciesDeviceAction";vi.mock("@api/device-action/os/OpenAppDeviceAction/OpenAppDeviceAction");vi.mock("@api/device-action/os/InstallOrUpdateApps/InstallOrUpdateAppsDeviceAction");vi.mock("@api/device-action/os/GetDeviceMetadata/GetDeviceMetadataDeviceAction");describe("OpenAppWithDependenciesDeviceAction",()=>{const o=v(),c={firmwareUpdateContext:{}},r={requiredUserInteraction:t.None,installPlan:{installPlan:[{versionName:"1inch"}],alreadyInstalled:["Ethereum","Uniswap"],missingApplications:[""],currentIndex:0,currentProgress:.5}},u={successfullyInstalled:[{versionName:"1inch"}],alreadyInstalled:["Ethereum","Uniswap"],missingApplications:[""]};beforeEach(()=>{vi.clearAllMocks()}),describe("success cases",()=>{it("Open app with dependencies",()=>new Promise((n,a)=>{p(c),A(u,r),U();const s=new d({input:{application:{name:"Ethereum"},dependencies:[{name:"Uniswap"},{name:"1inch"}],requireLatestFirmware:!1}}),i=[{intermediateValue:{requiredUserInteraction:t.None,installPlan:null},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None,installPlan:null},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None,installPlan:null},status:e.Pending},{intermediateValue:r,status:e.Pending},{intermediateValue:r,status:e.Pending},{intermediateValue:{requiredUserInteraction:t.ConfirmOpenApp,installPlan:null},status:e.Pending},{output:{deviceMetadata:c,installResult:u},status:e.Completed}];l(s,i,o,{onDone:n,onError:a})}))}),describe("error cases",()=>{it("Get device metadata error",()=>new Promise((n,a)=>{p(c,!0);const s=new d({input:{application:{name:"Ethereum"},dependencies:[{name:"Uniswap"},{name:"1inch"}],requireLatestFirmware:!1}}),i=[{intermediateValue:{requiredUserInteraction:t.None,installPlan:null},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None,installPlan:null},status:e.Pending},{error:new D("GetDeviceMetadata failed"),status:e.Error}];l(s,i,o,{onDone:n,onError:a})})),it("Unsupported firmware",()=>new Promise((n,a)=>{p({firmwareUpdateContext:{availableUpdate:"mockUpdate"}});const i=new d({input:{application:{name:"Ethereum"},dependencies:[{name:"Uniswap"},{name:"1inch"}],requireLatestFirmware:!0}}),m=[{intermediateValue:{requiredUserInteraction:t.None,installPlan:null},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None,installPlan:null},status:e.Pending},{error:new P("Firmware is not the latest version"),status:e.Error}];l(i,m,o,{onDone:n,onError:a})})),it("Install apps error",()=>new Promise((n,a)=>{p({firmwareUpdateContext:{availableUpdate:"mockUpdate"}}),A(u,r,!0);const i=new d({input:{application:{name:"Ethereum"},dependencies:[{name:"Uniswap"},{name:"1inch"}],requireLatestFirmware:!1}}),m=[{intermediateValue:{requiredUserInteraction:t.None,installPlan:null},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None,installPlan:null},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None,installPlan:null},status:e.Pending},{intermediateValue:r,status:e.Pending},{error:new D("InstallOrUpdateApps failed"),status:e.Error}];l(i,m,o,{onDone:n,onError:a})})),it("Open app error",()=>new Promise((n,a)=>{p(c),A(u,r),U(!0);const s=new d({input:{application:{name:"Ethereum"},dependencies:[{name:"Uniswap"},{name:"1inch"}],requireLatestFirmware:!1}}),i=[{intermediateValue:{requiredUserInteraction:t.None,installPlan:null},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None,installPlan:null},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None,installPlan:null},status:e.Pending},{intermediateValue:r,status:e.Pending},{intermediateValue:r,status:e.Pending},{intermediateValue:{requiredUserInteraction:t.ConfirmOpenApp,installPlan:null},status:e.Pending},{error:new D("OpenApp failed"),status:e.Error}];l(s,i,o,{onDone:n,onError:a})}))})});
//# sourceMappingURL=OpenAppWithDependenciesDeviceAction.test.js.map
