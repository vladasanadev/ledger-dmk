import{gt as v}from"semver";import{InvalidStatusWordError as m}from"../../command/Errors";import{CommandResultFactory as p,isSuccessCommandResult as y}from"../../command/model/CommandResult";import{ListLanguagePackCommand as C}from"../../command/os/ListLanguagePackCommand";const w="0000000000000000000000000000000000000000000000000000000000000000";class M{constructor(e,n){this.api=e;this.args=n}async run(){const e=this.args.installedApps.filter(a=>this.isApplication(a)),n=this.api.getManagerApiService(),u=e.map(a=>a.hash),l=await n.getAppsByHash(u).chain(a=>n.getAppList(this.args.firmwareVersion.metadata).map(t=>({applications:a,catalog:t})));if(l.isLeft())return p({error:new m("Cannot get the application catalog")});const{applications:c,catalog:s}=l.unsafeCoerce(),A=c.reduce((a,t,i)=>{if(t!==null)return[...a,t];const o=e[i],d=s.find(h=>h.versionName===o.name);return d?[...a,d]:a},[]),f=c.filter(a=>a!==null).reduce((a,t)=>{const i=s.find(o=>o.versionName===t.versionName);return i&&v(i.version,t.version)?[...a,i]:a},[]);let r=[];for(let a=0;;a++){const t=await this.api.sendCommand(new C({firstChunk:a===0}));if(!y(t)||t.data===void 0)break;r=[...r,t.data]}const g=await n.getLanguagePackages(this.args.deviceVersion,this.args.firmware);return g.isRight()?p({data:{applications:A,applicationsUpdates:f,installedLanguages:r,catalog:{applications:s,languagePackages:g.extract()}}}):p({error:new m("Cannot get the languages catalog")})}isApplication(e){return e.hashCode!==w}}export{M as GetApplicationsMetadataTask};
//# sourceMappingURL=GetApplicationsMetadataTask.js.map
