import{CommandResultFactory as s}from"../../../command/model/CommandResult";import{GLOBAL_ERRORS as w,GlobalCommandError as I}from"../../../command/utils/GlobalCommandError";import{BTC_APP as a,CUSTOM_LOCK_SCREEN_APP as m,DOGECOIN_APP as V,ETH_APP as A,SOLANA_APP as P}from"../../../device-action/__test-utils__/data";import{makeDeviceActionInternalApiMock as d}from"../../../device-action/__test-utils__/makeInternalApi";import{setupGoToDashboardMock as c}from"../../../device-action/__test-utils__/setupTestMachine";import{testDeviceActionStates as l}from"../../../device-action/__test-utils__/testDeviceActionStates";import{DeviceActionStatus as e}from"../../../device-action/model/DeviceActionState";import{UserInteractionRequired as t}from"../../../device-action/model/UserInteractionRequired";import{UnknownDAError as v}from"../../../device-action/os/Errors";import{ListAppsDeviceAction as p}from"./ListAppsDeviceAction";vi.mock("@api/device-action/os/GoToDashboard/GoToDashboardDeviceAction");describe("ListAppsDeviceAction",()=>{const{sendCommand:u}=d();beforeEach(()=>{vi.resetAllMocks()}),describe("success cases",()=>{it("should run the device action with no apps installed",()=>new Promise((i,r)=>{c();const o=new p({input:{}});u.mockResolvedValue(s({data:[]}));const n=[{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.AllowListApps},status:e.Pending},{output:[],status:e.Completed}];l(o,n,d(),{onDone:i,onError:r})})),it("should run the device action with one app installed",()=>new Promise((i,r)=>{c();const o=new p({input:{unlockTimeout:500}});u.mockResolvedValueOnce(s({data:[a]}));const n=[{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.AllowListApps},status:e.Pending},{output:[a],status:e.Completed}];l(o,n,d(),{onDone:i,onError:r})})),it("should run the device action with two app installed",()=>new Promise((i,r)=>{c();const o=new p({input:{unlockTimeout:500}});u.mockResolvedValueOnce(s({data:[a,m]})).mockResolvedValueOnce(s({data:[]}));const n=[{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.AllowListApps},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{output:[a,m],status:e.Completed}];l(o,n,d(),{onDone:i,onError:r})})),it("should run the device action with three app installed",()=>new Promise((i,r)=>{c();const o=new p({input:{unlockTimeout:500}});u.mockResolvedValueOnce(s({data:[a,m]})).mockResolvedValueOnce(s({data:[A]}));const n=[{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.AllowListApps},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{output:[a,m,A],status:e.Completed}];l(o,n,d(),{onDone:i,onError:r})})),it("should run the device action with four app installed",()=>new Promise((i,r)=>{c();const o=new p({input:{unlockTimeout:500}});u.mockResolvedValueOnce(s({data:[a,m]})).mockResolvedValueOnce(s({data:[A,P]})).mockResolvedValueOnce(s({data:[]}));const n=[{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.AllowListApps},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{output:[a,m,A,P],status:e.Completed}];l(o,n,d(),{onDone:i,onError:r})})),it("should run the device action with five app installed",()=>new Promise((i,r)=>{c();const o=new p({input:{unlockTimeout:500}});u.mockResolvedValueOnce(s({data:[a,m]})).mockResolvedValueOnce(s({data:[A,P]})).mockResolvedValueOnce(s({data:[V]}));const n=[{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.AllowListApps},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{output:[a,m,A,P,V],status:e.Completed}];l(o,n,d(),{onDone:i,onError:r})}))}),describe("error cases",()=>{it("should return an error if GoTodashboard fails",()=>new Promise((i,r)=>{c(!0);const o=new p({input:{unlockTimeout:500}});u.mockResolvedValue(s({data:[]}));const n=[{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{error:new v("GoToDashboard failed"),status:e.Error}];l(o,n,d(),{onDone:i,onError:r})})),it("should run the device action if GoTodashboard fails",()=>new Promise((i,r)=>{c(!0);const o=new p({input:{unlockTimeout:500}});u.mockResolvedValue(s({data:[]}));const n=[{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{error:new v("GoToDashboard failed"),status:e.Error}];l(o,n,d(),{onDone:i,onError:r})})),it("should return an error if ListApps fails",()=>new Promise((i,r)=>{c();const o=new p({input:{unlockTimeout:500}}),n=new I({errorCode:"5501",...w[5501]});u.mockResolvedValue(s({error:n}));const D=[{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.AllowListApps},status:e.Pending},{error:n,status:e.Error}];l(o,D,d(),{onDone:i,onError:r})})),it("should return an error if ListAppsContinue fails",()=>new Promise((i,r)=>{c();const o=new p({input:{unlockTimeout:500}});u.mockResolvedValueOnce(s({data:[a,m]})).mockRejectedValueOnce(new v("mocked error"));const n=[{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.AllowListApps},status:e.Pending},{intermediateValue:{requiredUserInteraction:t.None},status:e.Pending},{error:new v("mocked error"),status:e.Error}];l(o,n,d(),{onDone:i,onError:r})}))})});
//# sourceMappingURL=ListAppsDeviceAction.test.js.map
