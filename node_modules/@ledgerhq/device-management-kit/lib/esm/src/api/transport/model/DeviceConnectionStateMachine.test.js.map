{
  "version": 3,
  "sources": ["../../../../../../src/api/transport/model/DeviceConnectionStateMachine.test.ts"],
  "sourcesContent": ["import { Left, Right } from \"purify-ts/Either\";\nimport { afterEach, beforeEach, describe, expect, it, vi } from \"vitest\";\n\nimport { ApduResponse } from \"@api/device-session/ApduResponse\";\n\nimport { type SendApduResult } from \"./DeviceConnection\";\nimport { DeviceConnectionStateMachine } from \"./DeviceConnectionStateMachine\";\nimport {\n  AlreadySendingApduError,\n  DeviceDisconnectedWhileSendingError,\n} from \"./Errors\";\n\ndescribe(\"DeviceConnectionStateMachine\", () => {\n  let machine: DeviceConnectionStateMachine<void>;\n  const mockApduSender = {\n    sendApdu: vi.fn(),\n    getDependencies: vi.fn(),\n    setDependencies: vi.fn(),\n    closeConnection: vi.fn(),\n    setupConnection: vi.fn(),\n  };\n\n  const apduResponse = new ApduResponse({\n    statusCode: Uint8Array.from([0x90, 0x00]),\n    data: new Uint8Array(),\n  });\n  const apduResponseErrorBusy = new ApduResponse({\n    statusCode: Uint8Array.from([0x66, 0x01]),\n    data: new Uint8Array(),\n  });\n\n  beforeEach(() => {\n    vi.useFakeTimers();\n    machine = new DeviceConnectionStateMachine<void>({\n      deviceId: \"deviceId\",\n      deviceApduSender: mockApduSender,\n      timeoutDuration: 1000,\n      tryToReconnect: vi.fn(),\n      onTerminated: vi.fn(),\n    });\n  });\n\n  afterEach(() => {\n    vi.useRealTimers();\n    vi.restoreAllMocks();\n  });\n\n  describe(\"Send APDUs\", () => {\n    it(\"should send APDU successfully\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      mockApduSender.sendApdu.mockResolvedValue(Right(apduResponse));\n\n      // WHEN\n      const result = await machine.sendApdu(apdu);\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(1);\n      expect(result).toStrictEqual(Right(apduResponse));\n    });\n\n    it(\"should send several APDUs successfully\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      const apdu2 = Uint8Array.from([9, 2, 3, 4]);\n      mockApduSender.sendApdu.mockResolvedValue(Right(apduResponse));\n\n      // WHEN\n      const result = await machine.sendApdu(apdu);\n      const result2 = await machine.sendApdu(apdu2);\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(2);\n      expect(result).toStrictEqual(Right(apduResponse));\n      expect(result2).toStrictEqual(Right(apduResponse));\n    });\n\n    it(\"should not send several APDUs in parallel\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      const apdu2 = Uint8Array.from([9, 2, 3, 4]);\n      mockApduSender.sendApdu.mockResolvedValue(Right(apduResponse));\n\n      // WHEN\n      const promise = machine.sendApdu(apdu);\n      const result2 = await machine.sendApdu(apdu2);\n      const result = await promise;\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(1);\n      expect(result).toStrictEqual(Right(apduResponse));\n      expect(result2).toStrictEqual(Left(new AlreadySendingApduError()));\n    });\n\n    it(\"Disconnected while sending APDU\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      mockApduSender.sendApdu.mockResolvedValue(Right(apduResponse));\n\n      // WHEN\n      const promise = machine.sendApdu(apdu);\n      machine.eventDeviceDisconnected();\n      const result = await promise;\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(1);\n      expect(result).toStrictEqual(\n        Left(new DeviceDisconnectedWhileSendingError()),\n      );\n    });\n\n    it(\"Request disconnection while sending APDU\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      mockApduSender.sendApdu.mockResolvedValue(Right(apduResponse));\n\n      // WHEN\n      const promise = machine.sendApdu(apdu);\n      machine.closeConnection();\n      const result = await promise;\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(1);\n      expect(result).toStrictEqual(\n        Left(new DeviceDisconnectedWhileSendingError()),\n      );\n    });\n  });\n\n  describe(\"Send APDUs triggering disconnection\", () => {\n    it(\"should send one APDU successfully\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      mockApduSender.sendApdu.mockResolvedValue(Right(apduResponse));\n\n      // WHEN\n      const result = await machine.sendApdu(apdu, true);\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(2);\n      expect(mockApduSender.sendApdu.mock.calls).toEqual([\n        [apdu, false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined], // GetAppAndVersion APDU sent after a successful result from an APDU that triggers disconnection\n      ]);\n      expect(result).toStrictEqual(Right(apduResponse));\n    });\n\n    it(\"should send several APDUs successfully\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      const apdu2 = Uint8Array.from([9, 2, 3, 4]);\n      mockApduSender.sendApdu\n        .mockResolvedValueOnce(Right(apduResponse))\n        .mockRejectedValueOnce(new Error(\"Transport error\"))\n        .mockResolvedValueOnce(Right(apduResponse));\n\n      // WHEN\n      const promise1 = machine.sendApdu(apdu, true);\n      await Promise.resolve(); // Allow the first APDU to be sent and processed before the disconnection event\n      machine.eventDeviceDisconnected();\n      machine.eventDeviceConnected();\n      const promise2 = machine.sendApdu(apdu2);\n      const result1 = await promise1;\n      const result2 = await promise2;\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(3);\n      expect(mockApduSender.sendApdu.mock.calls).toEqual([\n        [apdu, false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined], // GetAppAndVersion APDU sent after a successful result from an APDU that triggers disconnection\n        [apdu2, false, undefined],\n      ]);\n\n      expect(result1).toStrictEqual(Right(apduResponse));\n      expect(result2).toStrictEqual(Right(apduResponse));\n    });\n\n    it(\"should send a second APDU after reconnection\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      const apdu2 = Uint8Array.from([9, 2, 3, 4]);\n      mockApduSender.sendApdu\n        .mockResolvedValueOnce(Right(apduResponse))\n        .mockRejectedValueOnce(new Error(\"Transport error\"))\n        .mockResolvedValueOnce(Right(apduResponse));\n\n      // WHEN\n      const result = await machine.sendApdu(apdu, true);\n      machine.eventDeviceDisconnected();\n      machine.eventDeviceConnected();\n      const result2 = await machine.sendApdu(apdu2);\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(3);\n      expect(mockApduSender.sendApdu.mock.calls).toEqual([\n        [apdu, false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined], // GetAppAndVersion APDU sent after a successful result from an APDU that triggers disconnection\n        [apdu2, false, undefined],\n      ]);\n      expect(result).toStrictEqual(Right(apduResponse));\n      expect(result2).toStrictEqual(Right(apduResponse));\n    });\n\n    it(\"should send a second APDU without reconnection, after GetAppAndVersion response\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      const apdu2 = Uint8Array.from([9, 2, 3, 4]);\n      mockApduSender.sendApdu\n        .mockResolvedValueOnce(Right(apduResponse))\n        .mockResolvedValueOnce(Right(apduResponse))\n        .mockResolvedValueOnce(Right(apduResponse));\n\n      // WHEN\n      const result = await machine.sendApdu(apdu, true);\n      const result2 = await machine.sendApdu(apdu2);\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(3);\n      expect(mockApduSender.sendApdu.mock.calls).toEqual([\n        [apdu, false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined], // GetAppAndVersion APDU sent after a successful result from an APDU that triggers disconnection\n        [apdu2, false, undefined],\n      ]);\n      expect(result).toStrictEqual(Right(apduResponse));\n      expect(result2).toStrictEqual(Right(apduResponse));\n    });\n\n    it(\"should send a second APDU without reconnection, after GetAppAndVersion retries\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      const apdu2 = Uint8Array.from([9, 2, 3, 4]);\n      mockApduSender.sendApdu\n        .mockResolvedValueOnce(Right(apduResponse))\n        .mockResolvedValueOnce(Right(apduResponseErrorBusy))\n        .mockResolvedValueOnce(Right(apduResponseErrorBusy))\n        .mockResolvedValueOnce(Right(apduResponse))\n        .mockResolvedValueOnce(Right(apduResponse));\n\n      // WHEN\n      const result = await machine.sendApdu(apdu, true);\n      const result2 = await machine.sendApdu(apdu2);\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(5);\n      expect(mockApduSender.sendApdu.mock.calls).toEqual([\n        [apdu, false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined],\n        [apdu2, false, undefined],\n      ]);\n      expect(result).toStrictEqual(Right(apduResponse));\n      expect(result2).toStrictEqual(Right(apduResponse));\n    });\n\n    it(\"should not send several APDUs in parallel\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      const apdu2 = Uint8Array.from([9, 2, 3, 4]);\n      mockApduSender.sendApdu.mockResolvedValue(Right(apduResponse));\n\n      // WHEN\n      const promise = machine.sendApdu(apdu, true);\n      const result2 = await machine.sendApdu(apdu2);\n      const result = await promise;\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(2);\n      expect(mockApduSender.sendApdu.mock.calls).toEqual([\n        [apdu, false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined], // GetAppAndVersion APDU sent after a successful result from an APDU that triggers disconnection\n      ]);\n      expect(result).toStrictEqual(Right(apduResponse));\n      expect(result2).toStrictEqual(Left(new AlreadySendingApduError()));\n    });\n\n    it(\"should send another APDU in promise handler\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      const apdu2 = Uint8Array.from([9, 2, 3, 4]);\n      mockApduSender.sendApdu.mockResolvedValue(Right(apduResponse));\n\n      // WHEN\n      let promise: Promise<SendApduResult> | undefined = undefined;\n      const result = await machine.sendApdu(apdu, true).then((value) => {\n        promise = machine.sendApdu(apdu2);\n        return value;\n      });\n      machine.eventDeviceDisconnected();\n      machine.eventDeviceConnected();\n      const result2 = await promise!;\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(3);\n      expect(mockApduSender.sendApdu.mock.calls).toEqual([\n        [apdu, false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined], // GetAppAndVersion APDU sent after a successful result from an APDU that triggers disconnection\n        [apdu2, false, undefined],\n      ]);\n      expect(result).toStrictEqual(Right(apduResponse));\n      expect(result2).toStrictEqual(Right(apduResponse));\n    });\n\n    it(\"send an APDU while device is reconnecting\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      mockApduSender.sendApdu.mockResolvedValue(Right(apduResponse));\n\n      // WHEN\n      machine.eventDeviceDisconnected();\n      const promise = machine.sendApdu(apdu, true);\n      machine.eventDeviceConnected();\n      const result = await promise;\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(2);\n      expect(mockApduSender.sendApdu.mock.calls).toEqual([\n        [apdu, false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined], // GetAppAndVersion APDU sent after a successful result from an APDU that triggers disconnection\n      ]);\n      expect(result).toStrictEqual(Right(apduResponse));\n    });\n\n    it(\"Close while an APDU is waiting for reconnection\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      const apdu2 = Uint8Array.from([9, 2, 3, 4]);\n      mockApduSender.sendApdu.mockResolvedValue(Right(apduResponse));\n\n      // WHEN\n      let promise: Promise<SendApduResult> | undefined = undefined;\n      const promise1 = machine.sendApdu(apdu, true);\n      await Promise.resolve(); // Allow the first APDU promise to resolve before triggering disconnection\n      machine.eventDeviceDisconnected();\n      const result1 = await promise1;\n      promise = machine.sendApdu(apdu2);\n      machine.closeConnection();\n      const result2 = await promise!;\n\n      // THEN\n      // expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(2);\n      expect(mockApduSender.sendApdu.mock.calls).toEqual([\n        [apdu, false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined], // GetAppAndVersion APDU sent after a successful result from an APDU that triggers disconnection\n      ]);\n      expect(result1).toStrictEqual(Right(apduResponse));\n      expect(result2).toStrictEqual(\n        Left(new DeviceDisconnectedWhileSendingError()),\n      );\n    });\n  });\n});\n"],
  "mappings": "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",
  "names": ["Left", "Right", "afterEach", "beforeEach", "describe", "expect", "it", "vi", "ApduResponse", "DeviceConnectionStateMachine", "AlreadySendingApduError", "DeviceDisconnectedWhileSendingError", "machine", "mockApduSender", "apduResponse", "apduResponseErrorBusy", "apdu", "result", "apdu2", "result2", "promise", "promise1", "promise2", "result1", "value"]
}
