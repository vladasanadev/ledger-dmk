{
  "version": 3,
  "sources": ["../../../../../src/api/secure-channel/utils.ts"],
  "sourcesContent": ["import { ApduParser } from \"@api/apdu/utils/ApduParser\";\nimport { type ApduResponse } from \"@api/device-session/ApduResponse\";\nimport { GENUINE_DEVICE_RESULT } from \"@api/secure-channel/constants\";\nimport { type SecureChannelEventPayload } from \"@api/secure-channel/task/types\";\n\n/**\n * Checks if the given APDU command will request permission.\n *\n * This method checks if the first byte of the APDU command is `0xe0` and the second byte is `0x51`.\n *\n * @param apdu - The APDU command as a Uint8Array.\n * @returns `true` if the APDU command will request permission, otherwise `false`.\n */\nexport function willRequestPermission(apdu: Uint8Array): boolean {\n  return apdu[0] === 0xe0 && apdu[1] === 0x51;\n}\n\n/**\n * Checks if the given APDU command is a GetCertificate command.\n *\n * This method checks if the first byte of the APDU command is `0xe0` and the second byte is `0x52`.\n *\n * @param apdu - The APDU command as a Uint8Array.\n * @returns `true` if the APDU command is a GetCertificate command, otherwise `false`.\n */\nexport function isGetCertificateApdu(apdu: Uint8Array): boolean {\n  return apdu[0] === 0xe0 && apdu[1] === 0x52;\n}\n\n/**\n * Extract the public key from a GetCertificate response.\n *\n * @param apduResponse - The APDU response containing the certificate data.\n * @returns The extracted public key as a Uint8Array, or null if extraction fails.\n */\nexport function extractPublicKey(\n  apduResponse: ApduResponse,\n): Uint8Array | null {\n  try {\n    const parser = new ApduParser(apduResponse);\n\n    // Skip header (length-value encoded)\n    const header = parser.extractFieldLVEncoded();\n    if (!header) {\n      return null;\n    }\n\n    // Extract public key (length-value encoded)\n    const publicKey = parser.extractFieldLVEncoded();\n    return publicKey ?? null;\n  } catch (_error) {\n    return null;\n  }\n}\n\n/**\n * Checks if the device is genuine.\n *\n * @param payload - The payload of the result secure channel event.\n * The payload has already been stringified, so that the type check is not necessary.\n * @returns `true` if the device is genuine, otherwise `false`.\n */\nexport function isDeviceGenuine(payload: SecureChannelEventPayload[\"Result\"]) {\n  return payload === GENUINE_DEVICE_RESULT;\n}\n"],
  "mappings": "AAAA,OAAS,cAAAA,MAAkB,6BAE3B,OAAS,yBAAAC,MAA6B,gCAW/B,SAASC,EAAsBC,EAA2B,CAC/D,OAAOA,EAAK,CAAC,IAAM,KAAQA,EAAK,CAAC,IAAM,EACzC,CAUO,SAASC,EAAqBD,EAA2B,CAC9D,OAAOA,EAAK,CAAC,IAAM,KAAQA,EAAK,CAAC,IAAM,EACzC,CAQO,SAASE,EACdC,EACmB,CACnB,GAAI,CACF,MAAMC,EAAS,IAAIP,EAAWM,CAAY,EAI1C,OADeC,EAAO,sBAAsB,EAM1BA,EAAO,sBAAsB,GAC3B,KALX,IAMX,MAAiB,CACf,OAAO,IACT,CACF,CASO,SAASC,EAAgBC,EAA8C,CAC5E,OAAOA,IAAYR,CACrB",
  "names": ["ApduParser", "GENUINE_DEVICE_RESULT", "willRequestPermission", "apdu", "isGetCertificateApdu", "extractPublicKey", "apduResponse", "parser", "isDeviceGenuine", "payload"]
}
