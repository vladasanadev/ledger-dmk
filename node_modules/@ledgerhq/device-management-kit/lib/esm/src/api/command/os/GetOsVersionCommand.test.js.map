{
  "version": 3,
  "sources": ["../../../../../../src/api/command/os/GetOsVersionCommand.test.ts"],
  "sourcesContent": ["import {\n  CommandResultFactory,\n  isSuccessCommandResult,\n} from \"@api/command/model/CommandResult\";\nimport { DeviceModelId } from \"@api/device/DeviceModel\";\nimport { ApduResponse } from \"@api/device-session/ApduResponse\";\n\nimport { getOsVersionCommandResponseMockBuilder } from \"./__mocks__/GetOsVersionCommand\";\nimport { GetOsVersionCommand } from \"./GetOsVersionCommand\";\n\nconst GET_OS_VERSION_APDU = Uint8Array.from([0xe0, 0x01, 0x00, 0x00, 0x00]);\n\nconst LNX_RESPONSE_DATA_GOOD = Uint8Array.from([\n  0x33, 0x00, 0x00, 0x04, 0x05, 0x32, 0x2e, 0x32, 0x2e, 0x33, 0x04, 0xe6, 0x00,\n  0x00, 0x00, 0x04, 0x32, 0x2e, 0x33, 0x30, 0x04, 0x31, 0x2e, 0x31, 0x36, 0x01,\n  0x00, 0x01, 0x00, 0x01, 0x00, 0x90, 0x00,\n]);\nconst LNX_RESPONSE_GOOD = new ApduResponse({\n  statusCode: Uint8Array.from([0x90, 0x00]),\n  data: LNX_RESPONSE_DATA_GOOD,\n});\n\nconst LNSP_REPONSE_DATA_GOOD = Uint8Array.from([\n  0x33, 0x10, 0x00, 0x04, 0x05, 0x31, 0x2e, 0x31, 0x2e, 0x31, 0x04, 0xe6, 0x00,\n  0x00, 0x00, 0x04, 0x34, 0x2e, 0x30, 0x33, 0x04, 0x33, 0x2e, 0x31, 0x32, 0x01,\n  0x00, 0x01, 0x00, 0x90, 0x00,\n]);\nconst LNSP_RESPONSE_GOOD = new ApduResponse({\n  statusCode: Uint8Array.from([0x90, 0x00]),\n  data: LNSP_REPONSE_DATA_GOOD,\n});\n\nconst STAX_RESPONSE_DATA_GOOD = Uint8Array.from([\n  0x33, 0x20, 0x00, 0x04, 0x05, 0x31, 0x2e, 0x33, 0x2e, 0x30, 0x04, 0xe6, 0x00,\n  0x00, 0x00, 0x04, 0x35, 0x2e, 0x32, 0x34, 0x04, 0x30, 0x2e, 0x34, 0x38, 0x01,\n  0x00, 0x01, 0x00, 0x90, 0x00,\n]);\nconst STAX_RESPONSE_GOOD = new ApduResponse({\n  statusCode: Uint8Array.from([0x90, 0x00]),\n  data: STAX_RESPONSE_DATA_GOOD,\n});\n\nconst BL_RESPONSE_DATA_GOOD = Uint8Array.from([\n  0x05, 0x01, 0x00, 0x03, 0x04, 0x31, 0x2e, 0x31, 0x36, 0x04, 0xf4, 0xd8, 0xaa,\n  0x43, 0x05, 0x32, 0x2e, 0x32, 0x2e, 0x33, 0x04, 0x33, 0x00, 0x00, 0x04, 0x90,\n  0x00,\n]);\nconst BL_RESPONSE_GOOD = new ApduResponse({\n  statusCode: Uint8Array.from([0x90, 0x00]),\n  data: BL_RESPONSE_DATA_GOOD,\n});\n\nconst OLD_FM_RESPONSE_DATA_GOOD = Uint8Array.from([\n  0x33, 0x00, 0x00, 0x04, 0x00, 0x04, 0xee, 0x00, 0x00, 0x00, 0x04, 0x32, 0x2e,\n  0x33, 0x30, 0x01, 0x01, 0x01, 0x00, 0x01, 0x00, 0x90, 0x00,\n]);\nconst OLD_FM_RESPONSE_GOOD = new ApduResponse({\n  statusCode: Uint8Array.from([0x90, 0x00]),\n  data: OLD_FM_RESPONSE_DATA_GOOD,\n});\n\ndescribe(\"GetOsVersionCommand\", () => {\n  let command: GetOsVersionCommand;\n\n  beforeEach(() => {\n    command = new GetOsVersionCommand();\n  });\n\n  describe(\"name\", () => {\n    it(\"should be 'getOsVersion'\", () => {\n      expect(command.name).toBe(\"getOsVersion\");\n    });\n  });\n\n  describe(\"getApdu\", () => {\n    it(\"should return the GetOsVersion apdu\", () => {\n      const apdu = command.getApdu();\n      expect(apdu.getRawApdu()).toStrictEqual(GET_OS_VERSION_APDU);\n    });\n  });\n\n  describe(\"parseResponse\", () => {\n    describe(\"Nano X\", () => {\n      it(\"should parse the LNX response\", () => {\n        const parsed = command.parseResponse(\n          LNX_RESPONSE_GOOD,\n          DeviceModelId.NANO_X,\n        );\n\n        const expected = CommandResultFactory({\n          data: getOsVersionCommandResponseMockBuilder(DeviceModelId.NANO_X),\n        });\n\n        expect(parsed).toStrictEqual(expected);\n      });\n    });\n\n    describe(\"Nano S Plus\", () => {\n      it(\"should parse the LNSP response\", () => {\n        const parsed = command.parseResponse(\n          LNSP_RESPONSE_GOOD,\n          DeviceModelId.NANO_SP,\n        );\n\n        const expected = CommandResultFactory({\n          data: getOsVersionCommandResponseMockBuilder(DeviceModelId.NANO_SP),\n        });\n\n        expect(parsed).toStrictEqual(expected);\n      });\n    });\n\n    describe(\"Stax\", () => {\n      it(\"should parse the STAX response\", () => {\n        const parsed = command.parseResponse(\n          STAX_RESPONSE_GOOD,\n          DeviceModelId.STAX,\n        );\n\n        const expected = CommandResultFactory({\n          data: getOsVersionCommandResponseMockBuilder(DeviceModelId.STAX),\n        });\n\n        expect(parsed).toStrictEqual(expected);\n      });\n    });\n\n    describe(\"Bootloader\", () => {\n      it(\"should parse the bootloader response\", () => {\n        const parsed = command.parseResponse(\n          BL_RESPONSE_GOOD,\n          DeviceModelId.STAX,\n        );\n\n        const expected = CommandResultFactory({\n          data: {\n            isBootloader: true,\n            isOsu: false,\n            targetId: 83951619,\n            seTargetId: 855638020,\n            seVersion: \"2.2.3\",\n            seFlags: new Uint8Array([0xf4, 0xd8, 0xaa, 0x43]),\n            mcuTargetId: 83951619,\n            mcuSephVersion: \"\",\n            mcuBootloaderVersion: \"1.16\",\n            hwVersion: \"\",\n            langId: undefined,\n            recoverState: undefined,\n            secureElementFlags: {\n              isPinValidated: true,\n              hasMcuSerialNumber: true,\n              hasValidCertificate: true,\n              isCustomAuthorityConnectionAllowed: true,\n              isSecureConnectionAllowed: false,\n              isOnboarded: true,\n              isMcuCodeSigned: false,\n              isInRecoveryMode: false,\n            },\n          },\n        });\n\n        expect(parsed).toStrictEqual(expected);\n      });\n    });\n\n    describe(\"Old firmware\", () => {\n      it(\"should parse the old firmware response\", () => {\n        const parsed = command.parseResponse(\n          OLD_FM_RESPONSE_GOOD,\n          DeviceModelId.NANO_X,\n        );\n\n        const expected = CommandResultFactory({\n          data: {\n            isBootloader: false,\n            isOsu: false,\n            targetId: 855638020,\n            seTargetId: 855638020,\n            seVersion: \"0.0.0\",\n            seFlags: new Uint8Array(),\n            mcuTargetId: undefined,\n            mcuSephVersion: \"2.30\",\n            mcuBootloaderVersion: \"\",\n            hwVersion: \"00\",\n            langId: undefined,\n            recoverState: undefined,\n            secureElementFlags: {\n              isPinValidated: true,\n              hasMcuSerialNumber: true,\n              hasValidCertificate: true,\n              isCustomAuthorityConnectionAllowed: false,\n              isSecureConnectionAllowed: true,\n              isOnboarded: true,\n              isMcuCodeSigned: true,\n              isInRecoveryMode: false,\n            },\n          },\n        });\n\n        expect(parsed).toStrictEqual(expected);\n      });\n    });\n\n    describe(\"Error handling\", () => {\n      it(\"should return an error if the response is not successful\", () => {\n        const response = new ApduResponse({\n          statusCode: Uint8Array.from([0x6e, 0x80]),\n          data: Uint8Array.from([]),\n        });\n        const result = command.parseResponse(response, DeviceModelId.NANO_S);\n\n        expect(isSuccessCommandResult(result)).toBeFalsy();\n      });\n    });\n  });\n});\n"],
  "mappings": "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",
  "names": ["CommandResultFactory", "isSuccessCommandResult", "DeviceModelId", "ApduResponse", "getOsVersionCommandResponseMockBuilder", "GetOsVersionCommand", "GET_OS_VERSION_APDU", "LNX_RESPONSE_DATA_GOOD", "LNX_RESPONSE_GOOD", "LNSP_REPONSE_DATA_GOOD", "LNSP_RESPONSE_GOOD", "STAX_RESPONSE_DATA_GOOD", "STAX_RESPONSE_GOOD", "BL_RESPONSE_DATA_GOOD", "BL_RESPONSE_GOOD", "OLD_FM_RESPONSE_DATA_GOOD", "OLD_FM_RESPONSE_GOOD", "command", "apdu", "parsed", "expected", "response", "result"]
}
