{
  "version": 3,
  "sources": ["../../../../../../src/api/command/os/ListLanguagePackCommand.ts"],
  "sourcesContent": ["import { type Apdu } from \"@api/apdu/model/Apdu\";\nimport { ApduBuilder, type ApduBuilderArgs } from \"@api/apdu/utils/ApduBuilder\";\nimport { ApduParser } from \"@api/apdu/utils/ApduParser\";\nimport { type Command } from \"@api/command/Command\";\nimport { InvalidStatusWordError } from \"@api/command/Errors\";\nimport {\n  type CommandResult,\n  CommandResultFactory,\n} from \"@api/command/model/CommandResult\";\nimport {\n  type CommandErrors,\n  isCommandErrorCode,\n} from \"@api/command/utils/CommandErrors\";\nimport { CommandUtils } from \"@api/command/utils/CommandUtils\";\nimport { GlobalCommandErrorHandler } from \"@api/command/utils/GlobalCommandError\";\nimport { type ApduResponse } from \"@api/device-session/ApduResponse\";\nimport { type CommandErrorArgs, DeviceExchangeError } from \"@api/Error\";\nimport { bufferToHexaString } from \"@api/utils/HexaString\";\n\nexport type ListLanguagePackCommandArgs = {\n  readonly firstChunk: boolean;\n};\n\nexport type ListLanguagePackResponse =\n  | {\n      readonly id: number;\n      readonly size: number;\n    }\n  | undefined;\n\nexport type ListLanguagePackErrorCodes = \"662d\";\n\nconst LANGUAGE_PACK_ERRORS: CommandErrors<ListLanguagePackErrorCodes> = {\n  \"662d\": {\n    message:\n      \"Invalid LIST_ARG, first command must be sent with P1_LIST_LANGUAGE_PACKS_FIRST.\",\n  },\n};\n\nexport type ListLanguagePackCommandResult = CommandResult<\n  ListLanguagePackResponse,\n  ListLanguagePackErrorCodes\n>;\n\nexport class ListLanguagePackCommandError extends DeviceExchangeError<ListLanguagePackErrorCodes> {\n  constructor({\n    message,\n    errorCode,\n  }: CommandErrorArgs<ListLanguagePackErrorCodes>) {\n    super({ message, errorCode, tag: \"ListLanguagePackCommandError\" });\n  }\n}\n\nexport class ListLanguagePackCommand\n  implements\n    Command<\n      ListLanguagePackResponse,\n      ListLanguagePackCommandArgs,\n      ListLanguagePackErrorCodes\n    >\n{\n  readonly name = \"listLanguagePack\";\n\n  constructor(private args: ListLanguagePackCommandArgs) {}\n\n  getApdu(): Apdu {\n    const apduArgs: ApduBuilderArgs = {\n      cla: 0xe0,\n      ins: 0x34,\n      p1: this.args.firstChunk ? 0x00 : 0x01,\n      p2: 0x00,\n    };\n    return new ApduBuilder(apduArgs).build();\n  }\n\n  parseResponse(apduResponse: ApduResponse): ListLanguagePackCommandResult {\n    const parser = new ApduParser(apduResponse);\n\n    if (!CommandUtils.isSuccessResponse(apduResponse)) {\n      const errorCode = parser.encodeToHexaString(apduResponse.statusCode);\n      if (isCommandErrorCode(errorCode, LANGUAGE_PACK_ERRORS)) {\n        return CommandResultFactory({\n          error: new ListLanguagePackCommandError({\n            ...LANGUAGE_PACK_ERRORS[errorCode],\n            errorCode,\n          }),\n        });\n      }\n      return CommandResultFactory({\n        error: GlobalCommandErrorHandler.handle(apduResponse),\n      });\n    }\n\n    const tlvVersion = parser.extract8BitUInt();\n    if (tlvVersion === undefined) {\n      // No more language package\n      return CommandResultFactory({\n        data: undefined,\n      });\n    }\n\n    parser.extract8BitUInt(); // total length\n    const idBuffer = parser.extractFieldLVEncoded();\n    if (idBuffer === undefined) {\n      return CommandResultFactory({\n        error: new InvalidStatusWordError(\"Failed to get language pack id\"),\n      });\n    }\n\n    const sizeBuffer = parser.extractFieldLVEncoded();\n    if (sizeBuffer === undefined) {\n      return CommandResultFactory({\n        error: new InvalidStatusWordError(\"Failed to get language pack size\"),\n      });\n    }\n\n    const id = parseInt(bufferToHexaString(idBuffer), 16);\n    const size = parseInt(bufferToHexaString(sizeBuffer), 16);\n    return CommandResultFactory({\n      data: { id, size },\n    });\n  }\n}\n"],
  "mappings": "AACA,OAAS,eAAAA,MAAyC,8BAClD,OAAS,cAAAC,MAAkB,6BAE3B,OAAS,0BAAAC,MAA8B,sBACvC,OAEE,wBAAAC,MACK,mCACP,OAEE,sBAAAC,MACK,mCACP,OAAS,gBAAAC,MAAoB,kCAC7B,OAAS,6BAAAC,MAAiC,wCAE1C,OAAgC,uBAAAC,MAA2B,aAC3D,OAAS,sBAAAC,MAA0B,wBAenC,MAAMC,EAAkE,CACtE,OAAQ,CACN,QACE,iFACJ,CACF,EAOO,MAAMC,UAAqCH,CAAgD,CAChG,YAAY,CACV,QAAAI,EACA,UAAAC,CACF,EAAiD,CAC/C,MAAM,CAAE,QAAAD,EAAS,UAAAC,EAAW,IAAK,8BAA+B,CAAC,CACnE,CACF,CAEO,MAAMC,CAOb,CAGE,YAAoBC,EAAmC,CAAnC,UAAAA,CAAoC,CAF/C,KAAO,mBAIhB,SAAgB,CACd,MAAMC,EAA4B,CAChC,IAAK,IACL,IAAK,GACL,GAAI,KAAK,KAAK,WAAa,EAAO,EAClC,GAAI,CACN,EACA,OAAO,IAAIf,EAAYe,CAAQ,EAAE,MAAM,CACzC,CAEA,cAAcC,EAA2D,CACvE,MAAMC,EAAS,IAAIhB,EAAWe,CAAY,EAE1C,GAAI,CAACX,EAAa,kBAAkBW,CAAY,EAAG,CACjD,MAAMJ,EAAYK,EAAO,mBAAmBD,EAAa,UAAU,EACnE,OAAIZ,EAAmBQ,EAAWH,CAAoB,EAC7CN,EAAqB,CAC1B,MAAO,IAAIO,EAA6B,CACtC,GAAGD,EAAqBG,CAAS,EACjC,UAAAA,CACF,CAAC,CACH,CAAC,EAEIT,EAAqB,CAC1B,MAAOG,EAA0B,OAAOU,CAAY,CACtD,CAAC,CACH,CAGA,GADmBC,EAAO,gBAAgB,IACvB,OAEjB,OAAOd,EAAqB,CAC1B,KAAM,MACR,CAAC,EAGHc,EAAO,gBAAgB,EACvB,MAAMC,EAAWD,EAAO,sBAAsB,EAC9C,GAAIC,IAAa,OACf,OAAOf,EAAqB,CAC1B,MAAO,IAAID,EAAuB,gCAAgC,CACpE,CAAC,EAGH,MAAMiB,EAAaF,EAAO,sBAAsB,EAChD,GAAIE,IAAe,OACjB,OAAOhB,EAAqB,CAC1B,MAAO,IAAID,EAAuB,kCAAkC,CACtE,CAAC,EAGH,MAAMkB,EAAK,SAASZ,EAAmBU,CAAQ,EAAG,EAAE,EAC9CG,EAAO,SAASb,EAAmBW,CAAU,EAAG,EAAE,EACxD,OAAOhB,EAAqB,CAC1B,KAAM,CAAE,GAAAiB,EAAI,KAAAC,CAAK,CACnB,CAAC,CACH,CACF",
  "names": ["ApduBuilder", "ApduParser", "InvalidStatusWordError", "CommandResultFactory", "isCommandErrorCode", "CommandUtils", "GlobalCommandErrorHandler", "DeviceExchangeError", "bufferToHexaString", "LANGUAGE_PACK_ERRORS", "ListLanguagePackCommandError", "message", "errorCode", "ListLanguagePackCommand", "args", "apduArgs", "apduResponse", "parser", "idBuffer", "sizeBuffer", "id", "size"]
}
