{
  "version": 3,
  "sources": ["../../../../../../src/api/command/utils/CommandUtils.ts"],
  "sourcesContent": ["import { type ApduResponse } from \"@api/device-session/ApduResponse\";\n\nexport class CommandUtils {\n  static isValidStatusCode(statusCode: Uint8Array) {\n    return statusCode.length === 2;\n  }\n\n  static isSuccessResponse({ statusCode }: ApduResponse) {\n    if (!CommandUtils.isValidStatusCode(statusCode)) {\n      return false;\n    }\n\n    return statusCode[0] === 0x90 && statusCode[1] === 0x00;\n  }\n\n  static isLockedDeviceResponse({ statusCode }: ApduResponse) {\n    if (!CommandUtils.isValidStatusCode(statusCode)) {\n      return false;\n    }\n\n    return (\n      (statusCode[0] === 0x55 && statusCode[1] === 0x15) ||\n      (statusCode[0] === 0x69 && statusCode[1] === 0x82) ||\n      (statusCode[0] === 0x53 && statusCode[1] === 0x03)\n    );\n  }\n\n  static isRefusedByUser({ statusCode }: ApduResponse) {\n    if (!CommandUtils.isValidStatusCode(statusCode)) {\n      return false;\n    }\n\n    return (\n      (statusCode[0] === 0x55 && statusCode[1] === 0x01) ||\n      (statusCode[0] === 0x69 && statusCode[1] === 0x85)\n    );\n  }\n\n  static isAppAlreadyInstalled({ statusCode }: ApduResponse) {\n    if (!CommandUtils.isValidStatusCode(statusCode)) {\n      return false;\n    }\n\n    return (\n      (statusCode[0] === 0x6a && statusCode[1] === 0x80) ||\n      (statusCode[0] === 0x6a && statusCode[1] === 0x81) ||\n      (statusCode[0] === 0x6a && statusCode[1] === 0x8e) ||\n      (statusCode[0] === 0x6a && statusCode[1] === 0x8f)\n    );\n  }\n\n  static isOutOfMemory({ statusCode }: ApduResponse) {\n    if (!CommandUtils.isValidStatusCode(statusCode)) {\n      return false;\n    }\n\n    return (\n      (statusCode[0] === 0x6a && statusCode[1] === 0x84) ||\n      (statusCode[0] === 0x6a && statusCode[1] === 0x85) ||\n      (statusCode[0] === 0x51 && statusCode[1] === 0x02) ||\n      (statusCode[0] === 0x51 && statusCode[1] === 0x03)\n    );\n  }\n\n  static isApduThatTriggersDisconnection(apdu: Uint8Array) {\n    /**\n     * Map of known APDUs that trigger a disconnection.\n     */\n    const apduMap = new Map();\n    apduMap.set(\"openApp\", new Uint8Array([0xe0, 0xd8, 0x00, 0x00]));\n    apduMap.set(\"closeApp\", new Uint8Array([0xb0, 0xa7, 0x00, 0x00]));\n    // TODO: add more APDUs that trigger a disconnection (e.g firmware flashing ?)\n\n    // check if apdu first 4 UintArray is included in apduMap\n    return Array.from(apduMap.values()).some((value: Uint8Array) => {\n      for (let i = 0; i < 4; i++) {\n        if (value[i] !== apdu[i]) {\n          return false;\n        }\n      }\n      return true;\n    });\n  }\n}\n"],
  "mappings": "AAEO,MAAMA,CAAa,CACxB,OAAO,kBAAkBC,EAAwB,CAC/C,OAAOA,EAAW,SAAW,CAC/B,CAEA,OAAO,kBAAkB,CAAE,WAAAA,CAAW,EAAiB,CACrD,OAAKD,EAAa,kBAAkBC,CAAU,EAIvCA,EAAW,CAAC,IAAM,KAAQA,EAAW,CAAC,IAAM,EAH1C,EAIX,CAEA,OAAO,uBAAuB,CAAE,WAAAA,CAAW,EAAiB,CAC1D,OAAKD,EAAa,kBAAkBC,CAAU,EAK3CA,EAAW,CAAC,IAAM,IAAQA,EAAW,CAAC,IAAM,IAC5CA,EAAW,CAAC,IAAM,KAAQA,EAAW,CAAC,IAAM,KAC5CA,EAAW,CAAC,IAAM,IAAQA,EAAW,CAAC,IAAM,EANtC,EAQX,CAEA,OAAO,gBAAgB,CAAE,WAAAA,CAAW,EAAiB,CACnD,OAAKD,EAAa,kBAAkBC,CAAU,EAK3CA,EAAW,CAAC,IAAM,IAAQA,EAAW,CAAC,IAAM,GAC5CA,EAAW,CAAC,IAAM,KAAQA,EAAW,CAAC,IAAM,IALtC,EAOX,CAEA,OAAO,sBAAsB,CAAE,WAAAA,CAAW,EAAiB,CACzD,OAAKD,EAAa,kBAAkBC,CAAU,EAK3CA,EAAW,CAAC,IAAM,KAAQA,EAAW,CAAC,IAAM,KAC5CA,EAAW,CAAC,IAAM,KAAQA,EAAW,CAAC,IAAM,KAC5CA,EAAW,CAAC,IAAM,KAAQA,EAAW,CAAC,IAAM,KAC5CA,EAAW,CAAC,IAAM,KAAQA,EAAW,CAAC,IAAM,IAPtC,EASX,CAEA,OAAO,cAAc,CAAE,WAAAA,CAAW,EAAiB,CACjD,OAAKD,EAAa,kBAAkBC,CAAU,EAK3CA,EAAW,CAAC,IAAM,KAAQA,EAAW,CAAC,IAAM,KAC5CA,EAAW,CAAC,IAAM,KAAQA,EAAW,CAAC,IAAM,KAC5CA,EAAW,CAAC,IAAM,IAAQA,EAAW,CAAC,IAAM,GAC5CA,EAAW,CAAC,IAAM,IAAQA,EAAW,CAAC,IAAM,EAPtC,EASX,CAEA,OAAO,gCAAgCC,EAAkB,CAIvD,MAAMC,EAAU,IAAI,IACpB,OAAAA,EAAQ,IAAI,UAAW,IAAI,WAAW,CAAC,IAAM,IAAM,EAAM,CAAI,CAAC,CAAC,EAC/DA,EAAQ,IAAI,WAAY,IAAI,WAAW,CAAC,IAAM,IAAM,EAAM,CAAI,CAAC,CAAC,EAIzD,MAAM,KAAKA,EAAQ,OAAO,CAAC,EAAE,KAAMC,GAAsB,CAC9D,QAAS,EAAI,EAAG,EAAI,EAAG,IACrB,GAAIA,EAAM,CAAC,IAAMF,EAAK,CAAC,EACrB,MAAO,GAGX,MAAO,EACT,CAAC,CACH,CACF",
  "names": ["CommandUtils", "statusCode", "apdu", "apduMap", "value"]
}
