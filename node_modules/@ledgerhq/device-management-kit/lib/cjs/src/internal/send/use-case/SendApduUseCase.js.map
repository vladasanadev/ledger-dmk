{
  "version": 3,
  "sources": ["../../../../../../src/internal/send/use-case/SendApduUseCase.ts"],
  "sourcesContent": ["import { inject, injectable } from \"inversify\";\n\nimport { ApduResponse } from \"@api/device-session/ApduResponse\";\nimport { type LoggerPublisherService } from \"@api/logger-publisher/service/LoggerPublisherService\";\nimport { DeviceSessionId } from \"@api/types\";\nimport { deviceSessionTypes } from \"@internal/device-session/di/deviceSessionTypes\";\nimport type { DeviceSessionService } from \"@internal/device-session/service/DeviceSessionService\";\nimport { loggerTypes } from \"@internal/logger-publisher/di/loggerTypes\";\n\n/**\n * The arguments for the SendApduUseCase.\n */\nexport type SendApduUseCaseArgs = {\n  /**\n   * Device session identifier from `DeviceManagementKit.connect`.\n   */\n  sessionId: DeviceSessionId;\n  /**\n   * Raw APDU to send to the device.\n   */\n  apdu: Uint8Array;\n  /**\n   * The time, in milliseconds, to wait before aborting an operation.\n   */\n  abortTimeout?: number;\n  /**\n   * Indicates if a device disconnection should be expected after sending the APDU.\n   */\n  triggersDisconnection?: boolean;\n};\n\n/**\n * Sends an APDU to a connected device.\n */\n@injectable()\nexport class SendApduUseCase {\n  private readonly _sessionService: DeviceSessionService;\n  private readonly _logger: LoggerPublisherService;\n\n  constructor(\n    @inject(deviceSessionTypes.DeviceSessionService)\n    sessionService: DeviceSessionService,\n    @inject(loggerTypes.LoggerPublisherServiceFactory)\n    loggerFactory: (tag: string) => LoggerPublisherService,\n  ) {\n    this._sessionService = sessionService;\n    this._logger = loggerFactory(\"SendApduUseCase\");\n  }\n\n  async execute({\n    sessionId,\n    apdu,\n    abortTimeout,\n    triggersDisconnection,\n  }: SendApduUseCaseArgs): Promise<ApduResponse> {\n    const deviceSessionOrError =\n      this._sessionService.getDeviceSessionById(sessionId);\n\n    return deviceSessionOrError.caseOf({\n      // Case device session found\n      Right: async (deviceSession) => {\n        const response = await deviceSession.sendApdu(apdu, {\n          abortTimeout,\n          triggersDisconnection,\n        });\n        return response.caseOf({\n          // Case APDU sent and response received successfully\n          Right: (data) => data,\n          // Case error sending or receiving APDU\n          Left: (error) => {\n            this._logger.error(\"Error sending APDU\", {\n              data: { sessionId, apdu, error },\n            });\n            throw error;\n          },\n        });\n      },\n      // Case device session not found\n      Left: (error) => {\n        this._logger.error(\"Error getting deviceSession\", {\n          data: { error },\n        });\n        throw error;\n      },\n    });\n  }\n}\n"],
  "mappings": "okBAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,qBAAAE,IAAA,eAAAC,EAAAH,GAAA,IAAAI,EAAmC,qBAKnCC,EAAmC,0DAEnCC,EAA4B,qDA4BrB,IAAMC,EAAN,KAAsB,CACV,gBACA,QAEjB,YAEEC,EAEAC,EACA,CACA,KAAK,gBAAkBD,EACvB,KAAK,QAAUC,EAAc,iBAAiB,CAChD,CAEA,MAAM,QAAQ,CACZ,UAAAC,EACA,KAAAC,EACA,aAAAC,EACA,sBAAAC,CACF,EAA+C,CAI7C,OAFE,KAAK,gBAAgB,qBAAqBH,CAAS,EAEzB,OAAO,CAEjC,MAAO,MAAOI,IACK,MAAMA,EAAc,SAASH,EAAM,CAClD,aAAAC,EACA,sBAAAC,CACF,CAAC,GACe,OAAO,CAErB,MAAQE,GAASA,EAEjB,KAAOC,GAAU,CACf,WAAK,QAAQ,MAAM,qBAAsB,CACvC,KAAM,CAAE,UAAAN,EAAW,KAAAC,EAAM,MAAAK,CAAM,CACjC,CAAC,EACKA,CACR,CACF,CAAC,EAGH,KAAOA,GAAU,CACf,WAAK,QAAQ,MAAM,8BAA+B,CAChD,KAAM,CAAE,MAAAA,CAAM,CAChB,CAAC,EACKA,CACR,CACF,CAAC,CACH,CACF,EAnDaT,EAANU,EAAA,IADN,cAAW,EAMPC,EAAA,eAAO,qBAAmB,oBAAoB,GAE9CA,EAAA,eAAO,cAAY,6BAA6B,IAPxCX",
  "names": ["SendApduUseCase_exports", "__export", "SendApduUseCase", "__toCommonJS", "import_inversify", "import_deviceSessionTypes", "import_loggerTypes", "SendApduUseCase", "sessionService", "loggerFactory", "sessionId", "apdu", "abortTimeout", "triggersDisconnection", "deviceSession", "data", "error", "__decorateClass", "__decorateParam"]
}
