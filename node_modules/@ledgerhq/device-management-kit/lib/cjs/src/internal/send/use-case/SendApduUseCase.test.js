"use strict";var f=require("purify-ts"),l=require("../../../api/transport/model/TransportConnectedDevice.stub"),u=require("../../device-session/data/DeviceSessionRefresherConst"),p=require("../../device-session/model/DeviceSession.stub"),i=require("../../device-session/model/Errors"),v=require("../../device-session/service/DefaultDeviceSessionService"),D=require("../../logger-publisher/service/DefaultLoggerPublisherService"),g=require("../../manager-api/data/AxiosManagerApiDataSource"),x=require("../../manager-api/service/DefaultManagerApiService"),A=require("../../secure-channel/data/DefaultSecureChannelDataSource"),C=require("../../secure-channel/service/DefaultSecureChannelService"),s=require("../../send/use-case/SendApduUseCase");vi.mock("@internal/manager-api/data/AxiosManagerApiDataSource");let e,o,m,a,d,t;const c="fakeSessionId";describe("SendApduUseCase",()=>{beforeEach(()=>{e=new D.DefaultLoggerPublisherService([],"send-apdu-use-case"),o=new v.DefaultDeviceSessionService(()=>e),m=new g.AxiosManagerApiDataSource({}),a=new x.DefaultManagerApiService(m),d=new A.DefaultSecureChannelDataSource({}),t=new C.DefaultSecureChannelService(d)}),it("should send an APDU to a connected device",async()=>{const r=(0,p.deviceSessionStubBuilder)({},()=>e,a,t,u.DEVICE_SESSION_REFRESHER_DEFAULT_OPTIONS);o.addDeviceSession(r);const S=await new s.SendApduUseCase(o,()=>e).execute({sessionId:c,apdu:new Uint8Array([0,1,2,3])});r.close(),expect(r.connectedDevice.sendApdu).toHaveBeenCalledTimes(1),expect(S).toBeDefined()}),it("should throw an error if the deviceSession is not found",async()=>{const n=new s.SendApduUseCase(o,()=>e).execute({sessionId:c,apdu:new Uint8Array([0,1,2,3])});await expect(n).rejects.toBeInstanceOf(i.DeviceSessionNotFound)}),it("should throw an error if the apdu receiver failed",async()=>{const r=(0,l.connectedDeviceStubBuilder)({sendApdu:vi.fn(async()=>Promise.resolve((0,f.Left)(new i.ReceiverApduError)))}),n=(0,p.deviceSessionStubBuilder)({connectedDevice:r},()=>e,a,t,u.DEVICE_SESSION_REFRESHER_DEFAULT_OPTIONS);o.addDeviceSession(n);const h=new s.SendApduUseCase(o,()=>e).execute({sessionId:c,apdu:new Uint8Array([0,1,2,3])});n.close(),await expect(h).rejects.toBeInstanceOf(i.ReceiverApduError)})});
//# sourceMappingURL=SendApduUseCase.test.js.map
