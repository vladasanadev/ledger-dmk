{
  "version": 3,
  "sources": ["../../../../../../src/internal/config/service/DefaultConfigService.ts"],
  "sourcesContent": ["import { inject, injectable } from \"inversify\";\n\nimport type { LoggerPublisherService } from \"@api/logger-publisher/service/LoggerPublisherService\";\nimport type {\n  LocalConfigDataSource,\n  RemoteConfigDataSource,\n} from \"@internal/config/data/ConfigDataSource\";\nimport { configTypes } from \"@internal/config/di/configTypes\";\nimport { Config } from \"@internal/config/model/Config\";\nimport {\n  LocalConfigFailure,\n  RemoteConfigFailure,\n} from \"@internal/config/model/Errors\";\nimport { loggerTypes } from \"@internal/logger-publisher/di/loggerTypes\";\n\nimport { ConfigService } from \"./ConfigService\";\n\n@injectable()\nexport class DefaultConfigService implements ConfigService {\n  private _local: LocalConfigDataSource;\n  private _remote: RemoteConfigDataSource;\n  private _logger: LoggerPublisherService;\n  constructor(\n    @inject(configTypes.LocalConfigDataSource) local: LocalConfigDataSource,\n    @inject(configTypes.RemoteConfigDataSource) remote: RemoteConfigDataSource,\n    @inject(loggerTypes.LoggerPublisherServiceFactory)\n    loggerServiceFactory: (tag: string) => LoggerPublisherService,\n  ) {\n    this._local = local;\n    this._remote = remote;\n    this._logger = loggerServiceFactory(\"config\");\n  }\n\n  async getDmkConfig(): Promise<Config> {\n    // Returns an Either<ReadFileError | JsonParseError, Config>\n    const localConfig = this._local\n      .getConfig()\n      .ifLeft((error: LocalConfigFailure) => {\n        this._logger.error(\"Local config not available\", {\n          data: { error },\n        });\n      });\n\n    if (localConfig.isRight()) {\n      const val = localConfig.extract();\n      this._logger.info(\"Local config available\", { data: { config: val } });\n      return val;\n    }\n\n    return this._remote.getConfig().then((config) => {\n      return config\n        .mapLeft((error: RemoteConfigFailure) => {\n          // Here we handle the error and return a default value\n          this._logger.error(\"Local config available\", { data: { error } });\n          return { name: \"DeadDmk\", version: \"0.0.0-dead.1\" };\n        })\n        .extract();\n    });\n  }\n}\n"],
  "mappings": "okBAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,0BAAAE,IAAA,eAAAC,EAAAH,GAAA,IAAAI,EAAmC,qBAOnCC,EAA4B,2CAM5BC,EAA4B,qDAKrB,IAAMC,EAAN,KAAoD,CACjD,OACA,QACA,QACR,YAC6CC,EACCC,EAE5CC,EACA,CACA,KAAK,OAASF,EACd,KAAK,QAAUC,EACf,KAAK,QAAUC,EAAqB,QAAQ,CAC9C,CAEA,MAAM,cAAgC,CAEpC,MAAMC,EAAc,KAAK,OACtB,UAAU,EACV,OAAQC,GAA8B,CACrC,KAAK,QAAQ,MAAM,6BAA8B,CAC/C,KAAM,CAAE,MAAAA,CAAM,CAChB,CAAC,CACH,CAAC,EAEH,GAAID,EAAY,QAAQ,EAAG,CACzB,MAAME,EAAMF,EAAY,QAAQ,EAChC,YAAK,QAAQ,KAAK,yBAA0B,CAAE,KAAM,CAAE,OAAQE,CAAI,CAAE,CAAC,EAC9DA,CACT,CAEA,OAAO,KAAK,QAAQ,UAAU,EAAE,KAAMC,GAC7BA,EACJ,QAASF,IAER,KAAK,QAAQ,MAAM,yBAA0B,CAAE,KAAM,CAAE,MAAAA,CAAM,CAAE,CAAC,EACzD,CAAE,KAAM,UAAW,QAAS,cAAe,EACnD,EACA,QAAQ,CACZ,CACH,CACF,EAzCaL,EAANQ,EAAA,IADN,cAAW,EAMPC,EAAA,eAAO,cAAY,qBAAqB,GACxCA,EAAA,eAAO,cAAY,sBAAsB,GACzCA,EAAA,eAAO,cAAY,6BAA6B,IAPxCT",
  "names": ["DefaultConfigService_exports", "__export", "DefaultConfigService", "__toCommonJS", "import_inversify", "import_configTypes", "import_loggerTypes", "DefaultConfigService", "local", "remote", "loggerServiceFactory", "localConfig", "error", "val", "config", "__decorateClass", "__decorateParam"]
}
