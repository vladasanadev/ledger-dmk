{
  "version": 3,
  "sources": ["../../../../../../src/internal/config/data/RemoteConfigDataSource.ts"],
  "sourcesContent": ["import { injectable } from \"inversify\";\nimport { Either, Left } from \"purify-ts\";\n\nimport { Config } from \"@internal/config/model/Config\";\nimport {\n  ApiCallError,\n  JSONParseError,\n  ParseResponseError,\n  RemoteConfigFailure,\n} from \"@internal/config/model/Errors\";\n\nimport { RemoteConfigDataSource } from \"./ConfigDataSource\";\nimport { ConfigDto } from \"./Dto\";\n\n/**\n * class RemoteRestConfigDataSource\n * This is a remote data source that reads the config from a remote API (example).\n */\n@injectable()\nexport class RestRemoteConfigDataSource implements RemoteConfigDataSource {\n  async getConfig(): Promise<Either<RemoteConfigFailure, Config>> {\n    const call = await this._callApi();\n    if (call.isLeft()) {\n      return Left(new ApiCallError(call.extract()));\n    }\n\n    if (!call.extract().ok) {\n      return Left(new ApiCallError(new Error(\"response not ok\")));\n    }\n\n    const json = await call.extract().json();\n    if (json.isLeft()) {\n      return Left(new JSONParseError());\n    }\n\n    return json\n      .chain((dto) => this._parseResponse(dto))\n      .map((config) => config);\n  }\n\n  // Parser for the Dto\n  // parserResponse: ConfigDto => Config\n  private _parseResponse(dto: ConfigDto): Either<ParseResponseError, Config> {\n    const { name, version } = dto;\n    if (!name || !version) {\n      return Left(new ParseResponseError());\n    }\n    return Either.of({ name, version });\n  }\n\n  private _callApi(): Promise<\n    Either<\n      never,\n      {\n        ok: boolean;\n        json: () => Promise<Either<JSONParseError, ConfigDto>>;\n      }\n    >\n  > {\n    return new Promise((res) => {\n      res(\n        Either.of({\n          ok: true,\n          json: async () =>\n            new Promise((r) => {\n              r(\n                Either.of({\n                  name: \"DeviceSDK\",\n                  version: \"0.0.0-fake.1\",\n                  yolo: \"yolo\",\n                }),\n              );\n            }),\n        }),\n      );\n    });\n  }\n}\n"],
  "mappings": "2iBAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,gCAAAE,IAAA,eAAAC,EAAAH,GAAA,IAAAI,EAA2B,qBAC3BC,EAA6B,qBAG7BC,EAKO,yCAUA,IAAMC,EAAN,KAAmE,CACxE,MAAM,WAA0D,CAC9D,MAAMC,EAAO,MAAM,KAAK,SAAS,EACjC,GAAIA,EAAK,OAAO,EACd,SAAO,QAAK,IAAI,eAAaA,EAAK,QAAQ,CAAC,CAAC,EAG9C,GAAI,CAACA,EAAK,QAAQ,EAAE,GAClB,SAAO,QAAK,IAAI,eAAa,IAAI,MAAM,iBAAiB,CAAC,CAAC,EAG5D,MAAMC,EAAO,MAAMD,EAAK,QAAQ,EAAE,KAAK,EACvC,OAAIC,EAAK,OAAO,KACP,QAAK,IAAI,gBAAgB,EAG3BA,EACJ,MAAOC,GAAQ,KAAK,eAAeA,CAAG,CAAC,EACvC,IAAKC,GAAWA,CAAM,CAC3B,CAIQ,eAAeD,EAAoD,CACzE,KAAM,CAAE,KAAAE,EAAM,QAAAC,CAAQ,EAAIH,EAC1B,MAAI,CAACE,GAAQ,CAACC,KACL,QAAK,IAAI,oBAAoB,EAE/B,SAAO,GAAG,CAAE,KAAAD,EAAM,QAAAC,CAAQ,CAAC,CACpC,CAEQ,UAQN,CACA,OAAO,IAAI,QAASC,GAAQ,CAC1BA,EACE,SAAO,GAAG,CACR,GAAI,GACJ,KAAM,SACJ,IAAI,QAASC,GAAM,CACjBA,EACE,SAAO,GAAG,CACR,KAAM,YACN,QAAS,eACT,KAAM,MACR,CAAC,CACH,CACF,CAAC,CACL,CAAC,CACH,CACF,CAAC,CACH,CACF,EA1DaR,EAANS,EAAA,IADN,cAAW,GACCT",
  "names": ["RemoteConfigDataSource_exports", "__export", "RestRemoteConfigDataSource", "__toCommonJS", "import_inversify", "import_purify_ts", "import_Errors", "RestRemoteConfigDataSource", "call", "json", "dto", "config", "name", "version", "res", "r", "__decorateClass"]
}
