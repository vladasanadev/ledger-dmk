"use strict";var e=require("purify-ts"),o=require("../../config/model/Errors"),i=require("./RemoteConfigDataSource");let r;const t=vi.spyOn(i.RestRemoteConfigDataSource.prototype,"_callApi"),n=vi.spyOn(i.RestRemoteConfigDataSource.prototype,"_parseResponse");describe("RemoteRestConfigDataSource",()=>{describe("RestRemoteConfigDataSource",()=>{beforeEach(()=>{t.mockClear(),n.mockClear(),r=new i.RestRemoteConfigDataSource}),it("should return an Either<never, Config>",async()=>{t.mockResolvedValue(e.Either.of({ok:!0,json:()=>Promise.resolve(e.Either.of({name:"DeviceSDK",version:"0.0.0-fake.1"}))})),n.mockReturnValue(e.Either.of({name:"DeviceSDK",version:"0.0.0-fake.1"})),expect(await r.getConfig()).toStrictEqual(e.Either.of({name:"DeviceSDK",version:"0.0.0-fake.1"}))}),it("should return an Either<ApiCallError, never> if _callApi throws",async()=>{const a=new Error("_callApi error");t.mockResolvedValue((0,e.Left)(a)),expect(await r.getConfig()).toStrictEqual((0,e.Left)(new o.ApiCallError(a)))}),it("should return an Either<ApiCallError, never> if _callApi returns a non-ok response",async()=>{t.mockResolvedValue(e.Either.of({ok:!1,json:()=>Promise.resolve(e.Either.of({name:"DeviceSDK",version:"0.0.0-fake.1"}))})),expect(await r.getConfig()).toStrictEqual((0,e.Left)(new o.ApiCallError(new Error("response not ok"))))}),it("should return an Either<JSONParseError, never> if deserializing json fails",async()=>{const a=new Error("deserializing json failure");t.mockResolvedValue(e.Either.of({ok:!0,json:()=>Promise.resolve((0,e.Left)(a))})),expect(await r.getConfig()).toStrictEqual((0,e.Left)(new o.JSONParseError))}),it("should return an Either<ParseResponseError, never> if _parseResponse throws",async()=>{t.mockResolvedValue(e.Either.of({ok:!0,json:()=>Promise.resolve(e.Either.of({name:"DeviceSDK",version:"0.0.0-fake.1"}))})),n.mockImplementation(()=>(0,e.Left)(new o.ParseResponseError)),expect(await r.getConfig()).toStrictEqual((0,e.Left)(new o.ParseResponseError))}),it("should return an Either<ParseResponseError, never> if `name` is missing in Dto",async()=>{n.mockRestore(),t.mockResolvedValue(e.Either.of({ok:!0,json:()=>Promise.resolve(e.Either.of({version:"0.0.0-fake.1",yolo:"yolo"}))})),expect(await r.getConfig()).toStrictEqual((0,e.Left)(new o.ParseResponseError))}),describe("without private methods spy",()=>{beforeEach(()=>{t.mockRestore(),n.mockRestore()}),it("should return an Either<never, Config>",async()=>{expect(await r.getConfig()).toStrictEqual(e.Either.of({name:"DeviceSDK",version:"0.0.0-fake.1"}))})})})});
//# sourceMappingURL=RemoteConfigDataSource.test.js.map
