"use strict";var f=require("purify-ts"),g=require("../../../api/device-model/data/StaticDeviceModelDataSource"),y=require("../../../api/device-session/service/DefaultApduReceiverService.stub"),h=require("../../../api/device-session/service/DefaultApduSenderService.stub"),v=require("../../../api/transport/model/__mocks__/TransportMock"),m=require("../../../api/transport/model/Errors"),S=require("../../logger-publisher/service/DefaultLoggerPublisherService"),c=require("./DefaultTransportService");let t,o,u,n,a,p,l,d,s,r,i;describe("TransportService",()=>{beforeEach(()=>{u=new S.DefaultLoggerPublisherService([],"transport-service"),t=vi.fn().mockImplementation(()=>(0,h.defaultApduSenderServiceStubBuilder)(void 0,()=>u)),o=vi.fn().mockImplementation(()=>(0,y.defaultApduReceiverServiceStubBuilder)(void 0,()=>u)),s=new g.StaticDeviceModelDataSource,n={},p=new v.TransportMock,d=new v.TransportMock,vi.spyOn(p,"getIdentifier").mockReturnValue("transport"),vi.spyOn(d,"getIdentifier").mockReturnValue("transport2"),a=vi.fn().mockImplementation(()=>p),l=vi.fn().mockImplementation(()=>d),i=vi.fn().mockImplementation(()=>u)}),afterEach(()=>{vi.resetAllMocks()}),describe("constructor",()=>{describe("when no transports are provided",()=>{let e;beforeEach(()=>{e=vi.spyOn(u,"warn")}),it("should throw an error",()=>{try{r=new c.DefaultTransportService([],n,i,s,t,o)}catch(T){expect(e).toHaveBeenCalledWith("No transports provided, please check your configuration"),expect(T).toBeInstanceOf(m.NoTransportProvidedError)}})}),describe("when transports are provided",()=>{it("should add 1 transport",()=>{r=new c.DefaultTransportService([a],n,i,s,t,o),expect(r.getAllTransports()).toEqual([p])}),it("should add multiple transports",()=>{r=new c.DefaultTransportService([a,l],n,i,s,t,o);const e=r.getAllTransports();expect(e).toEqual([p,d])}),it("should not add duplicate transports",()=>{try{new c.DefaultTransportService([a,a],n,i,s,t,o)}catch(e){expect(e).toBeInstanceOf(m.TransportAlreadyExistsError)}})})}),describe("addTransport",()=>{beforeEach(()=>{r=new c.DefaultTransportService([a],n,i,s,t,o)}),it("can add a new transport",()=>{r.addTransport(l);const e=r.getAllTransports();expect(e).toEqual([p,d])}),it("calls the transport factory function with the correct arguments",()=>{r.addTransport(l),expect(l).toHaveBeenCalledWith({loggerServiceFactory:i,config:n,apduSenderServiceFactory:t,apduReceiverServiceFactory:o,deviceModelDataSource:s})}),it("throw if transport already exists",()=>{try{r.addTransport(a)}catch(e){expect(e).toBeInstanceOf(m.TransportAlreadyExistsError)}})}),describe("getTransport",()=>{beforeEach(()=>{r=new c.DefaultTransportService([a],n,i,s,t,o)}),it("returns the transport",()=>{const e=r.getTransport("transport");expect(e).toEqual(f.Maybe.of(p))}),it("returns Nothing if the transport identifier does not exist",()=>{const e=r.getTransport("transport2");expect(e).toEqual(f.Maybe.empty())})}),describe("getAllTransports",()=>{it("returns all transports (1 transport)",()=>{r=new c.DefaultTransportService([a],n,i,s,t,o);const e=r.getAllTransports();expect(e).toEqual([p])}),it("returns all transports (2 transports)",()=>{r=new c.DefaultTransportService([a,l],n,i,s,t,o);const e=r.getAllTransports();expect(e).toEqual([p,d])})})});
//# sourceMappingURL=DefaultTransportService.test.js.map
