"use strict";var g=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var M=(o,r)=>{for(var e in r)g(o,e,{get:r[e],enumerable:!0})},A=(o,r,e,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of F(r))!_.call(o,t)&&t!==e&&g(o,t,{get:()=>r[t],enumerable:!(i=u(r,t))||i.enumerable});return o};var D=o=>A(g({},"__esModule",{value:!0}),o),f=(o,r,e,i)=>{for(var t=i>1?void 0:i?u(r,e):r,c=o.length-1,d;c>=0;c--)(d=o[c])&&(t=(i?d(r,e,t):d(t))||t);return i&&t&&g(r,e,t),t},n=(o,r)=>(e,i)=>r(e,i,o);var b={};M(b,{DefaultTransportService:()=>p});module.exports=D(b);var a=require("inversify"),s=require("purify-ts"),v=require("../../../api/transport/model/Errors"),h=require("../../device-model/di/deviceModelTypes"),y=require("../../device-session/di/deviceSessionTypes"),T=require("../../logger-publisher/di/loggerTypes"),l=require("../../transport/di/transportDiTypes");let p=class{constructor(r,e,i,t,c,d){this._config=e;this._loggerModuleFactory=i;this._deviceModelDataSource=t;this._apduSenderServiceFactory=c;this._apduReceiverServiceFactory=d;if(this._logger=i("TransportService"),r.length===0)throw this._logger.warn("No transports provided, please check your configuration"),new v.NoTransportProvidedError("No transports provided, please check your configuration");for(const S of r){const m=this.addTransport(S);if(m.isLeft())throw m.extract()}}_transports=new Map;_logger;addTransport(r){const e=r({deviceModelDataSource:this._deviceModelDataSource,loggerServiceFactory:this._loggerModuleFactory,config:this._config,apduSenderServiceFactory:this._apduSenderServiceFactory,apduReceiverServiceFactory:this._apduReceiverServiceFactory});return this.addTransportInternal(e)}addTransportInternal(r){return this.getTransport(r.getIdentifier()).isJust()?(this._logger.warn(`Transport ${r.getIdentifier()} already exists, please check your configuration`),(0,s.Left)(new v.TransportAlreadyExistsError(`Transport ${r.getIdentifier()} already exists, please check your configuration`))):(this._transports.set(r.getIdentifier(),r),(0,s.Right)(void 0))}getTransport(r){return s.Maybe.fromNullable(this._transports.get(r))}getAllTransports(){return Array.from(this._transports.values())}closeConnection(r){this.getTransport(r.transport).map(i=>i.disconnect({connectedDevice:r}))}};p=f([(0,a.injectable)(),n(0,(0,a.inject)(l.transportDiTypes.TransportsInput)),n(1,(0,a.inject)(l.transportDiTypes.DmkConfig)),n(2,(0,a.inject)(T.loggerTypes.LoggerPublisherServiceFactory)),n(3,(0,a.inject)(h.deviceModelTypes.DeviceModelDataSource)),n(4,(0,a.inject)(y.deviceSessionTypes.ApduSenderServiceFactory)),n(5,(0,a.inject)(y.deviceSessionTypes.ApduReceiverServiceFactory))],p);0&&(module.exports={DefaultTransportService});
//# sourceMappingURL=DefaultTransportService.js.map
