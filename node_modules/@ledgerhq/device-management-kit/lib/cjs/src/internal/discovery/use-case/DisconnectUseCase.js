"use strict";var a=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var D=Object.prototype.hasOwnProperty;var _=(s,e)=>{for(var r in e)a(s,r,{get:e[r],enumerable:!0})},u=(s,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of y(e))!D.call(s,o)&&o!==r&&a(s,o,{get:()=>e[o],enumerable:!(i=S(e,o))||i.enumerable});return s};var T=s=>u(a({},"__esModule",{value:!0}),s),g=(s,e,r,i)=>{for(var o=i>1?void 0:i?S(e,r):e,n=s.length-1,c;n>=0;n--)(c=s[n])&&(o=(i?c(e,r,o):c(o))||o);return i&&o&&a(e,r,o),o},p=(s,e)=>(r,i)=>e(r,i,s);var w={};_(w,{DisconnectUseCase:()=>v});module.exports=T(w);var t=require("inversify"),m=require("purify-ts"),d=require("../../../api/transport/model/Errors"),f=require("../../device-session/di/deviceSessionTypes"),h=require("../../logger-publisher/di/loggerTypes"),l=require("../../transport/di/transportDiTypes");let v=class{_transportService;_sessionService;_logger;constructor(e,r,i){this._sessionService=r,this._transportService=e,this._logger=i("DisconnectUseCase")}async execute({sessionId:e}){return this._logger.debug("Disconnecting from device",{data:{test:this._sessionService.getDeviceSessions().map(r=>r.id)}}),(0,m.EitherAsync)(async({liftEither:r})=>{const i=await r(this._sessionService.getDeviceSessionById(e).ifLeft(c=>{this._logger.error("Device session not found",{data:{sessionId:e,error:c}})})),o=i.connectedDevice.transport,n=await r(this._transportService.getTransport(o).toEither(new d.TransportNotSupportedError(new Error("Unknown transport"))));i.close(),this._sessionService.removeDeviceSession(e),await n.disconnect({connectedDevice:i.connectedDevice})}).caseOf({Left:r=>{throw this._logger.error("Error disconnecting from device",{data:{error:r}}),r},Right:()=>{}})}};v=g([(0,t.injectable)(),p(0,(0,t.inject)(l.transportDiTypes.TransportService)),p(1,(0,t.inject)(f.deviceSessionTypes.DeviceSessionService)),p(2,(0,t.inject)(h.loggerTypes.LoggerPublisherServiceFactory))],v);0&&(module.exports={DisconnectUseCase});
//# sourceMappingURL=DisconnectUseCase.js.map
