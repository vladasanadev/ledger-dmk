"use strict";var v=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var u=Object.prototype.hasOwnProperty;var d=(s,e)=>{for(var n in e)v(s,n,{get:e[n],enumerable:!0})},D=(s,e,n,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of p(e))!u.call(s,i)&&i!==n&&v(s,i,{get:()=>e[i],enumerable:!(a=S(e,i))||a.enumerable});return s};var l=s=>D(v({},"__esModule",{value:!0}),s);var E={};d(E,{DeviceSessionStateHandler:()=>h});module.exports=l(E);var t=require("../../../api/index"),c=require("../../device-session/model/DeviceSessionEventDispatcher");class h{constructor(e,n,a,i,o){this._sessionEventDispatcher=n;this._connectedDevice=a;this._deviceState=i;this.setDeviceSessionState=o;this._subscription=this._sessionEventDispatcher.listen().subscribe(r=>this.mapEventAction(r)),this._logger=e("device-session-state-handler")}_subscription;_logger;_updateDeviceState(e){const n=this._parseDeviceStatus(e);if(n){const{sessionStateType:a,deviceStatus:i,currentApp:o}=n,r=this._deviceState.getValue();r.sessionStateType===t.DeviceSessionStateType.Connected?this.setDeviceSessionState({sessionStateType:a,deviceStatus:i,deviceModelId:this._connectedDevice.deviceModel.id,currentApp:o,installedApps:[],isSecureConnectionAllowed:!1}):this.setDeviceSessionState({...r,sessionStateType:a,deviceStatus:i,deviceModelId:this._connectedDevice.deviceModel.id,currentApp:o})}}mapEventAction=e=>{switch(e.eventName){case c.SessionEvents.COMMAND_SUCCEEDED:return this._updateDeviceState(e.eventData);case c.SessionEvents.DEVICE_STATE_UPDATE_BUSY:return this.setDeviceSessionState({...this._deviceState.getValue(),deviceStatus:t.DeviceStatus.BUSY});case c.SessionEvents.DEVICE_STATE_UPDATE_LOCKED:return this.setDeviceSessionState({...this._deviceState.getValue(),deviceStatus:t.DeviceStatus.LOCKED});case c.SessionEvents.DEVICE_STATE_UPDATE_CONNECTED:return this.setDeviceSessionState({...this._deviceState.getValue(),deviceStatus:t.DeviceStatus.CONNECTED});default:return null}};_parseDeviceStatus(e){return(0,t.isSuccessCommandResult)(e)?{sessionStateType:t.DeviceSessionStateType.ReadyWithoutSecureChannel,deviceStatus:t.DeviceStatus.CONNECTED,currentApp:{name:e.data.name,version:e.data.version}}:(this._logger.debug("Error while parsing APDU response",{data:{parsedResponse:e}}),null)}unsubscribe(){this._subscription.unsubscribe()}}0&&(module.exports={DeviceSessionStateHandler});
//# sourceMappingURL=DeviceSessionStateHandler.js.map
