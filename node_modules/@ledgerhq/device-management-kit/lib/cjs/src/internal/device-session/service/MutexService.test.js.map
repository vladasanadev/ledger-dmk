{
  "version": 3,
  "sources": ["../../../../../../src/internal/device-session/service/MutexService.test.ts"],
  "sourcesContent": ["import { describe, expect, it } from \"vitest\";\n\nimport { MutexService } from \"./MutexService\";\n\ndescribe(\"MutexService\", () => {\n  it(\"should immediately return a release function when not locked\", async () => {\n    // given\n    const mutex = new MutexService();\n\n    // when\n    const release = await mutex.lock();\n\n    // then\n    expect(typeof release).toBe(\"function\");\n    release();\n  });\n\n  it(\"should queue subsequent lock calls until the lock is released\", async () => {\n    // given\n    const mutex = new MutexService();\n    const release1 = await mutex.lock();\n\n    // when\n    let lock2Resolved = false;\n    const lock2Promise = mutex.lock().then((release2) => {\n      lock2Resolved = true;\n      release2();\n    });\n\n    // then\n    expect(lock2Resolved).toBe(false);\n\n    // when\n    release1();\n    await lock2Promise;\n\n    // then\n    expect(lock2Resolved).toBe(true);\n  });\n\n  it(\"should queue multiple locks in FIFO order\", async () => {\n    // given\n    const mutex = new MutexService();\n    const order: string[] = [];\n\n    // when\n    const release1 = await mutex.lock();\n    order.push(\"first\");\n    const lock2Promise = mutex.lock().then((release2) => {\n      order.push(\"second\");\n      release2();\n    });\n    const lock3Promise = mutex.lock().then((release3) => {\n      order.push(\"third\");\n      release3();\n    });\n\n    // then\n    order.push(\"afterqueue\");\n\n    // when\n    release1();\n    await Promise.all([lock2Promise, lock3Promise]);\n\n    // then\n    expect(order).toEqual([\"first\", \"afterqueue\", \"second\", \"third\"]);\n  });\n});\n"],
  "mappings": "aAAA,IAAAA,EAAqC,kBAErCC,EAA6B,6BAE7B,YAAS,eAAgB,IAAM,IAC7B,MAAG,+DAAgE,SAAY,CAK7E,MAAMC,EAAU,MAHF,IAAI,eAAa,EAGH,KAAK,KAGjC,UAAO,OAAOA,CAAO,EAAE,KAAK,UAAU,EACtCA,EAAQ,CACV,CAAC,KAED,MAAG,gEAAiE,SAAY,CAE9E,MAAMC,EAAQ,IAAI,eACZC,EAAW,MAAMD,EAAM,KAAK,EAGlC,IAAIE,EAAgB,GACpB,MAAMC,EAAeH,EAAM,KAAK,EAAE,KAAMI,GAAa,CACnDF,EAAgB,GAChBE,EAAS,CACX,CAAC,KAGD,UAAOF,CAAa,EAAE,KAAK,EAAK,EAGhCD,EAAS,EACT,MAAME,KAGN,UAAOD,CAAa,EAAE,KAAK,EAAI,CACjC,CAAC,KAED,MAAG,4CAA6C,SAAY,CAE1D,MAAMF,EAAQ,IAAI,eACZK,EAAkB,CAAC,EAGnBJ,EAAW,MAAMD,EAAM,KAAK,EAClCK,EAAM,KAAK,OAAO,EAClB,MAAMF,EAAeH,EAAM,KAAK,EAAE,KAAMI,GAAa,CACnDC,EAAM,KAAK,QAAQ,EACnBD,EAAS,CACX,CAAC,EACKE,EAAeN,EAAM,KAAK,EAAE,KAAMO,GAAa,CACnDF,EAAM,KAAK,OAAO,EAClBE,EAAS,CACX,CAAC,EAGDF,EAAM,KAAK,YAAY,EAGvBJ,EAAS,EACT,MAAM,QAAQ,IAAI,CAACE,EAAcG,CAAY,CAAC,KAG9C,UAAOD,CAAK,EAAE,QAAQ,CAAC,QAAS,aAAc,SAAU,OAAO,CAAC,CAClE,CAAC,CACH,CAAC",
  "names": ["import_vitest", "import_MutexService", "release", "mutex", "release1", "lock2Resolved", "lock2Promise", "release2", "order", "lock3Promise", "release3"]
}
