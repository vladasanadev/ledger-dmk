{
  "version": 3,
  "sources": ["../../../../../../src/internal/device-session/service/DefaultDeviceSessionService.test.ts"],
  "sourcesContent": ["import { Either, Left } from \"purify-ts\";\nimport { Observable } from \"rxjs\";\n\nimport { type DmkConfig } from \"@api/DmkConfig\";\nimport { connectedDeviceStubBuilder } from \"@api/transport/model/TransportConnectedDevice.stub\";\nimport { DEVICE_SESSION_REFRESHER_DEFAULT_OPTIONS } from \"@internal/device-session/data/DeviceSessionRefresherConst\";\nimport { type DeviceSession } from \"@internal/device-session/model/DeviceSession\";\nimport { deviceSessionStubBuilder } from \"@internal/device-session/model/DeviceSession.stub\";\nimport { DeviceSessionNotFound } from \"@internal/device-session/model/Errors\";\nimport { DefaultLoggerPublisherService } from \"@internal/logger-publisher/service/DefaultLoggerPublisherService\";\nimport { AxiosManagerApiDataSource } from \"@internal/manager-api/data/AxiosManagerApiDataSource\";\nimport { type ManagerApiDataSource } from \"@internal/manager-api/data/ManagerApiDataSource\";\nimport { DefaultManagerApiService } from \"@internal/manager-api/service/DefaultManagerApiService\";\nimport type { ManagerApiService } from \"@internal/manager-api/service/ManagerApiService\";\nimport { DefaultSecureChannelDataSource } from \"@internal/secure-channel/data/DefaultSecureChannelDataSource\";\nimport { type SecureChannelDataSource } from \"@internal/secure-channel/data/SecureChannelDataSource\";\nimport { DefaultSecureChannelService } from \"@internal/secure-channel/service/DefaultSecureChannelService\";\nimport { type SecureChannelService } from \"@internal/secure-channel/service/SecureChannelService\";\n\nimport { DefaultDeviceSessionService } from \"./DefaultDeviceSessionService\";\n\nvi.mock(\"@internal/logger-publisher/service/DefaultLoggerPublisherService\");\nvi.mock(\"@internal/manager-api/data/AxiosManagerApiDataSource\");\n\nlet sessionService: DefaultDeviceSessionService;\nlet loggerService: DefaultLoggerPublisherService;\nlet deviceSession: DeviceSession;\nlet deviceSession1: DeviceSession;\nlet deviceSession2: DeviceSession;\nlet managerApiDataSource: ManagerApiDataSource;\nlet managerApi: ManagerApiService;\nlet secureChannelDataSource: SecureChannelDataSource;\nlet secureChannel: SecureChannelService;\n\ndescribe(\"DefaultDeviceSessionService\", () => {\n  // Initialize shared resources\n  loggerService = new DefaultLoggerPublisherService([], \"deviceSession\");\n  managerApiDataSource = new AxiosManagerApiDataSource({} as DmkConfig);\n  managerApi = new DefaultManagerApiService(managerApiDataSource);\n  secureChannelDataSource = new DefaultSecureChannelDataSource({} as DmkConfig);\n  secureChannel = new DefaultSecureChannelService(secureChannelDataSource);\n\n  beforeEach(() => {\n    vi.restoreAllMocks();\n    // Create a new instance before each test\n    sessionService = new DefaultDeviceSessionService(() => loggerService);\n    // Create a device session stub with default properties\n    deviceSession = deviceSessionStubBuilder(\n      {},\n      () => loggerService,\n      managerApi,\n      secureChannel,\n      DEVICE_SESSION_REFRESHER_DEFAULT_OPTIONS,\n    );\n  });\n\n  afterEach(() => {\n    deviceSession.close();\n  });\n\n  it(\"should have an empty DeviceSession list\", () => {\n    expect(sessionService.getDeviceSessions()).toEqual([]);\n  });\n\n  describe(\"DeviceSessionService addDeviceSession\", () => {\n    it(\"should add a DeviceSession if it does not already exist\", () => {\n      sessionService.addDeviceSession(deviceSession);\n      expect(sessionService.getDeviceSessions()).toEqual([deviceSession]);\n    });\n    it(\"should not add a DeviceSession if it already exists\", () => {\n      sessionService.addDeviceSession(deviceSession);\n      sessionService.addDeviceSession(deviceSession);\n      expect(sessionService.getDeviceSessions()).toEqual([deviceSession]);\n    });\n  });\n\n  describe(\"DeviceSessionService removeDeviceSession\", () => {\n    it(\"should remove the DeviceSession of given ID\", () => {\n      sessionService.addDeviceSession(deviceSession);\n      sessionService.removeDeviceSession(deviceSession.id);\n      expect(sessionService.getDeviceSessions()).toEqual([]);\n    });\n    it(\"should not remove the DeviceSession of given ID if it does not exist\", () => {\n      sessionService.addDeviceSession(deviceSession);\n      sessionService.removeDeviceSession(\"non-existent-id\");\n      expect(sessionService.getDeviceSessions()).toEqual([deviceSession]);\n    });\n  });\n\n  describe(\"DeviceSessionService getDeviceSessionById\", () => {\n    it(\"should get the DeviceSession of given ID if it exists\", () => {\n      sessionService.addDeviceSession(deviceSession);\n      expect(sessionService.getDeviceSessionById(deviceSession.id)).toEqual(\n        Either.of(deviceSession),\n      );\n    });\n    it(\"should not get the DeviceSession if it does not exist\", () => {\n      sessionService.addDeviceSession(deviceSession);\n      expect(sessionService.getDeviceSessionById(\"non-existent-id\")).toEqual(\n        Left(new DeviceSessionNotFound()),\n      );\n    });\n  });\n\n  describe(\"DeviceSessionService getDeviceSessionsByDeviceId\", () => {\n    it(\"should not get device sessions by deviceId if none exist\", () => {\n      sessionService.addDeviceSession(deviceSession);\n      expect(\n        sessionService.getDeviceSessionsByDeviceId(\"non-existent-device-id\"),\n      ).toEqual(Left(new DeviceSessionNotFound()));\n    });\n    it(\"should get a single device session by deviceId\", () => {\n      sessionService.addDeviceSession(deviceSession);\n      expect(\n        sessionService.getDeviceSessionsByDeviceId(\n          deviceSession.connectedDevice.id,\n        ),\n      ).toEqual(Either.of([deviceSession]));\n    });\n    it(\"should get device sessions by deviceId\", () => {\n      sessionService.addDeviceSession(deviceSession);\n      deviceSession1 = deviceSessionStubBuilder(\n        {\n          connectedDevice: connectedDeviceStubBuilder({ id: \"device-1\" }),\n          id: \"session-1\",\n        },\n        () => loggerService,\n        managerApi,\n        secureChannel,\n        DEVICE_SESSION_REFRESHER_DEFAULT_OPTIONS,\n      );\n\n      deviceSession2 = deviceSessionStubBuilder(\n        {\n          connectedDevice: connectedDeviceStubBuilder({ id: \"device-1\" }),\n          id: \"session-2\",\n        },\n        () => loggerService,\n        managerApi,\n        secureChannel,\n        DEVICE_SESSION_REFRESHER_DEFAULT_OPTIONS,\n      );\n      sessionService.addDeviceSession(deviceSession1);\n      sessionService.addDeviceSession(deviceSession2);\n      expect(sessionService.getDeviceSessionsByDeviceId(\"device-1\")).toEqual(\n        Either.of([deviceSession1, deviceSession2]),\n      );\n      deviceSession1.close();\n      deviceSession2.close();\n    });\n  });\n\n  it(\"should get all sessions\", () => {\n    sessionService.addDeviceSession(deviceSession);\n    expect(sessionService.getDeviceSessions()).toEqual([deviceSession]);\n  });\n\n  it(\"should retrieve sessionObs\", () => {\n    expect(sessionService.sessionsObs).toBeInstanceOf(\n      Observable<DeviceSession>,\n    );\n  });\n\n  it(\"should emit new session\", () =>\n    new Promise<void>((resolve, reject) => {\n      const subscription = sessionService.sessionsObs.subscribe({\n        next(emittedDeviceSession) {\n          try {\n            expect(emittedDeviceSession).toStrictEqual(deviceSession);\n            subscription.unsubscribe();\n            resolve();\n          } catch (error) {\n            reject(error);\n          }\n        },\n      });\n      sessionService.addDeviceSession(deviceSession);\n    }));\n\n  it(\"should emit previous added session\", () => {\n    const lastDeviceSession = deviceSessionStubBuilder(\n      { id: \"last-session\" },\n      () => loggerService,\n      managerApi,\n      secureChannel,\n      DEVICE_SESSION_REFRESHER_DEFAULT_OPTIONS,\n    );\n    const emittedSessions: DeviceSession[] = [];\n    sessionService.addDeviceSession(deviceSession);\n    sessionService.addDeviceSession(lastDeviceSession);\n\n    const subscription = sessionService.sessionsObs.subscribe({\n      next(emittedDeviceSession) {\n        emittedSessions.push(emittedDeviceSession);\n      },\n    });\n    lastDeviceSession.close();\n    expect(emittedSessions).toEqual([deviceSession, lastDeviceSession]);\n    subscription.unsubscribe();\n  });\n});\n"],
  "mappings": "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",
  "names": ["import_purify_ts", "import_rxjs", "import_TransportConnectedDevice", "import_DeviceSessionRefresherConst", "import_DeviceSession", "import_Errors", "import_DefaultLoggerPublisherService", "import_AxiosManagerApiDataSource", "import_DefaultManagerApiService", "import_DefaultSecureChannelDataSource", "import_DefaultSecureChannelService", "import_DefaultDeviceSessionService", "sessionService", "loggerService", "deviceSession", "deviceSession1", "deviceSession2", "managerApiDataSource", "managerApi", "secureChannelDataSource", "secureChannel", "resolve", "reject", "subscription", "emittedDeviceSession", "error", "lastDeviceSession", "emittedSessions"]
}
