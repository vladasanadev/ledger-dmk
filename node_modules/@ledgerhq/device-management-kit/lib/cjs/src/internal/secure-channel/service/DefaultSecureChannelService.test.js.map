{
  "version": 3,
  "sources": ["../../../../../../src/internal/secure-channel/service/DefaultSecureChannelService.test.ts"],
  "sourcesContent": ["import { type Mocked } from \"vitest\";\n\nimport { getOsVersionCommandResponseMockBuilder } from \"@api/command/os/__mocks__/GetOsVersionCommand\";\nimport { type DmkConfig } from \"@api/DmkConfig\";\nimport { DeviceModelId } from \"@api/index\";\nimport { type Application } from \"@internal/manager-api/model/Application\";\nimport {\n  type FinalFirmware,\n  type OsuFirmware,\n} from \"@internal/manager-api/model/Firmware\";\nimport { DefaultSecureChannelDataSource } from \"@internal/secure-channel/data/DefaultSecureChannelDataSource\";\n\nimport { DefaultSecureChannelService } from \"./DefaultSecureChannelService\";\nimport { type SecureChannelService } from \"./SecureChannelService\";\n\nvi.mock(\"@internal/secure-channel/data/DefaultSecureChannelDataSource\");\n\nlet dataSource: Mocked<DefaultSecureChannelDataSource>;\nlet service: SecureChannelService;\n\ndescribe(\"SecureChannelService\", () => {\n  beforeEach(() => {\n    dataSource = new DefaultSecureChannelDataSource(\n      {} as DmkConfig,\n    ) as Mocked<DefaultSecureChannelDataSource>;\n\n    service = new DefaultSecureChannelService(dataSource);\n  });\n\n  describe(\"genuineCheck service\", () => {\n    it(\"should call genuineCheck data source with passing parameters\", () => {\n      // given\n      const deviceInfo = getOsVersionCommandResponseMockBuilder(\n        DeviceModelId.NANO_SP,\n      );\n      const finalFirmware = {\n        perso: \"perso\",\n      } as FinalFirmware;\n\n      // when\n      service.genuineCheck(deviceInfo, finalFirmware);\n\n      // then\n      expect(dataSource.genuineCheck).toHaveBeenCalledWith({\n        targetId: deviceInfo.targetId.toString(),\n        perso: \"perso\",\n      });\n    });\n  });\n\n  describe(\"listInstalledApps service\", () => {\n    it(\"should call listInstalledApps data source with passing parameters\", () => {\n      // given\n      const deviceInfo = getOsVersionCommandResponseMockBuilder(\n        DeviceModelId.NANO_SP,\n      );\n\n      const finalFirmware = {\n        perso: \"perso\",\n      } as FinalFirmware;\n\n      // when\n      service.listInstalledApps(deviceInfo, finalFirmware);\n\n      // then\n      expect(dataSource.listInstalledApps).toHaveBeenCalledWith({\n        targetId: deviceInfo.targetId.toString(),\n        perso: \"perso\",\n      });\n    });\n  });\n\n  describe(\"updateMcu service\", () => {\n    it(\"should call updateMcu data source with passing parameters\", () => {\n      // given\n      const deviceInfo = getOsVersionCommandResponseMockBuilder(\n        DeviceModelId.NANO_SP,\n      );\n      const version = \"version\";\n\n      // when\n      service.updateMcu(deviceInfo, { version });\n\n      // then\n      expect(dataSource.updateMcu).toHaveBeenCalledWith({\n        targetId: deviceInfo.targetId.toString(),\n        version,\n      });\n    });\n  });\n\n  describe(\"updateFirmware service\", () => {\n    it(\"should call updateFirmware data source with passing parameters\", () => {\n      // given\n      const deviceInfo = getOsVersionCommandResponseMockBuilder(\n        DeviceModelId.NANO_SP,\n      );\n\n      const osuFirmware = {\n        perso: \"perso\",\n        firmware: \"firmware\",\n        firmwareKey: \"firmwareKey\",\n      } as OsuFirmware;\n\n      // when\n      service.updateFirmware(deviceInfo, osuFirmware);\n\n      // then\n      expect(dataSource.updateFirmware).toHaveBeenCalledWith({\n        targetId: deviceInfo.targetId.toString(),\n        perso: \"perso\",\n        firmware: \"firmware\",\n        firmwareKey: \"firmwareKey\",\n      });\n    });\n  });\n\n  describe(\"installApp service\", () => {\n    it(\"should call installApp data source with passing parameters\", () => {\n      // given\n      const deviceInfo = getOsVersionCommandResponseMockBuilder(\n        DeviceModelId.NANO_SP,\n      );\n      const perso = \"perso\";\n      const firmware = \"firmware\";\n      const firmwareKey = \"firmwareKey\";\n      const hash = \"hash\";\n\n      // when\n      service.installApp(deviceInfo, {\n        perso,\n        firmware,\n        firmwareKey,\n        hash,\n      } as Application);\n\n      // then\n      expect(dataSource.installApp).toHaveBeenCalledWith({\n        targetId: deviceInfo.targetId.toString(),\n        perso,\n        firmware,\n        firmwareKey,\n        hash,\n      });\n    });\n  });\n\n  describe(\"uninstallApp service\", () => {\n    it(\"should call uninstallApp data source with passing parameters\", () => {\n      // given\n      const deviceInfo = getOsVersionCommandResponseMockBuilder(\n        DeviceModelId.NANO_SP,\n      );\n      const perso = \"perso\";\n      const appDelete = \"delete\";\n      const deleteKey = \"deleteKey\";\n      const hash = \"hash\";\n\n      // when\n      service.uninstallApp(deviceInfo, {\n        perso,\n        delete: appDelete,\n        deleteKey,\n        hash,\n      } as Application);\n\n      // then\n      expect(dataSource.uninstallApp).toHaveBeenCalledWith({\n        targetId: deviceInfo.targetId.toString(),\n        perso,\n        firmware: appDelete,\n        firmwareKey: deleteKey,\n        hash,\n      });\n    });\n  });\n});\n"],
  "mappings": "aAEA,IAAAA,EAAuD,yDAEvDC,EAA8B,sBAM9BC,EAA+C,wEAE/CC,EAA4C,yCAG5C,GAAG,KAAK,8DAA8D,EAEtE,IAAIC,EACAC,EAEJ,SAAS,uBAAwB,IAAM,CACrC,WAAW,IAAM,CACfD,EAAa,IAAI,iCACf,CAAC,CACH,EAEAC,EAAU,IAAI,8BAA4BD,CAAU,CACtD,CAAC,EAED,SAAS,uBAAwB,IAAM,CACrC,GAAG,+DAAgE,IAAM,CAEvE,MAAME,KAAa,0CACjB,gBAAc,OAChB,EACMC,EAAgB,CACpB,MAAO,OACT,EAGAF,EAAQ,aAAaC,EAAYC,CAAa,EAG9C,OAAOH,EAAW,YAAY,EAAE,qBAAqB,CACnD,SAAUE,EAAW,SAAS,SAAS,EACvC,MAAO,OACT,CAAC,CACH,CAAC,CACH,CAAC,EAED,SAAS,4BAA6B,IAAM,CAC1C,GAAG,oEAAqE,IAAM,CAE5E,MAAMA,KAAa,0CACjB,gBAAc,OAChB,EAEMC,EAAgB,CACpB,MAAO,OACT,EAGAF,EAAQ,kBAAkBC,EAAYC,CAAa,EAGnD,OAAOH,EAAW,iBAAiB,EAAE,qBAAqB,CACxD,SAAUE,EAAW,SAAS,SAAS,EACvC,MAAO,OACT,CAAC,CACH,CAAC,CACH,CAAC,EAED,SAAS,oBAAqB,IAAM,CAClC,GAAG,4DAA6D,IAAM,CAEpE,MAAMA,KAAa,0CACjB,gBAAc,OAChB,EACME,EAAU,UAGhBH,EAAQ,UAAUC,EAAY,CAAE,QAAAE,CAAQ,CAAC,EAGzC,OAAOJ,EAAW,SAAS,EAAE,qBAAqB,CAChD,SAAUE,EAAW,SAAS,SAAS,EACvC,QAAAE,CACF,CAAC,CACH,CAAC,CACH,CAAC,EAED,SAAS,yBAA0B,IAAM,CACvC,GAAG,iEAAkE,IAAM,CAEzE,MAAMF,KAAa,0CACjB,gBAAc,OAChB,EAEMG,EAAc,CAClB,MAAO,QACP,SAAU,WACV,YAAa,aACf,EAGAJ,EAAQ,eAAeC,EAAYG,CAAW,EAG9C,OAAOL,EAAW,cAAc,EAAE,qBAAqB,CACrD,SAAUE,EAAW,SAAS,SAAS,EACvC,MAAO,QACP,SAAU,WACV,YAAa,aACf,CAAC,CACH,CAAC,CACH,CAAC,EAED,SAAS,qBAAsB,IAAM,CACnC,GAAG,6DAA8D,IAAM,CAErE,MAAMA,KAAa,0CACjB,gBAAc,OAChB,EACMI,EAAQ,QACRC,EAAW,WACXC,EAAc,cACdC,EAAO,OAGbR,EAAQ,WAAWC,EAAY,CAC7B,MAAAI,EACA,SAAAC,EACA,YAAAC,EACA,KAAAC,CACF,CAAgB,EAGhB,OAAOT,EAAW,UAAU,EAAE,qBAAqB,CACjD,SAAUE,EAAW,SAAS,SAAS,EACvC,MAAAI,EACA,SAAAC,EACA,YAAAC,EACA,KAAAC,CACF,CAAC,CACH,CAAC,CACH,CAAC,EAED,SAAS,uBAAwB,IAAM,CACrC,GAAG,+DAAgE,IAAM,CAEvE,MAAMP,KAAa,0CACjB,gBAAc,OAChB,EACMI,EAAQ,QACRI,EAAY,SACZC,EAAY,YACZF,EAAO,OAGbR,EAAQ,aAAaC,EAAY,CAC/B,MAAAI,EACA,OAAQI,EACR,UAAAC,EACA,KAAAF,CACF,CAAgB,EAGhB,OAAOT,EAAW,YAAY,EAAE,qBAAqB,CACnD,SAAUE,EAAW,SAAS,SAAS,EACvC,MAAAI,EACA,SAAUI,EACV,YAAaC,EACb,KAAAF,CACF,CAAC,CACH,CAAC,CACH,CAAC,CACH,CAAC",
  "names": ["import_GetOsVersionCommand", "import_api", "import_DefaultSecureChannelDataSource", "import_DefaultSecureChannelService", "dataSource", "service", "deviceInfo", "finalFirmware", "version", "osuFirmware", "perso", "firmware", "firmwareKey", "hash", "appDelete", "deleteKey"]
}
