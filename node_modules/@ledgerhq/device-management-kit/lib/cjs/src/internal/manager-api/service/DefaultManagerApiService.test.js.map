{
  "version": 3,
  "sources": ["../../../../../../src/internal/manager-api/service/DefaultManagerApiService.test.ts"],
  "sourcesContent": ["import { Left, Right } from \"purify-ts\";\nimport { type Mocked } from \"vitest\";\n\nimport { getOsVersionCommandResponseMockBuilder } from \"@api/command/os/__mocks__/GetOsVersionCommand\";\nimport { DeviceModelId } from \"@api/device/DeviceModel\";\nimport {\n  BTC_APP,\n  BTC_APP_METADATA,\n  ETH_APP,\n  ETH_APP_METADATA,\n} from \"@api/device-action/__test-utils__/data\";\nimport { type DmkConfig } from \"@api/DmkConfig\";\nimport { AxiosManagerApiDataSource } from \"@internal/manager-api/data/AxiosManagerApiDataSource\";\nimport { HttpFetchApiError } from \"@internal/manager-api/model/Errors\";\nimport {\n  type FinalFirmware,\n  type OsuFirmware,\n} from \"@internal/manager-api/model/Firmware\";\n\nimport { DefaultManagerApiService } from \"./DefaultManagerApiService\";\nimport { type ManagerApiService } from \"./ManagerApiService\";\n\nvi.mock(\"@internal/manager-api/data/AxiosManagerApiDataSource\");\nlet dataSource: Mocked<AxiosManagerApiDataSource>;\nlet service: ManagerApiService;\ndescribe(\"ManagerApiService\", () => {\n  beforeEach(() => {\n    dataSource = new AxiosManagerApiDataSource(\n      {} as DmkConfig,\n    ) as Mocked<AxiosManagerApiDataSource>;\n    service = new DefaultManagerApiService(dataSource);\n  });\n\n  describe(\"getAppList\", () => {\n    it(\"should call api with the correct parameters\", () => {\n      // given\n      const deviceInfo = getOsVersionCommandResponseMockBuilder(\n        DeviceModelId.STAX,\n      );\n      // when\n      service.getAppList(deviceInfo);\n      // then\n      expect(dataSource.getAppList).toHaveBeenCalledWith({\n        targetId: \"857735172\",\n        firmwareVersionName: \"1.3.0\",\n      });\n    });\n  });\n\n  describe(\"getAppsByHash\", () => {\n    describe(\"success cases\", () => {\n      it(\"with no apps, should return an empty list\", async () => {\n        dataSource.getAppsByHash.mockResolvedValue(Right([]));\n        expect(await service.getAppsByHash([])).toEqual(Right([]));\n      });\n\n      it(\"with one app, should return the metadata\", async () => {\n        dataSource.getAppsByHash.mockResolvedValue(Right([BTC_APP_METADATA]));\n        expect(await service.getAppsByHash([BTC_APP.appFullHash])).toEqual(\n          Right([BTC_APP_METADATA]),\n        );\n      });\n\n      it(\"with two app, should return the metadata of both apps\", async () => {\n        dataSource.getAppsByHash.mockResolvedValue(\n          Right([BTC_APP_METADATA, ETH_APP_METADATA]),\n        );\n        expect(\n          await service.getAppsByHash(\n            [BTC_APP, ETH_APP].map((app) => app.appFullHash),\n          ),\n        ).toEqual(Right([BTC_APP_METADATA, ETH_APP_METADATA]));\n      });\n\n      it(\"with one app and one without `appFullHash`, should return the metadata of the correct app\", async () => {\n        dataSource.getAppsByHash.mockResolvedValue(Right([BTC_APP_METADATA]));\n        const APP_WITH_NO_HASH = { ...ETH_APP, appFullHash: \"\" };\n        expect(\n          await service.getAppsByHash(\n            [BTC_APP, APP_WITH_NO_HASH].map((app) => app.appFullHash),\n          ),\n        ).toEqual(Right([BTC_APP_METADATA]));\n      });\n    });\n\n    describe(\"error cases\", () => {\n      it(\"should return an error when the data source fails with a known error\", async () => {\n        const error = new HttpFetchApiError(new Error(\"Failed to fetch data\"));\n        dataSource.getAppsByHash.mockRejectedValue(error);\n        expect(await service.getAppsByHash([BTC_APP.appFullHash])).toEqual(\n          Left(error),\n        );\n      });\n\n      it(\"should return an error when the data source fails with an unknown error\", async () => {\n        const error = new Error(\"unkown error\");\n        dataSource.getAppsByHash.mockRejectedValue(error);\n        expect(await service.getAppsByHash([BTC_APP.appFullHash])).toEqual(\n          Left(new HttpFetchApiError(error)),\n        );\n      });\n    });\n  });\n\n  describe(\"getDeviceVersion\", () => {\n    it(\"should call api with the correct parameters\", () => {\n      // given\n      const deviceInfo = getOsVersionCommandResponseMockBuilder(\n        DeviceModelId.STAX,\n      );\n      // when\n      service.getDeviceVersion(deviceInfo);\n      // then\n      expect(dataSource.getDeviceVersion).toHaveBeenCalledWith({\n        targetId: \"857735172\",\n      });\n    });\n  });\n\n  describe(\"getFirmwareVersion\", () => {\n    it(\"should call api with the correct parameters\", () => {\n      // given\n      const mockGetDeviceVersion = {\n        id: 17,\n        target_id: \"857735172\",\n      };\n      const deviceInfo = getOsVersionCommandResponseMockBuilder(\n        DeviceModelId.STAX,\n      );\n      // when\n      service.getFirmwareVersion(deviceInfo, mockGetDeviceVersion);\n      // then\n      expect(dataSource.getFirmwareVersion).toHaveBeenCalledWith({\n        deviceId: 17,\n        version: \"1.3.0\",\n      });\n    });\n  });\n\n  describe(\"getOsuFirmwareVersion\", () => {\n    it(\"should call api with the correct parameters\", () => {\n      // given\n      const mockGetDeviceVersion = {\n        id: 17,\n        target_id: \"857735172\",\n      };\n      const deviceInfo = getOsVersionCommandResponseMockBuilder(\n        DeviceModelId.STAX,\n      );\n      // when\n      service.getOsuFirmwareVersion(deviceInfo, mockGetDeviceVersion);\n      // then\n      expect(dataSource.getOsuFirmwareVersion).toHaveBeenCalledWith({\n        deviceId: 17,\n        version: \"1.3.0\",\n      });\n    });\n  });\n\n  describe(\"getLatestFirmwareVersion\", () => {\n    it(\"should call api with the correct parameters\", () => {\n      // given\n      const deviceVersion = {\n        id: 17,\n        target_id: \"857735172\",\n      };\n      const currentFirmware = {\n        id: 159,\n      } as FinalFirmware;\n      // when\n      service.getLatestFirmwareVersion(currentFirmware, deviceVersion);\n      // then\n      expect(dataSource.getLatestFirmwareVersion).toHaveBeenCalledWith({\n        currentFinalFirmwareId: 159,\n        deviceId: 17,\n      });\n    });\n  });\n\n  describe(\"getNextFirmwareVersion\", () => {\n    it(\"should call api with the correct parameters\", () => {\n      // given\n      const osuFirmware = {\n        nextFinalFirmware: 159,\n      } as OsuFirmware;\n      // when\n      service.getNextFirmwareVersion(osuFirmware);\n      // then\n      expect(dataSource.getFirmwareVersionById).toHaveBeenCalledWith(159);\n    });\n  });\n\n  describe(\"getLanguagePackages\", () => {\n    it(\"should call api with the correct parameters\", () => {\n      // given\n      const deviceVersion = {\n        id: 17,\n        target_id: \"857735172\",\n      };\n      const currentFirmware = {\n        id: 159,\n      } as FinalFirmware;\n      // when\n      service.getLanguagePackages(deviceVersion, currentFirmware);\n      // then\n      expect(dataSource.getLanguagePackages).toHaveBeenCalledWith({\n        deviceId: 17,\n        currentFinalFirmwareId: 159,\n      });\n    });\n  });\n\n  describe(\"getMcuList\", () => {\n    it(\"should call api with the correct parameters\", () => {\n      // when\n      service.getMcuList();\n      // then\n      expect(dataSource.getMcuList).toHaveBeenCalled();\n    });\n  });\n});\n"],
  "mappings": "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",
  "names": ["import_purify_ts", "import_GetOsVersionCommand", "import_DeviceModel", "import_data", "import_AxiosManagerApiDataSource", "import_Errors", "import_DefaultManagerApiService", "dataSource", "service", "deviceInfo", "app", "APP_WITH_NO_HASH", "error", "mockGetDeviceVersion", "deviceVersion", "currentFirmware", "osuFirmware"]
}
