{
  "version": 3,
  "sources": ["../../../../src/api/DeviceManagementKit.ts"],
  "sourcesContent": ["import { type Container } from \"inversify\";\nimport { type Observable } from \"rxjs\";\n\nimport { commandTypes } from \"@api/command/di/commandTypes\";\nimport { type CommandResult } from \"@api/command/model/CommandResult\";\nimport {\n  type SendCommandUseCase,\n  type SendCommandUseCaseArgs,\n} from \"@api/command/use-case/SendCommandUseCase\";\nimport {\n  type ExecuteDeviceActionUseCase,\n  type ExecuteDeviceActionUseCaseArgs,\n} from \"@api/device-action/use-case/ExecuteDeviceActionUseCase\";\nimport { type ApduResponse } from \"@api/device-session/ApduResponse\";\nimport { type DeviceSessionState } from \"@api/device-session/DeviceSessionState\";\nimport { type DeviceSessionId } from \"@api/device-session/types\";\nimport { type ConnectedDevice } from \"@api/transport/model/ConnectedDevice\";\nimport {\n  type ConnectUseCaseArgs,\n  type DisconnectUseCaseArgs,\n  type DiscoveredDevice,\n  type GetConnectedDeviceUseCaseArgs,\n  type SendApduUseCaseArgs,\n  type StartDiscoveringUseCaseArgs,\n} from \"@api/types\";\nimport { configTypes } from \"@internal/config/di/configTypes\";\nimport { type GetDmkVersionUseCase } from \"@internal/config/use-case/GetDmkVersionUseCase\";\nimport { deviceSessionTypes } from \"@internal/device-session/di/deviceSessionTypes\";\nimport { type CloseSessionsUseCase } from \"@internal/device-session/use-case/CloseSessionsUseCase\";\nimport { type GetDeviceSessionStateUseCase } from \"@internal/device-session/use-case/GetDeviceSessionStateUseCase\";\nimport { discoveryTypes } from \"@internal/discovery/di/discoveryTypes\";\nimport { type ConnectUseCase } from \"@internal/discovery/use-case/ConnectUseCase\";\nimport { type DisconnectUseCase } from \"@internal/discovery/use-case/DisconnectUseCase\";\nimport { type GetConnectedDeviceUseCase } from \"@internal/discovery/use-case/GetConnectedDeviceUseCase\";\nimport { type ListConnectedDevicesUseCase } from \"@internal/discovery/use-case/ListConnectedDevicesUseCase\";\nimport {\n  type ListenToAvailableDevicesUseCase,\n  type ListenToAvailableDevicesUseCaseArgs,\n} from \"@internal/discovery/use-case/ListenToAvailableDevicesUseCase\";\nimport { type ListenToConnectedDeviceUseCase } from \"@internal/discovery/use-case/ListenToConnectedDeviceUseCase\";\nimport {\n  type ReconnectUseCase,\n  type ReconnectUseCaseArgs,\n} from \"@internal/discovery/use-case/ReconnectUseCase\";\nimport type { StartDiscoveringUseCase } from \"@internal/discovery/use-case/StartDiscoveringUseCase\";\nimport type { StopDiscoveringUseCase } from \"@internal/discovery/use-case/StopDiscoveringUseCase\";\nimport { type ManagerApiDataSource } from \"@internal/manager-api/data/ManagerApiDataSource\";\nimport { managerApiTypes } from \"@internal/manager-api/di/managerApiTypes\";\nimport { type SetProviderUseCase } from \"@internal/manager-api/use-case/SetProviderUseCase\";\nimport { sendTypes } from \"@internal/send/di/sendTypes\";\nimport { type SendApduUseCase } from \"@internal/send/use-case/SendApduUseCase\";\nimport { transportDiTypes } from \"@internal/transport/di/transportDiTypes\";\nimport { type TransportService } from \"@internal/transport/service/TransportService\";\nimport { makeContainer, type MakeContainerProps } from \"@root/src/di\";\n\nimport {\n  type DeviceActionIntermediateValue,\n  type ExecuteDeviceActionReturnType,\n} from \"./device-action/DeviceAction\";\nimport { deviceActionTypes } from \"./device-action/di/deviceActionTypes\";\nimport { type DisableDeviceSessionRefresherUseCase } from \"./device-session/use-case/DisableDeviceSessionRefresher\";\nimport { type DmkError } from \"./Error\";\n\n/**\n * The main class to interact with the Device Management Kit.\n *\n * NB: do not instantiate this class directly, instead, use `LedgerDMKBuilder`.\n */\nexport class DeviceManagementKit {\n  readonly container: Container;\n  /** @internal */\n  constructor({\n    stub,\n    transports,\n    loggers,\n    config,\n  }: Partial<MakeContainerProps> = {}) {\n    // NOTE: MakeContainerProps might not be the exact type here\n    // For the init of the project this is sufficient, but we might need to\n    // update the constructor arguments as we go (we might have more than just the container config)\n    this.container = makeContainer({\n      stub,\n      transports,\n      loggers,\n      config,\n    });\n  }\n\n  /**\n   * Returns a promise resolving to the version of the SDK.\n   */\n  getVersion(): Promise<string> {\n    return this.container\n      .get<GetDmkVersionUseCase>(configTypes.GetDmkVersionUseCase)\n      .getDmkVersion();\n  }\n\n  /**\n   * Starts discovering devices connected.\n   *\n   * For the WeHID implementation, this use-case needs to be called as a result\n   * of an user interaction (button \"click\" event for ex).\n   *\n   * @param {StartDiscoveringUseCaseArgs} args - The transport to use for discover, or undefined to discover from all transports.\n   * @returns {Observable<DiscoveredDevice>} An observable of discovered devices.\n   */\n  startDiscovering(\n    args: StartDiscoveringUseCaseArgs,\n  ): Observable<DiscoveredDevice> {\n    return this.container\n      .get<StartDiscoveringUseCase>(discoveryTypes.StartDiscoveringUseCase)\n      .execute(args);\n  }\n\n  /**\n   * Stops discovering devices connected.\n   */\n  stopDiscovering() {\n    return this.container\n      .get<StopDiscoveringUseCase>(discoveryTypes.StopDiscoveringUseCase)\n      .execute();\n  }\n\n  /**\n   * Listen to list of known discovered devices (and later BLE).\n   * @param {ListenToAvailableDevicesUseCaseArgs} args - The transport to use for discover, or undefined to discover from all transports.\n   * @returns {Observable<DiscoveredDevice[]>} An observable of known discovered devices.\n   */\n  listenToAvailableDevices(\n    args: ListenToAvailableDevicesUseCaseArgs,\n  ): Observable<DiscoveredDevice[]> {\n    return this.container\n      .get<ListenToAvailableDevicesUseCase>(\n        discoveryTypes.ListenToAvailableDevicesUseCase,\n      )\n      .execute(args);\n  }\n\n  /**\n   * Reconnects a device session by disconnecting and reconnecting to the device.\n   *\n   * @param args - The arguments for reconnecting the device session.\n   *   - `device`: The connected device.\n   *   - `sessionRefresherOptions` (optional): Configuration for session refreshing.\n   *     - `isRefresherDisabled`: Whether the refresher is disabled.\n   *     - `pollingInterval`: The refresh interval in milliseconds\n   * @returns The session ID to use for further communication with the device.\n   */\n  async reconnect(args: ReconnectUseCaseArgs): Promise<DeviceSessionId> {\n    return this.container\n      .get<ReconnectUseCase>(discoveryTypes.ReconnectUseCase)\n      .execute(args);\n  }\n\n  /**\n   * Connects to a device previously discovered with `DeviceManagementKit.startDiscovering`.\n   * Creates a new device session which:\n   * - Represents the connection to the device.\n   * - Is terminated upon disconnection of the device.\n   * - Exposes the device state through an observable (see `DeviceManagementKit.getDeviceSessionState`)\n   * - Should be used for all subsequent communication with the device.\n   *\n   * @param {ConnectUseCaseArgs} args - The arguments for connecting to the device.\n   *   - `device`: The discovered device obtained from `StartDiscoveringUseCase`.\n   *   - `sessionRefresherOptions` (optional): Configuration for session refreshing.\n   *     - `isRefresherDisabled`: Whether the refresher is disabled.\n   *     - `pollingInterval`: The refresh interval in milliseconds\n   * @returns The session ID to use for further communication with the device.\n   */\n  connect(args: ConnectUseCaseArgs): Promise<DeviceSessionId> {\n    return this.container\n      .get<ConnectUseCase>(discoveryTypes.ConnectUseCase)\n      .execute(args);\n  }\n\n  /**\n   * Disconnects to a discovered device.\n   *\n   * @param {DisconnectUseCaseArgs} args - The session ID to disconnect.\n   */\n  disconnect(args: DisconnectUseCaseArgs): Promise<void> {\n    return this.container\n      .get<DisconnectUseCase>(discoveryTypes.DisconnectUseCase)\n      .execute(args);\n  }\n\n  /**\n   * Sends an APDU command to a device through a device session.\n   *\n   * @param {SendApduUseCaseArgs} args - The device session ID and APDU command to send.\n   */\n  sendApdu(args: SendApduUseCaseArgs): Promise<ApduResponse> {\n    return this.container\n      .get<SendApduUseCase>(sendTypes.SendApduUseCase)\n      .execute(args);\n  }\n\n  /**\n   * Sends a command to a device through a device session.\n   *\n   * @param {SendCommandUseCaseArgs<Response, Args, ErrorCodes>} args - The device session ID, command, command error codes and command parameters to send.\n   * @returns A promise resolving with the response from the command.\n   */\n  sendCommand<Response, Args, ErrorCodes>(\n    args: SendCommandUseCaseArgs<Response, Args, ErrorCodes>,\n  ): Promise<CommandResult<Response, ErrorCodes>> {\n    return this.container\n      .get<SendCommandUseCase>(commandTypes.SendCommandUseCase)\n      .execute(args);\n  }\n\n  executeDeviceAction<\n    Output,\n    Input,\n    Error extends DmkError,\n    IntermediateValue extends DeviceActionIntermediateValue,\n  >(\n    args: ExecuteDeviceActionUseCaseArgs<\n      Output,\n      Input,\n      Error,\n      IntermediateValue\n    >,\n  ): ExecuteDeviceActionReturnType<Output, Error, IntermediateValue> {\n    return this.container\n      .get<ExecuteDeviceActionUseCase>(\n        deviceActionTypes.ExecuteDeviceActionUseCase,\n      )\n      .execute(args);\n  }\n\n  /**\n   * Gets the connected from its device session ID.\n   *\n   * @param {GetConnectedDeviceUseCaseArgs} args - The device session ID.\n   * @returns {ConnectedDevice} The connected device.\n   */\n  getConnectedDevice(args: GetConnectedDeviceUseCaseArgs): ConnectedDevice {\n    return this.container\n      .get<GetConnectedDeviceUseCase>(discoveryTypes.GetConnectedDeviceUseCase)\n      .execute(args);\n  }\n\n  /**\n   * Gets the device state of a session.\n   *\n   * @param {{ sessionId: DeviceSessionId }} args - The device session ID.\n   * @returns {Observable<DeviceSessionState>} An observable of the session device state.\n   */\n  getDeviceSessionState(args: {\n    sessionId: DeviceSessionId;\n  }): Observable<DeviceSessionState> {\n    return this.container\n      .get<GetDeviceSessionStateUseCase>(\n        deviceSessionTypes.GetDeviceSessionStateUseCase,\n      )\n      .execute(args);\n  }\n\n  /**\n   * Close the Device Management kit.\n   *\n   */\n  close() {\n    return this.container\n      .get<CloseSessionsUseCase>(deviceSessionTypes.CloseSessionsUseCase)\n      .execute();\n  }\n\n  /**\n   * Lists all connected devices.\n   *\n   * @returns {ConnectedDevice[]} The list of device sessions.\n   */\n  listConnectedDevices(): ConnectedDevice[] {\n    return this.container\n      .get<ListConnectedDevicesUseCase>(\n        discoveryTypes.ListConnectedDevicesUseCase,\n      )\n      .execute();\n  }\n\n  /**\n   * Listen to connected device.\n   *\n   * @returns {Observable<ConnectedDevice>} An observable of connected device.\n   */\n  listenToConnectedDevice(): Observable<ConnectedDevice> {\n    return this.container\n      .get<ListenToConnectedDeviceUseCase>(\n        discoveryTypes.ListenToConnectedDeviceUseCase,\n      )\n      .execute();\n  }\n\n  /**\n   * Disable the device session refresher.\n   *\n   * @param {DisableDeviceSessionRefresherUseCaseArgs} args - The device session ID and a string to identify the blocker.\n   * @returns {() => void} A function to reenable the device session refresher.\n   */\n  disableDeviceSessionRefresher(args: {\n    sessionId: DeviceSessionId;\n    blockerId: string;\n  }): () => void {\n    return this.container\n      .get<DisableDeviceSessionRefresherUseCase>(\n        deviceSessionTypes.DisableDeviceSessionRefresherUseCase,\n      )\n      .execute(args);\n  }\n  /**\n   * Sets the provider for the manager API.\n   *\n   * @param {number} provider - The provider to set.\n   */\n  setProvider(provider: number): void {\n    return this.container\n      .get<SetProviderUseCase>(managerApiTypes.SetProviderUseCase)\n      .execute(provider);\n  }\n\n  /**\n   * Returns the current provider value from the manager API data source.\n   */\n  getProvider(): number {\n    return this.container\n      .get<ManagerApiDataSource>(managerApiTypes.ManagerApiDataSource)\n      .getProvider();\n  }\n\n  /**\n   * Check if the current environment is supported by any transport.\n   */\n  isEnvironmentSupported(): boolean {\n    return this.container\n      .get<TransportService>(transportDiTypes.TransportService)\n      .getAllTransports()\n      .some((transport) => transport.isSupported());\n  }\n}\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,yBAAAE,IAAA,eAAAC,EAAAH,GAGA,IAAAI,EAA6B,wCAsB7BC,EAA4B,2CAE5BC,EAAmC,0DAGnCC,EAA+B,iDAiB/BC,EAAgC,oDAEhCC,EAA0B,uCAE1BC,EAAiC,mDAEjCC,EAAuD,wBAMvDC,EAAkC,gDAS3B,MAAMV,CAAoB,CACtB,UAET,YAAY,CACV,KAAAW,EACA,WAAAC,EACA,QAAAC,EACA,OAAAC,CACF,EAAiC,CAAC,EAAG,CAInC,KAAK,aAAY,iBAAc,CAC7B,KAAAH,EACA,WAAAC,EACA,QAAAC,EACA,OAAAC,CACF,CAAC,CACH,CAKA,YAA8B,CAC5B,OAAO,KAAK,UACT,IAA0B,cAAY,oBAAoB,EAC1D,cAAc,CACnB,CAWA,iBACEC,EAC8B,CAC9B,OAAO,KAAK,UACT,IAA6B,iBAAe,uBAAuB,EACnE,QAAQA,CAAI,CACjB,CAKA,iBAAkB,CAChB,OAAO,KAAK,UACT,IAA4B,iBAAe,sBAAsB,EACjE,QAAQ,CACb,CAOA,yBACEA,EACgC,CAChC,OAAO,KAAK,UACT,IACC,iBAAe,+BACjB,EACC,QAAQA,CAAI,CACjB,CAYA,MAAM,UAAUA,EAAsD,CACpE,OAAO,KAAK,UACT,IAAsB,iBAAe,gBAAgB,EACrD,QAAQA,CAAI,CACjB,CAiBA,QAAQA,EAAoD,CAC1D,OAAO,KAAK,UACT,IAAoB,iBAAe,cAAc,EACjD,QAAQA,CAAI,CACjB,CAOA,WAAWA,EAA4C,CACrD,OAAO,KAAK,UACT,IAAuB,iBAAe,iBAAiB,EACvD,QAAQA,CAAI,CACjB,CAOA,SAASA,EAAkD,CACzD,OAAO,KAAK,UACT,IAAqB,YAAU,eAAe,EAC9C,QAAQA,CAAI,CACjB,CAQA,YACEA,EAC8C,CAC9C,OAAO,KAAK,UACT,IAAwB,eAAa,kBAAkB,EACvD,QAAQA,CAAI,CACjB,CAEA,oBAMEA,EAMiE,CACjE,OAAO,KAAK,UACT,IACC,oBAAkB,0BACpB,EACC,QAAQA,CAAI,CACjB,CAQA,mBAAmBA,EAAsD,CACvE,OAAO,KAAK,UACT,IAA+B,iBAAe,yBAAyB,EACvE,QAAQA,CAAI,CACjB,CAQA,sBAAsBA,EAEa,CACjC,OAAO,KAAK,UACT,IACC,qBAAmB,4BACrB,EACC,QAAQA,CAAI,CACjB,CAMA,OAAQ,CACN,OAAO,KAAK,UACT,IAA0B,qBAAmB,oBAAoB,EACjE,QAAQ,CACb,CAOA,sBAA0C,CACxC,OAAO,KAAK,UACT,IACC,iBAAe,2BACjB,EACC,QAAQ,CACb,CAOA,yBAAuD,CACrD,OAAO,KAAK,UACT,IACC,iBAAe,8BACjB,EACC,QAAQ,CACb,CAQA,8BAA8BA,EAGf,CACb,OAAO,KAAK,UACT,IACC,qBAAmB,oCACrB,EACC,QAAQA,CAAI,CACjB,CAMA,YAAYC,EAAwB,CAClC,OAAO,KAAK,UACT,IAAwB,kBAAgB,kBAAkB,EAC1D,QAAQA,CAAQ,CACrB,CAKA,aAAsB,CACpB,OAAO,KAAK,UACT,IAA0B,kBAAgB,oBAAoB,EAC9D,YAAY,CACjB,CAKA,wBAAkC,CAChC,OAAO,KAAK,UACT,IAAsB,mBAAiB,gBAAgB,EACvD,iBAAiB,EACjB,KAAMC,GAAcA,EAAU,YAAY,CAAC,CAChD,CACF",
  "names": ["DeviceManagementKit_exports", "__export", "DeviceManagementKit", "__toCommonJS", "import_commandTypes", "import_configTypes", "import_deviceSessionTypes", "import_discoveryTypes", "import_managerApiTypes", "import_sendTypes", "import_transportDiTypes", "import_di", "import_deviceActionTypes", "stub", "transports", "loggers", "config", "args", "provider", "transport"]
}
