{
  "version": 3,
  "sources": ["../../../../../../src/api/transport/model/DeviceConnectionStateMachine.test.ts"],
  "sourcesContent": ["import { Left, Right } from \"purify-ts/Either\";\nimport { afterEach, beforeEach, describe, expect, it, vi } from \"vitest\";\n\nimport { ApduResponse } from \"@api/device-session/ApduResponse\";\n\nimport { type SendApduResult } from \"./DeviceConnection\";\nimport { DeviceConnectionStateMachine } from \"./DeviceConnectionStateMachine\";\nimport {\n  AlreadySendingApduError,\n  DeviceDisconnectedWhileSendingError,\n} from \"./Errors\";\n\ndescribe(\"DeviceConnectionStateMachine\", () => {\n  let machine: DeviceConnectionStateMachine<void>;\n  const mockApduSender = {\n    sendApdu: vi.fn(),\n    getDependencies: vi.fn(),\n    setDependencies: vi.fn(),\n    closeConnection: vi.fn(),\n    setupConnection: vi.fn(),\n  };\n\n  const apduResponse = new ApduResponse({\n    statusCode: Uint8Array.from([0x90, 0x00]),\n    data: new Uint8Array(),\n  });\n  const apduResponseErrorBusy = new ApduResponse({\n    statusCode: Uint8Array.from([0x66, 0x01]),\n    data: new Uint8Array(),\n  });\n\n  beforeEach(() => {\n    vi.useFakeTimers();\n    machine = new DeviceConnectionStateMachine<void>({\n      deviceId: \"deviceId\",\n      deviceApduSender: mockApduSender,\n      timeoutDuration: 1000,\n      tryToReconnect: vi.fn(),\n      onTerminated: vi.fn(),\n    });\n  });\n\n  afterEach(() => {\n    vi.useRealTimers();\n    vi.restoreAllMocks();\n  });\n\n  describe(\"Send APDUs\", () => {\n    it(\"should send APDU successfully\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      mockApduSender.sendApdu.mockResolvedValue(Right(apduResponse));\n\n      // WHEN\n      const result = await machine.sendApdu(apdu);\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(1);\n      expect(result).toStrictEqual(Right(apduResponse));\n    });\n\n    it(\"should send several APDUs successfully\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      const apdu2 = Uint8Array.from([9, 2, 3, 4]);\n      mockApduSender.sendApdu.mockResolvedValue(Right(apduResponse));\n\n      // WHEN\n      const result = await machine.sendApdu(apdu);\n      const result2 = await machine.sendApdu(apdu2);\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(2);\n      expect(result).toStrictEqual(Right(apduResponse));\n      expect(result2).toStrictEqual(Right(apduResponse));\n    });\n\n    it(\"should not send several APDUs in parallel\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      const apdu2 = Uint8Array.from([9, 2, 3, 4]);\n      mockApduSender.sendApdu.mockResolvedValue(Right(apduResponse));\n\n      // WHEN\n      const promise = machine.sendApdu(apdu);\n      const result2 = await machine.sendApdu(apdu2);\n      const result = await promise;\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(1);\n      expect(result).toStrictEqual(Right(apduResponse));\n      expect(result2).toStrictEqual(Left(new AlreadySendingApduError()));\n    });\n\n    it(\"Disconnected while sending APDU\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      mockApduSender.sendApdu.mockResolvedValue(Right(apduResponse));\n\n      // WHEN\n      const promise = machine.sendApdu(apdu);\n      machine.eventDeviceDisconnected();\n      const result = await promise;\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(1);\n      expect(result).toStrictEqual(\n        Left(new DeviceDisconnectedWhileSendingError()),\n      );\n    });\n\n    it(\"Request disconnection while sending APDU\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      mockApduSender.sendApdu.mockResolvedValue(Right(apduResponse));\n\n      // WHEN\n      const promise = machine.sendApdu(apdu);\n      machine.closeConnection();\n      const result = await promise;\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(1);\n      expect(result).toStrictEqual(\n        Left(new DeviceDisconnectedWhileSendingError()),\n      );\n    });\n  });\n\n  describe(\"Send APDUs triggering disconnection\", () => {\n    it(\"should send one APDU successfully\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      mockApduSender.sendApdu.mockResolvedValue(Right(apduResponse));\n\n      // WHEN\n      const result = await machine.sendApdu(apdu, true);\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(2);\n      expect(mockApduSender.sendApdu.mock.calls).toEqual([\n        [apdu, false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined], // GetAppAndVersion APDU sent after a successful result from an APDU that triggers disconnection\n      ]);\n      expect(result).toStrictEqual(Right(apduResponse));\n    });\n\n    it(\"should send several APDUs successfully\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      const apdu2 = Uint8Array.from([9, 2, 3, 4]);\n      mockApduSender.sendApdu\n        .mockResolvedValueOnce(Right(apduResponse))\n        .mockRejectedValueOnce(new Error(\"Transport error\"))\n        .mockResolvedValueOnce(Right(apduResponse));\n\n      // WHEN\n      const promise1 = machine.sendApdu(apdu, true);\n      await Promise.resolve(); // Allow the first APDU to be sent and processed before the disconnection event\n      machine.eventDeviceDisconnected();\n      machine.eventDeviceConnected();\n      const promise2 = machine.sendApdu(apdu2);\n      const result1 = await promise1;\n      const result2 = await promise2;\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(3);\n      expect(mockApduSender.sendApdu.mock.calls).toEqual([\n        [apdu, false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined], // GetAppAndVersion APDU sent after a successful result from an APDU that triggers disconnection\n        [apdu2, false, undefined],\n      ]);\n\n      expect(result1).toStrictEqual(Right(apduResponse));\n      expect(result2).toStrictEqual(Right(apduResponse));\n    });\n\n    it(\"should send a second APDU after reconnection\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      const apdu2 = Uint8Array.from([9, 2, 3, 4]);\n      mockApduSender.sendApdu\n        .mockResolvedValueOnce(Right(apduResponse))\n        .mockRejectedValueOnce(new Error(\"Transport error\"))\n        .mockResolvedValueOnce(Right(apduResponse));\n\n      // WHEN\n      const result = await machine.sendApdu(apdu, true);\n      machine.eventDeviceDisconnected();\n      machine.eventDeviceConnected();\n      const result2 = await machine.sendApdu(apdu2);\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(3);\n      expect(mockApduSender.sendApdu.mock.calls).toEqual([\n        [apdu, false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined], // GetAppAndVersion APDU sent after a successful result from an APDU that triggers disconnection\n        [apdu2, false, undefined],\n      ]);\n      expect(result).toStrictEqual(Right(apduResponse));\n      expect(result2).toStrictEqual(Right(apduResponse));\n    });\n\n    it(\"should send a second APDU without reconnection, after GetAppAndVersion response\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      const apdu2 = Uint8Array.from([9, 2, 3, 4]);\n      mockApduSender.sendApdu\n        .mockResolvedValueOnce(Right(apduResponse))\n        .mockResolvedValueOnce(Right(apduResponse))\n        .mockResolvedValueOnce(Right(apduResponse));\n\n      // WHEN\n      const result = await machine.sendApdu(apdu, true);\n      const result2 = await machine.sendApdu(apdu2);\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(3);\n      expect(mockApduSender.sendApdu.mock.calls).toEqual([\n        [apdu, false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined], // GetAppAndVersion APDU sent after a successful result from an APDU that triggers disconnection\n        [apdu2, false, undefined],\n      ]);\n      expect(result).toStrictEqual(Right(apduResponse));\n      expect(result2).toStrictEqual(Right(apduResponse));\n    });\n\n    it(\"should send a second APDU without reconnection, after GetAppAndVersion retries\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      const apdu2 = Uint8Array.from([9, 2, 3, 4]);\n      mockApduSender.sendApdu\n        .mockResolvedValueOnce(Right(apduResponse))\n        .mockResolvedValueOnce(Right(apduResponseErrorBusy))\n        .mockResolvedValueOnce(Right(apduResponseErrorBusy))\n        .mockResolvedValueOnce(Right(apduResponse))\n        .mockResolvedValueOnce(Right(apduResponse));\n\n      // WHEN\n      const result = await machine.sendApdu(apdu, true);\n      const result2 = await machine.sendApdu(apdu2);\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(5);\n      expect(mockApduSender.sendApdu.mock.calls).toEqual([\n        [apdu, false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined],\n        [apdu2, false, undefined],\n      ]);\n      expect(result).toStrictEqual(Right(apduResponse));\n      expect(result2).toStrictEqual(Right(apduResponse));\n    });\n\n    it(\"should not send several APDUs in parallel\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      const apdu2 = Uint8Array.from([9, 2, 3, 4]);\n      mockApduSender.sendApdu.mockResolvedValue(Right(apduResponse));\n\n      // WHEN\n      const promise = machine.sendApdu(apdu, true);\n      const result2 = await machine.sendApdu(apdu2);\n      const result = await promise;\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(2);\n      expect(mockApduSender.sendApdu.mock.calls).toEqual([\n        [apdu, false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined], // GetAppAndVersion APDU sent after a successful result from an APDU that triggers disconnection\n      ]);\n      expect(result).toStrictEqual(Right(apduResponse));\n      expect(result2).toStrictEqual(Left(new AlreadySendingApduError()));\n    });\n\n    it(\"should send another APDU in promise handler\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      const apdu2 = Uint8Array.from([9, 2, 3, 4]);\n      mockApduSender.sendApdu.mockResolvedValue(Right(apduResponse));\n\n      // WHEN\n      let promise: Promise<SendApduResult> | undefined = undefined;\n      const result = await machine.sendApdu(apdu, true).then((value) => {\n        promise = machine.sendApdu(apdu2);\n        return value;\n      });\n      machine.eventDeviceDisconnected();\n      machine.eventDeviceConnected();\n      const result2 = await promise!;\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(3);\n      expect(mockApduSender.sendApdu.mock.calls).toEqual([\n        [apdu, false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined], // GetAppAndVersion APDU sent after a successful result from an APDU that triggers disconnection\n        [apdu2, false, undefined],\n      ]);\n      expect(result).toStrictEqual(Right(apduResponse));\n      expect(result2).toStrictEqual(Right(apduResponse));\n    });\n\n    it(\"send an APDU while device is reconnecting\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      mockApduSender.sendApdu.mockResolvedValue(Right(apduResponse));\n\n      // WHEN\n      machine.eventDeviceDisconnected();\n      const promise = machine.sendApdu(apdu, true);\n      machine.eventDeviceConnected();\n      const result = await promise;\n\n      // THEN\n      expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(2);\n      expect(mockApduSender.sendApdu.mock.calls).toEqual([\n        [apdu, false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined], // GetAppAndVersion APDU sent after a successful result from an APDU that triggers disconnection\n      ]);\n      expect(result).toStrictEqual(Right(apduResponse));\n    });\n\n    it(\"Close while an APDU is waiting for reconnection\", async () => {\n      // GIVEN\n      const apdu = Uint8Array.from([1, 2, 3, 4]);\n      const apdu2 = Uint8Array.from([9, 2, 3, 4]);\n      mockApduSender.sendApdu.mockResolvedValue(Right(apduResponse));\n\n      // WHEN\n      let promise: Promise<SendApduResult> | undefined = undefined;\n      const promise1 = machine.sendApdu(apdu, true);\n      await Promise.resolve(); // Allow the first APDU promise to resolve before triggering disconnection\n      machine.eventDeviceDisconnected();\n      const result1 = await promise1;\n      promise = machine.sendApdu(apdu2);\n      machine.closeConnection();\n      const result2 = await promise!;\n\n      // THEN\n      // expect(mockApduSender.sendApdu).toHaveBeenCalledTimes(2);\n      expect(mockApduSender.sendApdu.mock.calls).toEqual([\n        [apdu, false, undefined],\n        [Uint8Array.from([0xb0, 0x01, 0x00, 0x00, 0x00]), false, undefined], // GetAppAndVersion APDU sent after a successful result from an APDU that triggers disconnection\n      ]);\n      expect(result1).toStrictEqual(Right(apduResponse));\n      expect(result2).toStrictEqual(\n        Left(new DeviceDisconnectedWhileSendingError()),\n      );\n    });\n  });\n});\n"],
  "mappings": "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",
  "names": ["import_Either", "import_vitest", "import_ApduResponse", "import_DeviceConnectionStateMachine", "import_Errors", "machine", "mockApduSender", "apduResponse", "apduResponseErrorBusy", "apdu", "result", "apdu2", "result2", "promise", "promise1", "promise2", "result1", "value"]
}
