{
  "version": 3,
  "sources": ["../../../../../../src/api/logger-subscriber/service/WebLogsExporterLogger.ts"],
  "sourcesContent": ["import { LogLevel } from \"@api/logger-subscriber/model/LogLevel\";\nimport { type LogSubscriberOptions } from \"@api/types\";\nimport { DeviceSession } from \"@internal/device-session/model/DeviceSession\";\n\nimport { type LoggerSubscriberService } from \"./LoggerSubscriberService\";\n\n/**\n * This function is used to format the logs to JSON format,\n * remove circular dependencies and do some extra formatting.\n * */\nexport function getJSONStringifyReplacer(): (\n  key: string,\n  value: unknown,\n) => unknown {\n  const ancestors: unknown[] = [];\n  return function (_: string, value: unknown): unknown {\n    // format Uint8Array values to more readable format\n    if (value instanceof Uint8Array) {\n      const bytesHex = Array.from(value).map((x) =>\n        x.toString(16).padStart(2, \"0\"),\n      );\n      return {\n        hex: \"0x\" + bytesHex.join(\"\"),\n        readableHex: bytesHex.join(\" \"),\n        value: value.toString(),\n      };\n    }\n\n    // format DeviceSession values to avoid huge object in logs\n    if (value instanceof DeviceSession) {\n      const {\n        connectedDevice: { deviceModel, type, id },\n      } = value;\n      return {\n        id: value.id,\n        connectedDevice: {\n          deviceModel,\n          type,\n          id,\n        },\n      };\n    }\n\n    // format circular references to \"[Circular]\"\n    // Taken from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Errors/Cyclic_object_value#circular_references\n    if (typeof value !== \"object\" || value === null) {\n      return value;\n    }\n    // `this` is the object that value is contained in,\n    // i.e., its direct parent.\n    // @ts-expect-error cf. comment above\n    while (ancestors.length > 0 && ancestors.at(-1) !== (this as unknown)) {\n      ancestors.pop();\n    }\n    if (ancestors.includes(value)) {\n      return \"[Circular]\";\n    }\n    ancestors.push(value);\n    return value;\n  };\n}\n\nexport class WebLogsExporterLogger implements LoggerSubscriberService {\n  private logs: Array<\n    [level: LogLevel, message: string, options: LogSubscriberOptions]\n  > = [];\n\n  log(level: LogLevel, message: string, options: LogSubscriberOptions): void {\n    this.logs.push([level, message, options]);\n  }\n\n  private formatLogsToJSON(): string {\n    const remappedLogs = this.logs.map(([level, message, options]) => {\n      const { timestamp, ...restOptions } = options;\n      return {\n        level: LogLevel[level],\n        message,\n        options: {\n          ...restOptions,\n          date: new Date(options.timestamp),\n        },\n      };\n    });\n\n    return JSON.stringify(remappedLogs, getJSONStringifyReplacer(), 2);\n  }\n\n  /**\n   * Export logs to JSON file.\n   */\n  public exportLogsToJSON(): void {\n    const logs = this.formatLogsToJSON();\n    const blob = new Blob([logs], { type: \"application/json\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `ledger-device-management-kit-logs-${new Date().toISOString()}.json`;\n    a.click();\n  }\n}\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,2BAAAE,EAAA,6BAAAC,IAAA,eAAAC,EAAAJ,GAAA,IAAAK,EAAyB,iDAEzBC,EAA8B,wDAQvB,SAASH,GAGH,CACX,MAAMI,EAAuB,CAAC,EAC9B,OAAO,SAAUC,EAAWC,EAAyB,CAEnD,GAAIA,aAAiB,WAAY,CAC/B,MAAMC,EAAW,MAAM,KAAKD,CAAK,EAAE,IAAKE,GACtCA,EAAE,SAAS,EAAE,EAAE,SAAS,EAAG,GAAG,CAChC,EACA,MAAO,CACL,IAAK,KAAOD,EAAS,KAAK,EAAE,EAC5B,YAAaA,EAAS,KAAK,GAAG,EAC9B,MAAOD,EAAM,SAAS,CACxB,CACF,CAGA,GAAIA,aAAiB,gBAAe,CAClC,KAAM,CACJ,gBAAiB,CAAE,YAAAG,EAAa,KAAAC,EAAM,GAAAC,CAAG,CAC3C,EAAIL,EACJ,MAAO,CACL,GAAIA,EAAM,GACV,gBAAiB,CACf,YAAAG,EACA,KAAAC,EACA,GAAAC,CACF,CACF,CACF,CAIA,GAAI,OAAOL,GAAU,UAAYA,IAAU,KACzC,OAAOA,EAKT,KAAOF,EAAU,OAAS,GAAKA,EAAU,GAAG,EAAE,IAAO,MACnDA,EAAU,IAAI,EAEhB,OAAIA,EAAU,SAASE,CAAK,EACnB,cAETF,EAAU,KAAKE,CAAK,EACbA,EACT,CACF,CAEO,MAAMP,CAAyD,CAC5D,KAEJ,CAAC,EAEL,IAAIa,EAAiBC,EAAiBC,EAAqC,CACzE,KAAK,KAAK,KAAK,CAACF,EAAOC,EAASC,CAAO,CAAC,CAC1C,CAEQ,kBAA2B,CACjC,MAAMC,EAAe,KAAK,KAAK,IAAI,CAAC,CAACH,EAAOC,EAASC,CAAO,IAAM,CAChE,KAAM,CAAE,UAAAE,EAAW,GAAGC,CAAY,EAAIH,EACtC,MAAO,CACL,MAAO,WAASF,CAAK,EACrB,QAAAC,EACA,QAAS,CACP,GAAGI,EACH,KAAM,IAAI,KAAKH,EAAQ,SAAS,CAClC,CACF,CACF,CAAC,EAED,OAAO,KAAK,UAAUC,EAAcf,EAAyB,EAAG,CAAC,CACnE,CAKO,kBAAyB,CAC9B,MAAMkB,EAAO,KAAK,iBAAiB,EAC7BC,EAAO,IAAI,KAAK,CAACD,CAAI,EAAG,CAAE,KAAM,kBAAmB,CAAC,EACpDE,EAAM,IAAI,gBAAgBD,CAAI,EAC9BE,EAAI,SAAS,cAAc,GAAG,EACpCA,EAAE,KAAOD,EACTC,EAAE,SAAW,qCAAqC,IAAI,KAAK,EAAE,YAAY,CAAC,QAC1EA,EAAE,MAAM,CACV,CACF",
  "names": ["WebLogsExporterLogger_exports", "__export", "WebLogsExporterLogger", "getJSONStringifyReplacer", "__toCommonJS", "import_LogLevel", "import_DeviceSession", "ancestors", "_", "value", "bytesHex", "x", "deviceModel", "type", "id", "level", "message", "options", "remappedLogs", "timestamp", "restOptions", "logs", "blob", "url", "a"]
}
