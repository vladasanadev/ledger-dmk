{
  "version": 3,
  "sources": ["../../../../../../src/api/command/os/OpenAppCommand.ts"],
  "sourcesContent": ["import { type Apdu } from \"@api/apdu/model/Apdu\";\nimport { ApduBuilder, type ApduBuilderArgs } from \"@api/apdu/utils/ApduBuilder\";\nimport { ApduParser } from \"@api/apdu/utils/ApduParser\";\nimport { type Command } from \"@api/command/Command\";\nimport {\n  type CommandResult,\n  CommandResultFactory,\n} from \"@api/command/model/CommandResult\";\nimport {\n  type CommandErrors,\n  isCommandErrorCode,\n} from \"@api/command/utils/CommandErrors\";\nimport { CommandUtils } from \"@api/command/utils/CommandUtils\";\nimport { GlobalCommandErrorHandler } from \"@api/command/utils/GlobalCommandError\";\nimport { type ApduResponse } from \"@api/device-session/ApduResponse\";\nimport { type CommandErrorArgs, DeviceExchangeError } from \"@api/Error\";\n\nexport type OpenAppArgs = {\n  readonly appName: string;\n};\n\nexport type OpenAppErrorCodes = \"670a\" | \"6807\";\n\nconst OPEN_APP_ERRORS: CommandErrors<OpenAppErrorCodes> = {\n  \"670a\": { message: \"No app name provided\" },\n  \"6807\": { message: \"Unknown application name\" },\n};\n\nexport class OpenAppCommandError extends DeviceExchangeError<OpenAppErrorCodes> {\n  constructor({ message, errorCode }: CommandErrorArgs<OpenAppErrorCodes>) {\n    super({ tag: \"OpenAppCommandError\", message, errorCode });\n  }\n}\n\nexport type OpenAppCommandResult = CommandResult<void, OpenAppErrorCodes>;\n\n/**\n * The command to open an application on the device.\n */\nexport class OpenAppCommand\n  implements Command<void, OpenAppArgs, OpenAppErrorCodes>\n{\n  readonly name = \"openApp\";\n  readonly args: OpenAppArgs;\n\n  readonly triggersDisconnection = true;\n\n  constructor(args: OpenAppArgs) {\n    this.args = args;\n  }\n\n  getApdu(): Apdu {\n    const openAppApduArgs: ApduBuilderArgs = {\n      cla: 0xe0,\n      ins: 0xd8,\n      p1: 0x00,\n      p2: 0x00,\n    };\n    return new ApduBuilder(openAppApduArgs)\n      .addAsciiStringToData(this.args.appName)\n      .build();\n  }\n\n  parseResponse(\n    apduResponse: ApduResponse,\n  ): CommandResult<void, OpenAppErrorCodes> {\n    if (CommandUtils.isSuccessResponse(apduResponse)) {\n      return CommandResultFactory({\n        data: undefined,\n      });\n    }\n    const parser = new ApduParser(apduResponse);\n    const errorCode = parser.encodeToHexaString(apduResponse.statusCode);\n    if (isCommandErrorCode(errorCode, OPEN_APP_ERRORS)) {\n      return CommandResultFactory({\n        error: new OpenAppCommandError({\n          ...OPEN_APP_ERRORS[errorCode],\n          errorCode,\n        }),\n      });\n    }\n    return CommandResultFactory({\n      error: GlobalCommandErrorHandler.handle(apduResponse),\n    });\n  }\n}\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,oBAAAE,EAAA,wBAAAC,IAAA,eAAAC,EAAAJ,GACA,IAAAK,EAAkD,uCAClDC,EAA2B,sCAE3BC,EAGO,4CACPC,EAGO,4CACPC,EAA6B,2CAC7BC,EAA0C,iDAE1CC,EAA2D,sBAQ3D,MAAMC,EAAoD,CACxD,OAAQ,CAAE,QAAS,sBAAuB,EAC1C,KAAQ,CAAE,QAAS,0BAA2B,CAChD,EAEO,MAAMT,UAA4B,qBAAuC,CAC9E,YAAY,CAAE,QAAAU,EAAS,UAAAC,CAAU,EAAwC,CACvE,MAAM,CAAE,IAAK,sBAAuB,QAAAD,EAAS,UAAAC,CAAU,CAAC,CAC1D,CACF,CAOO,MAAMZ,CAEb,CACW,KAAO,UACP,KAEA,sBAAwB,GAEjC,YAAYa,EAAmB,CAC7B,KAAK,KAAOA,CACd,CAEA,SAAgB,CACd,MAAMC,EAAmC,CACvC,IAAK,IACL,IAAK,IACL,GAAI,EACJ,GAAI,CACN,EACA,OAAO,IAAI,cAAYA,CAAe,EACnC,qBAAqB,KAAK,KAAK,OAAO,EACtC,MAAM,CACX,CAEA,cACEC,EACwC,CACxC,GAAI,eAAa,kBAAkBA,CAAY,EAC7C,SAAO,wBAAqB,CAC1B,KAAM,MACR,CAAC,EAGH,MAAMH,EADS,IAAI,aAAWG,CAAY,EACjB,mBAAmBA,EAAa,UAAU,EACnE,SAAI,sBAAmBH,EAAWF,CAAe,KACxC,wBAAqB,CAC1B,MAAO,IAAIT,EAAoB,CAC7B,GAAGS,EAAgBE,CAAS,EAC5B,UAAAA,CACF,CAAC,CACH,CAAC,KAEI,wBAAqB,CAC1B,MAAO,4BAA0B,OAAOG,CAAY,CACtD,CAAC,CACH,CACF",
  "names": ["OpenAppCommand_exports", "__export", "OpenAppCommand", "OpenAppCommandError", "__toCommonJS", "import_ApduBuilder", "import_ApduParser", "import_CommandResult", "import_CommandErrors", "import_CommandUtils", "import_GlobalCommandError", "import_Error", "OPEN_APP_ERRORS", "message", "errorCode", "args", "openAppApduArgs", "apduResponse"]
}
