{
  "version": 3,
  "sources": ["../../../../../../src/api/command/os/ListLanguagePackCommand.ts"],
  "sourcesContent": ["import { type Apdu } from \"@api/apdu/model/Apdu\";\nimport { ApduBuilder, type ApduBuilderArgs } from \"@api/apdu/utils/ApduBuilder\";\nimport { ApduParser } from \"@api/apdu/utils/ApduParser\";\nimport { type Command } from \"@api/command/Command\";\nimport { InvalidStatusWordError } from \"@api/command/Errors\";\nimport {\n  type CommandResult,\n  CommandResultFactory,\n} from \"@api/command/model/CommandResult\";\nimport {\n  type CommandErrors,\n  isCommandErrorCode,\n} from \"@api/command/utils/CommandErrors\";\nimport { CommandUtils } from \"@api/command/utils/CommandUtils\";\nimport { GlobalCommandErrorHandler } from \"@api/command/utils/GlobalCommandError\";\nimport { type ApduResponse } from \"@api/device-session/ApduResponse\";\nimport { type CommandErrorArgs, DeviceExchangeError } from \"@api/Error\";\nimport { bufferToHexaString } from \"@api/utils/HexaString\";\n\nexport type ListLanguagePackCommandArgs = {\n  readonly firstChunk: boolean;\n};\n\nexport type ListLanguagePackResponse =\n  | {\n      readonly id: number;\n      readonly size: number;\n    }\n  | undefined;\n\nexport type ListLanguagePackErrorCodes = \"662d\";\n\nconst LANGUAGE_PACK_ERRORS: CommandErrors<ListLanguagePackErrorCodes> = {\n  \"662d\": {\n    message:\n      \"Invalid LIST_ARG, first command must be sent with P1_LIST_LANGUAGE_PACKS_FIRST.\",\n  },\n};\n\nexport type ListLanguagePackCommandResult = CommandResult<\n  ListLanguagePackResponse,\n  ListLanguagePackErrorCodes\n>;\n\nexport class ListLanguagePackCommandError extends DeviceExchangeError<ListLanguagePackErrorCodes> {\n  constructor({\n    message,\n    errorCode,\n  }: CommandErrorArgs<ListLanguagePackErrorCodes>) {\n    super({ message, errorCode, tag: \"ListLanguagePackCommandError\" });\n  }\n}\n\nexport class ListLanguagePackCommand\n  implements\n    Command<\n      ListLanguagePackResponse,\n      ListLanguagePackCommandArgs,\n      ListLanguagePackErrorCodes\n    >\n{\n  readonly name = \"listLanguagePack\";\n\n  constructor(private args: ListLanguagePackCommandArgs) {}\n\n  getApdu(): Apdu {\n    const apduArgs: ApduBuilderArgs = {\n      cla: 0xe0,\n      ins: 0x34,\n      p1: this.args.firstChunk ? 0x00 : 0x01,\n      p2: 0x00,\n    };\n    return new ApduBuilder(apduArgs).build();\n  }\n\n  parseResponse(apduResponse: ApduResponse): ListLanguagePackCommandResult {\n    const parser = new ApduParser(apduResponse);\n\n    if (!CommandUtils.isSuccessResponse(apduResponse)) {\n      const errorCode = parser.encodeToHexaString(apduResponse.statusCode);\n      if (isCommandErrorCode(errorCode, LANGUAGE_PACK_ERRORS)) {\n        return CommandResultFactory({\n          error: new ListLanguagePackCommandError({\n            ...LANGUAGE_PACK_ERRORS[errorCode],\n            errorCode,\n          }),\n        });\n      }\n      return CommandResultFactory({\n        error: GlobalCommandErrorHandler.handle(apduResponse),\n      });\n    }\n\n    const tlvVersion = parser.extract8BitUInt();\n    if (tlvVersion === undefined) {\n      // No more language package\n      return CommandResultFactory({\n        data: undefined,\n      });\n    }\n\n    parser.extract8BitUInt(); // total length\n    const idBuffer = parser.extractFieldLVEncoded();\n    if (idBuffer === undefined) {\n      return CommandResultFactory({\n        error: new InvalidStatusWordError(\"Failed to get language pack id\"),\n      });\n    }\n\n    const sizeBuffer = parser.extractFieldLVEncoded();\n    if (sizeBuffer === undefined) {\n      return CommandResultFactory({\n        error: new InvalidStatusWordError(\"Failed to get language pack size\"),\n      });\n    }\n\n    const id = parseInt(bufferToHexaString(idBuffer), 16);\n    const size = parseInt(bufferToHexaString(sizeBuffer), 16);\n    return CommandResultFactory({\n      data: { id, size },\n    });\n  }\n}\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,6BAAAE,EAAA,iCAAAC,IAAA,eAAAC,EAAAJ,GACA,IAAAK,EAAkD,uCAClDC,EAA2B,sCAE3BC,EAAuC,+BACvCC,EAGO,4CACPC,EAGO,4CACPC,EAA6B,2CAC7BC,EAA0C,iDAE1CC,EAA2D,sBAC3DC,EAAmC,iCAenC,MAAMC,EAAkE,CACtE,OAAQ,CACN,QACE,iFACJ,CACF,EAOO,MAAMX,UAAqC,qBAAgD,CAChG,YAAY,CACV,QAAAY,EACA,UAAAC,CACF,EAAiD,CAC/C,MAAM,CAAE,QAAAD,EAAS,UAAAC,EAAW,IAAK,8BAA+B,CAAC,CACnE,CACF,CAEO,MAAMd,CAOb,CAGE,YAAoBe,EAAmC,CAAnC,UAAAA,CAAoC,CAF/C,KAAO,mBAIhB,SAAgB,CACd,MAAMC,EAA4B,CAChC,IAAK,IACL,IAAK,GACL,GAAI,KAAK,KAAK,WAAa,EAAO,EAClC,GAAI,CACN,EACA,OAAO,IAAI,cAAYA,CAAQ,EAAE,MAAM,CACzC,CAEA,cAAcC,EAA2D,CACvE,MAAMC,EAAS,IAAI,aAAWD,CAAY,EAE1C,GAAI,CAAC,eAAa,kBAAkBA,CAAY,EAAG,CACjD,MAAMH,EAAYI,EAAO,mBAAmBD,EAAa,UAAU,EACnE,SAAI,sBAAmBH,EAAWF,CAAoB,KAC7C,wBAAqB,CAC1B,MAAO,IAAIX,EAA6B,CACtC,GAAGW,EAAqBE,CAAS,EACjC,UAAAA,CACF,CAAC,CACH,CAAC,KAEI,wBAAqB,CAC1B,MAAO,4BAA0B,OAAOG,CAAY,CACtD,CAAC,CACH,CAGA,GADmBC,EAAO,gBAAgB,IACvB,OAEjB,SAAO,wBAAqB,CAC1B,KAAM,MACR,CAAC,EAGHA,EAAO,gBAAgB,EACvB,MAAMC,EAAWD,EAAO,sBAAsB,EAC9C,GAAIC,IAAa,OACf,SAAO,wBAAqB,CAC1B,MAAO,IAAI,yBAAuB,gCAAgC,CACpE,CAAC,EAGH,MAAMC,EAAaF,EAAO,sBAAsB,EAChD,GAAIE,IAAe,OACjB,SAAO,wBAAqB,CAC1B,MAAO,IAAI,yBAAuB,kCAAkC,CACtE,CAAC,EAGH,MAAMC,EAAK,YAAS,sBAAmBF,CAAQ,EAAG,EAAE,EAC9CG,EAAO,YAAS,sBAAmBF,CAAU,EAAG,EAAE,EACxD,SAAO,wBAAqB,CAC1B,KAAM,CAAE,GAAAC,EAAI,KAAAC,CAAK,CACnB,CAAC,CACH,CACF",
  "names": ["ListLanguagePackCommand_exports", "__export", "ListLanguagePackCommand", "ListLanguagePackCommandError", "__toCommonJS", "import_ApduBuilder", "import_ApduParser", "import_Errors", "import_CommandResult", "import_CommandErrors", "import_CommandUtils", "import_GlobalCommandError", "import_Error", "import_HexaString", "LANGUAGE_PACK_ERRORS", "message", "errorCode", "args", "apduArgs", "apduResponse", "parser", "idBuffer", "sizeBuffer", "id", "size"]
}
