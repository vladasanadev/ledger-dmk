{
  "version": 3,
  "sources": ["../../../../../../src/api/command/os/GetAppAndVersionCommand.ts"],
  "sourcesContent": ["import { type Apdu } from \"@api/apdu/model/Apdu\";\nimport { ApduBuilder, type ApduBuilderArgs } from \"@api/apdu/utils/ApduBuilder\";\nimport { ApduParser } from \"@api/apdu/utils/ApduParser\";\nimport { type Command } from \"@api/command/Command\";\nimport { InvalidResponseFormatError } from \"@api/command/Errors\";\nimport {\n  type CommandResult,\n  CommandResultFactory,\n} from \"@api/command/model/CommandResult\";\nimport { CommandUtils } from \"@api/command/utils/CommandUtils\";\nimport { GlobalCommandErrorHandler } from \"@api/command/utils/GlobalCommandError\";\nimport { type ApduResponse } from \"@api/device-session/ApduResponse\";\n\nexport type GetAppAndVersionResponse = {\n  /**\n   * The name of the application currently running on the device.\n   */\n  readonly name: string;\n  /**\n   * The version of the application currently running on the device.\n   */\n  readonly version: string;\n  /**\n   * Flags that are used to provide additional information about the application.\n   */\n  readonly flags?: number | Uint8Array;\n};\n\nexport type GetAppAndVersionCommandResult =\n  CommandResult<GetAppAndVersionResponse>;\n\n/**\n * Command to get information about the application currently running on the\n * device.\n */\nexport class GetAppAndVersionCommand\n  implements Command<GetAppAndVersionResponse>\n{\n  readonly name = \"getAppAndVersion\";\n  readonly args = undefined;\n\n  getApdu(): Apdu {\n    const getAppAndVersionApduArgs: ApduBuilderArgs = {\n      cla: 0xb0,\n      ins: 0x01,\n      p1: 0x00,\n      p2: 0x00,\n    };\n    return new ApduBuilder(getAppAndVersionApduArgs).build();\n  }\n\n  parseResponse(apduResponse: ApduResponse): GetAppAndVersionCommandResult {\n    if (!CommandUtils.isSuccessResponse(apduResponse)) {\n      return CommandResultFactory({\n        error: GlobalCommandErrorHandler.handle(apduResponse),\n      });\n    }\n    const parser = new ApduParser(apduResponse);\n\n    if (parser.extract8BitUInt() !== 1) {\n      return CommandResultFactory({\n        error: new InvalidResponseFormatError(\n          \"getAppAndVersion: format not supported\",\n        ),\n      });\n    }\n\n    const name = parser.encodeToString(parser.extractFieldLVEncoded());\n    const version = parser.encodeToString(parser.extractFieldLVEncoded());\n\n    if (parser.getUnparsedRemainingLength() === 0) {\n      return CommandResultFactory({\n        data: { name, version },\n      });\n    }\n\n    const flags = parser.extractFieldLVEncoded();\n    return CommandResultFactory({\n      data: { name, version, flags },\n    });\n  }\n}\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,6BAAAE,IAAA,eAAAC,EAAAH,GACA,IAAAI,EAAkD,uCAClDC,EAA2B,sCAE3BC,EAA2C,+BAC3CC,EAGO,4CACPC,EAA6B,2CAC7BC,EAA0C,iDAyBnC,MAAMP,CAEb,CACW,KAAO,mBACP,KAAO,OAEhB,SAAgB,CACd,MAAMQ,EAA4C,CAChD,IAAK,IACL,IAAK,EACL,GAAI,EACJ,GAAI,CACN,EACA,OAAO,IAAI,cAAYA,CAAwB,EAAE,MAAM,CACzD,CAEA,cAAcC,EAA2D,CACvE,GAAI,CAAC,eAAa,kBAAkBA,CAAY,EAC9C,SAAO,wBAAqB,CAC1B,MAAO,4BAA0B,OAAOA,CAAY,CACtD,CAAC,EAEH,MAAMC,EAAS,IAAI,aAAWD,CAAY,EAE1C,GAAIC,EAAO,gBAAgB,IAAM,EAC/B,SAAO,wBAAqB,CAC1B,MAAO,IAAI,6BACT,wCACF,CACF,CAAC,EAGH,MAAMC,EAAOD,EAAO,eAAeA,EAAO,sBAAsB,CAAC,EAC3DE,EAAUF,EAAO,eAAeA,EAAO,sBAAsB,CAAC,EAEpE,GAAIA,EAAO,2BAA2B,IAAM,EAC1C,SAAO,wBAAqB,CAC1B,KAAM,CAAE,KAAAC,EAAM,QAAAC,CAAQ,CACxB,CAAC,EAGH,MAAMC,EAAQH,EAAO,sBAAsB,EAC3C,SAAO,wBAAqB,CAC1B,KAAM,CAAE,KAAAC,EAAM,QAAAC,EAAS,MAAAC,CAAM,CAC/B,CAAC,CACH,CACF",
  "names": ["GetAppAndVersionCommand_exports", "__export", "GetAppAndVersionCommand", "__toCommonJS", "import_ApduBuilder", "import_ApduParser", "import_Errors", "import_CommandResult", "import_CommandUtils", "import_GlobalCommandError", "getAppAndVersionApduArgs", "apduResponse", "parser", "name", "version", "flags"]
}
