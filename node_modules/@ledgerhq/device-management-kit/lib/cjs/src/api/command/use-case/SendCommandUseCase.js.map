{
  "version": 3,
  "sources": ["../../../../../../src/api/command/use-case/SendCommandUseCase.ts"],
  "sourcesContent": ["import { inject, injectable } from \"inversify\";\n\nimport { Command } from \"@api/command/Command\";\nimport { CommandResult } from \"@api/command/model/CommandResult\";\nimport { type LoggerPublisherService } from \"@api/logger-publisher/service/LoggerPublisherService\";\nimport { deviceSessionTypes } from \"@internal/device-session/di/deviceSessionTypes\";\nimport type { DeviceSessionService } from \"@internal/device-session/service/DeviceSessionService\";\nimport { loggerTypes } from \"@internal/logger-publisher/di/loggerTypes\";\n\nexport type SendCommandUseCaseArgs<Response, ErrorStatusCodes, Args = void> = {\n  /**\n   * The device session id.\n   */\n  readonly sessionId: string;\n  /**\n   * The command to send.\n   */\n  readonly command: Command<Response, ErrorStatusCodes, Args>;\n  /**\n   * The timeout to abort the command.\n   */\n  readonly abortTimeout?: number;\n};\n\n/**\n * Sends a command to a device through a device session.\n */\n@injectable()\nexport class SendCommandUseCase {\n  private readonly _sessionService: DeviceSessionService;\n  private readonly _logger: LoggerPublisherService;\n  constructor(\n    @inject(deviceSessionTypes.DeviceSessionService)\n    sessionService: DeviceSessionService,\n    @inject(loggerTypes.LoggerPublisherServiceFactory)\n    loggerFactory: (tag: string) => LoggerPublisherService,\n  ) {\n    this._sessionService = sessionService;\n    this._logger = loggerFactory(\"SendCommandUseCase\");\n  }\n\n  /**\n   * Sends a command to a device through a device session.\n   *\n   * @param sessionId - The device session id.\n   * @param command - The command to send.\n   * @returns The response from the command.\n   */\n  async execute<Response, Args, ErrorStatusCodes>({\n    sessionId,\n    command,\n    abortTimeout,\n  }: SendCommandUseCaseArgs<Response, Args, ErrorStatusCodes>): Promise<\n    CommandResult<Response, ErrorStatusCodes>\n  > {\n    const deviceSessionOrError =\n      this._sessionService.getDeviceSessionById(sessionId);\n\n    return deviceSessionOrError.caseOf({\n      // Case device session found\n      Right: async (deviceSession) =>\n        await deviceSession.sendCommand<Response, Args, ErrorStatusCodes>(\n          command,\n          abortTimeout,\n        ),\n      // Case device session not found\n      Left: (error) => {\n        this._logger.error(\"Error getting session\", {\n          data: { error },\n        });\n        throw error;\n      },\n    });\n  }\n}\n"],
  "mappings": "okBAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,wBAAAE,IAAA,eAAAC,EAAAH,GAAA,IAAAI,EAAmC,qBAKnCC,EAAmC,0DAEnCC,EAA4B,qDAqBrB,IAAMC,EAAN,KAAyB,CACb,gBACA,QACjB,YAEEC,EAEAC,EACA,CACA,KAAK,gBAAkBD,EACvB,KAAK,QAAUC,EAAc,oBAAoB,CACnD,CASA,MAAM,QAA0C,CAC9C,UAAAC,EACA,QAAAC,EACA,aAAAC,CACF,EAEE,CAIA,OAFE,KAAK,gBAAgB,qBAAqBF,CAAS,EAEzB,OAAO,CAEjC,MAAO,MAAOG,GACZ,MAAMA,EAAc,YAClBF,EACAC,CACF,EAEF,KAAOE,GAAU,CACf,WAAK,QAAQ,MAAM,wBAAyB,CAC1C,KAAM,CAAE,MAAAA,CAAM,CAChB,CAAC,EACKA,CACR,CACF,CAAC,CACH,CACF,EA9CaP,EAANQ,EAAA,IADN,cAAW,EAKPC,EAAA,eAAO,qBAAmB,oBAAoB,GAE9CA,EAAA,eAAO,cAAY,6BAA6B,IANxCT",
  "names": ["SendCommandUseCase_exports", "__export", "SendCommandUseCase", "__toCommonJS", "import_inversify", "import_deviceSessionTypes", "import_loggerTypes", "SendCommandUseCase", "sessionService", "loggerFactory", "sessionId", "command", "abortTimeout", "deviceSession", "error", "__decorateClass", "__decorateParam"]
}
