"use strict";var h=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var f=(a,t)=>{for(var r in t)h(a,r,{get:t[r],enumerable:!0})},g=(a,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of m(t))!y.call(a,e)&&e!==r&&h(a,e,{get:()=>t[e],enumerable:!(n=b(t,e))||n.enumerable});return a};var l=a=>g(h({},"__esModule",{value:!0}),a);var A={};f(A,{ByteArrayBuilder:()=>D});module.exports=l(A);var B=require("../../utils/HexaString"),i=require("./AppBuilderError");const T=4294967295;class D{constructor(t=T){this.maxPayloadSize=t}data=new Uint8Array;errors=[];build=()=>this.data;tryBuild=()=>this.hasErrors()?void 0:this.data;add8BitUIntToData=t=>this.addNumberToData(t,8n,!1,!1);add16BitUIntToData=(t,r=!0)=>this.addNumberToData(t,16n,!1,r);add32BitUIntToData=(t,r=!0)=>this.addNumberToData(t,32n,!1,r);add64BitUIntToData=(t,r=!0)=>this.addNumberToData(t,64n,!1,r);add128BitUIntToData=(t,r=!0)=>this.addNumberToData(t,128n,!1,r);add256BitUIntToData=(t,r=!0)=>this.addNumberToData(t,256n,!1,r);add16BitIntToData=(t,r=!0)=>this.addNumberToData(t,16n,!0,r);add32BitIntToData=(t,r=!0)=>this.addNumberToData(t,32n,!0,r);add64BitIntToData=(t,r=!0)=>this.addNumberToData(t,64n,!0,r);add128BitIntToData=(t,r=!0)=>this.addNumberToData(t,128n,!0,r);add256BitIntToData=(t,r=!0)=>this.addNumberToData(t,256n,!0,r);addBufferToData=t=>this.hasEnoughLengthRemaining(t)?(this.data=Uint8Array.from([...this.data,...t]),this):(this.errors.push(new i.DataOverflowError(t.toString())),this);addHexaStringToData=t=>{const r=(0,B.hexaStringToBuffer)(t);return r===null||r.length===0?(this.errors.push(new i.HexaStringEncodeError(t)),this):(this.addBufferToData(r),this)};addAsciiStringToData=t=>{const r=new TextEncoder().encode(t);return this.addBufferToData(r),this};encodeInLVFromHexa=t=>{const r=(0,B.hexaStringToBuffer)(t);return r===null||r.length===0?(this.errors.push(new i.HexaStringEncodeError(t)),this):this.hasEnoughLengthRemaining(r,!0)?(this.add8BitUIntToData(r.length),this.addBufferToData(r),this):(this.errors.push(new i.DataOverflowError(t)),this)};encodeInLVFromBuffer=t=>this.hasEnoughLengthRemaining(t,!0)?(this.add8BitUIntToData(t.length),this.addBufferToData(t),this):(this.errors.push(new i.DataOverflowError(t.toString())),this);encodeInLVFromAscii=t=>this.hasEnoughLengthRemaining(t,!0)?(this.add8BitUIntToData(t.length),this.addAsciiStringToData(t),this):(this.errors.push(new i.DataOverflowError(t)),this);encodeInTLVFromAscii=(t,r)=>(this.add8BitUIntToData(t),this.encodeInLVFromAscii(r));encodeInTLVFromHexa=(t,r)=>(this.add8BitUIntToData(t),this.encodeInLVFromHexa(r));encodeInTLVFromBuffer=(t,r)=>(this.add8BitUIntToData(t),this.encodeInLVFromBuffer(r));encodeInTLVFromUInt8=(t,r)=>(this.add8BitUIntToData(t),this.add8BitUIntToData(1),this.add8BitUIntToData(r));encodeInTLVFromUInt16=(t,r,n=!0)=>(this.add8BitUIntToData(t),this.add8BitUIntToData(2),this.add16BitUIntToData(r,n));encodeInTLVFromUInt32=(t,r,n=!0)=>(this.add8BitUIntToData(t),this.add8BitUIntToData(4),this.add32BitUIntToData(r,n));encodeInTLVFromUInt64=(t,r,n=!0)=>(this.add8BitUIntToData(t),this.add8BitUIntToData(8),this.add64BitUIntToData(r,n));getAvailablePayloadLength=()=>this.maxPayloadSize-this.data.length;getErrors=()=>this.errors;hasErrors=()=>this.errors.length!==0;hasEnoughLengthRemaining=(t,r=!1)=>this.data.length+t.length+(r?1:0)<=this.maxPayloadSize;addNumberToData(t,r,n,e){let o=this.checkBoundsAndConvert(t,r,n);if(o===void 0)return this;const u=Number(r)/8,s=new Uint8Array(u);if(e)for(let d=u-1;d>=0;d--)s[d]=Number(o&0xffn),o>>=8n;else for(let d=0;d<u;d++)s[d]=Number(o&0xffn),o>>=8n;return this.addBufferToData(s)}checkBoundsAndConvert(t,r,n){if(typeof t=="number"){if(!Number.isInteger(t)||t>Number.MAX_SAFE_INTEGER){this.errors.push(new i.ValueOverflowError(t.toString()));return}t=BigInt(t)}if(n){const e=1n<<r-1n;if(t>=e||t<-e){this.errors.push(new i.ValueOverflowError(t.toString(),e-1n));return}if(t<0n){const o=(1n<<r)-1n;t=-t,t=(~t&o)+1n}}else{const e=1n<<r;if(t<0||t>=e){this.errors.push(new i.ValueOverflowError(t.toString(),e-1n));return}}return t}}0&&(module.exports={ByteArrayBuilder});
//# sourceMappingURL=ByteArrayBuilder.js.map
