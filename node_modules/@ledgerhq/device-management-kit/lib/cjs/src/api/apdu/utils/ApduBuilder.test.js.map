{
  "version": 3,
  "sources": ["../../../../../../src/api/apdu/utils/ApduBuilder.test.ts"],
  "sourcesContent": ["import { APDU_MAX_PAYLOAD, ApduBuilder } from \"./ApduBuilder\";\nimport { ValueOverflowError } from \"./AppBuilderError\";\n\nconst COMMAND_NO_BODY = new Uint8Array([0xe0, 0x01, 0x00, 0x00, 0x00]);\n\nconst COMMAND_BODY_SINGLE = new Uint8Array([\n  0xe0, 0x01, 0x00, 0x00, 0x01, 0x01,\n]);\n\nconst COMMAND_BODY_TWO = new Uint8Array([\n  0xe0, 0x01, 0x00, 0x00, 0x02, 0x33, 0x02,\n]);\n\nconst COMMAND_BODY_EIGHT = new Uint8Array([\n  0xe0, 0x01, 0x00, 0x00, 0x04, 0x01, 0x23, 0x45, 0x67,\n]);\n\nconst COMMAND_BODY_HEXA1 = new Uint8Array([\n  0xe0, 0x01, 0x00, 0x00, 0x05, 0x80, 0x81, 0x82, 0x83, 0x84,\n]);\n\nconst COMMAND_BODY_HEXA2 = new Uint8Array([\n  0xe0, 0x01, 0x00, 0x00, 0x04, 0x85, 0x86, 0x87, 0x88,\n]);\n\nconst COMMAND_BODY_LV_HEXA = new Uint8Array([\n  0xe0, 0x01, 0x00, 0x00, 0x04, 0x03, 0xa1, 0xa2, 0xa3,\n]);\n\nconst COMMAND_BODY_LV_ASCII = new Uint8Array([\n  0xe0, 0x01, 0x00, 0x00, 0x06, 0x05, 0x6d, 0x61, 0x6d, 0x61, 0x6e,\n]);\n\nconst COMMAND_BODY_LV_ARRAY = new Uint8Array([\n  0xe0, 0x01, 0x00, 0x00, 0x03, 0x02, 0xf0, 0xf1,\n]);\n\nconst COMMAND_BODY_MAX = new Uint8Array([\n  0xe0,\n  0x01,\n  0x00,\n  0x00,\n  0xff,\n  ...Array<number>(255).fill(0xaa),\n]);\n\nlet builder: ApduBuilder;\n\ndescribe(\"ApduBuilder\", () => {\n  describe(\"clean\", () => {\n    beforeEach(() => {\n      builder = new ApduBuilder({ cla: 0xe0, ins: 0x01, p1: 0x00, p2: 0x00 });\n    });\n\n    it(\"should create an instance\", () => {\n      expect(builder).toBeDefined();\n      expect(builder).toBeInstanceOf(ApduBuilder);\n    });\n  });\n\n  describe(\"simple\", () => {\n    beforeEach(() => {\n      builder = new ApduBuilder({ cla: 0xe0, ins: 0x01, p1: 0x00, p2: 0x00 });\n    });\n\n    it(\"should serialize with an empty body\", () => {\n      expect(builder.build().getRawApdu()).toEqual(COMMAND_NO_BODY);\n    });\n\n    it(\"should serialize with an single byte body\", () => {\n      builder.add8BitUIntToData(0x01);\n      expect(builder.build().getRawApdu()).toEqual(COMMAND_BODY_SINGLE);\n      expect(builder.getErrors()).toEqual([]);\n    });\n\n    it(\"should serialize with an 2 byte body\", () => {\n      builder.add16BitUIntToData(0x3302);\n      expect(builder.build().getRawApdu()).toEqual(COMMAND_BODY_TWO);\n      expect(builder.getErrors()).toEqual([]);\n    });\n\n    it(\"should serialize with an 8 byte body from an hexastring\", () => {\n      builder.add32BitUIntToData(0x01234567);\n      expect(builder.build().getRawApdu()).toEqual(COMMAND_BODY_EIGHT);\n      expect(builder.getErrors()).toEqual([]);\n    });\n\n    it(\"should serialize with an 5 byte body from an hexastring\", () => {\n      builder.addHexaStringToData(\"0x8081828384\");\n      expect(builder.build().getRawApdu()).toEqual(COMMAND_BODY_HEXA1);\n      expect(builder.getErrors()).toEqual([]);\n    });\n\n    it(\"should serialize with an 4 byte body from an hexastring without '0x'\", () => {\n      builder.addHexaStringToData(\"85868788\");\n      expect(builder.build().getRawApdu()).toEqual(COMMAND_BODY_HEXA2);\n      expect(builder.getErrors()).toEqual([]);\n    });\n\n    it(\"should serialize with an 4 byte body LV encoded from an hexastring\", () => {\n      builder.encodeInLVFromHexa(\"0xA1A2A3\");\n      expect(builder.build().getRawApdu()).toEqual(COMMAND_BODY_LV_HEXA);\n      expect(builder.getErrors()).toEqual([]);\n    });\n\n    it(\"should serialize with an 4 byte body LV encoded from an ascci string\", () => {\n      builder.encodeInLVFromAscii(\"maman\");\n      expect(builder.build().getRawApdu()).toEqual(COMMAND_BODY_LV_ASCII);\n      expect(builder.getErrors()).toEqual([]);\n    });\n\n    it(\"should serialize with an 4 byte body LV encoded from a buffer\", () => {\n      const myarray = new Uint8Array([0xf0, 0xf1]);\n      builder.encodeInLVFromBuffer(myarray);\n      expect(builder.build().getRawApdu()).toEqual(COMMAND_BODY_LV_ARRAY);\n      expect(builder.getErrors()).toEqual([]);\n    });\n\n    it(\"should serialize with an 4 byte body LV encoded from a buffer\", () => {\n      const myarray = new Uint8Array([0xf0, 0xf1]);\n      builder.encodeInLVFromBuffer(myarray);\n      expect(builder.build().getRawApdu()).toEqual(COMMAND_BODY_LV_ARRAY);\n      expect(builder.getErrors()).toEqual([]);\n    });\n\n    it(\"should serialize with an complete body of 0xAA\", () => {\n      const myarray = new Uint8Array(255).fill(0xaa, 0, 255);\n      builder.addBufferToData(myarray);\n      expect(builder.build().getRawApdu()).toEqual(COMMAND_BODY_MAX);\n      expect(builder.getErrors()).toEqual([]);\n    });\n  });\n\n  describe(\"error\", () => {\n    beforeEach(() => {\n      builder = new ApduBuilder({ cla: 0xe0, ins: 0x01, p1: 0x00, p2: 0x00 });\n    });\n\n    it(\"error due value greater than 8-bit integer\", () => {\n      builder.add8BitUIntToData(0x100);\n      expect(builder.build().getRawApdu()).toEqual(COMMAND_NO_BODY);\n      expect(builder.getAvailablePayloadLength()).toBe(APDU_MAX_PAYLOAD);\n      expect(builder.getErrors()).toEqual([\n        new ValueOverflowError((0x100).toString(), 255),\n      ]);\n    });\n  });\n});\n"],
  "mappings": "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",
  "names": ["import_ApduBuilder", "import_AppBuilderError", "COMMAND_NO_BODY", "COMMAND_BODY_SINGLE", "COMMAND_BODY_TWO", "COMMAND_BODY_EIGHT", "COMMAND_BODY_HEXA1", "COMMAND_BODY_HEXA2", "COMMAND_BODY_LV_HEXA", "COMMAND_BODY_LV_ASCII", "COMMAND_BODY_LV_ARRAY", "COMMAND_BODY_MAX", "builder", "myarray"]
}
