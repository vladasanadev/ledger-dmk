{
  "version": 3,
  "sources": ["../../../../../../src/api/apdu/utils/ApduBuilder.ts"],
  "sourcesContent": ["import { Apdu } from \"@api/apdu/model/Apdu\";\n\nimport { type AppBuilderError } from \"./AppBuilderError\";\nimport { ByteArrayBuilder } from \"./ByteArrayBuilder\";\n\nexport const HEADER_LENGTH = 5;\nexport const APDU_MAX_PAYLOAD = 255;\nexport const APDU_MAX_SIZE = APDU_MAX_PAYLOAD + 5;\n\nexport type ApduBuilderArgs = {\n  readonly ins: number;\n  readonly cla: number;\n  readonly p1: number;\n  readonly p2: number;\n};\n\n/**\n * ApduBuilder is a utility class to help build APDU commands.\n * It allows to easily add data to the data field of the APDU command\n * and to encode this data in different formats.\n *\n * @example\n * ```\n * const apduBuilder = new ApduBuilder({ ins: 0x01, cla: 0x02, p1: 0x03, p2: 0x04 })\n *  .add8BitUIntToData(0x05)\n *  .add16BitUIntToData(0x0607)\n *  .addHexaStringToData(\"0x0809\")\n *  .addAsciiStringToData(\"hello\")\n *\n * const apdu = apduBuilder.build();\n * const builderErrors = apduBuilder.getErrors();\n * ```\n */\nexport class ApduBuilder {\n  private readonly _ins: number;\n  private readonly _cla: number;\n  private readonly _p1: number;\n  private readonly p2: number;\n  private data: ByteArrayBuilder = new ByteArrayBuilder(APDU_MAX_PAYLOAD);\n\n  constructor({ ins, cla, p1, p2 }: ApduBuilderArgs) {\n    this._cla = cla & 0xff;\n    this._ins = ins & 0xff;\n    this._p1 = p1 & 0xff;\n    this.p2 = p2 & 0xff;\n  }\n\n  // ==========\n  // Public API\n  // ==========\n\n  /**\n   * Build a new Apdu instance with the current state of the builder\n   * @returns {Apdu} - Returns a new Apdu instance\n   */\n  build = (): Apdu =>\n    new Apdu(this._cla, this._ins, this._p1, this.p2, this.data.build());\n\n  /**\n   * Add a 8-bit unsigned integer to the data field (max value 0xff = 255)\n   * @param value?: number - The value to add to the data\n   * @returns {ApduBuilder} - Returns the current instance of ApduBuilder\n   */\n  add8BitUIntToData = (value: number): ApduBuilder => {\n    this.data.add8BitUIntToData(value);\n    return this;\n  };\n\n  /**\n   * Add a 16-bit unsigned integer to the data field (max value 0xffff = 65535)\n   * @param value: number - The value to add to the data\n   * @returns {ApduBuilder} - Returns the current instance of ApduBuilder\n   */\n  add16BitUIntToData = (value: number): ApduBuilder => {\n    this.data.add16BitUIntToData(value);\n    return this;\n  };\n\n  /**\n   * Add a 32-bit unsigned integer to the data field (max value 0xffffffff = 4294967295)\n   * @param value: number - The value to add to the data\n   * @returns {ApduBuilder} - Returns the current instance of ApduBuilder\n   */\n  add32BitUIntToData = (value: number): ApduBuilder => {\n    this.data.add32BitUIntToData(value);\n    return this;\n  };\n\n  /**\n   * Add a Uint8Array to the data field if it has enough remaining space\n   * @param value: Uint8Array - The value to add to the data\n   * @returns {ApduBuilder} - Returns the current instance of ApduBuilder\n   */\n  addBufferToData = (value: Uint8Array): ApduBuilder => {\n    this.data.addBufferToData(value);\n    return this;\n  };\n\n  /**\n   * Add a string to the data field if it has enough remaining space\n   * and it can be formatted as a hexadecimal string\n   * @param value: string - The value to add to the data\n   * @returns {ApduBuilder} - Returns the current instance of ApduBuilder\n   */\n  addHexaStringToData = (value: string): ApduBuilder => {\n    this.data.addHexaStringToData(value);\n    return this;\n  };\n\n  /**\n   * Add an ascii string to the data field if it has enough remaining space\n   * @param value: string - The value to add to the data\n   * @returns {ApduBuilder} - Returns the current instance of ApduBuilder\n   */\n  addAsciiStringToData = (value: string): ApduBuilder => {\n    this.data.addAsciiStringToData(value);\n    return this;\n  };\n\n  /**\n   * Add a Length-Value encoded hexadecimal string to the data field if it has enough remaining space\n   * Length-Value encoding is a way to encode data in a binary format with the first byte\n   * being the length of the data and the following bytes being the data itself\n   * @param value: string - The value to add to the data\n   * @returns {ApduBuilder} - Returns the current instance of ApduBuilder\n   */\n  encodeInLVFromHexa = (value: string): ApduBuilder => {\n    this.data.encodeInLVFromHexa(value);\n    return this;\n  };\n\n  /**\n   * Add a Length-Value encoded buffer to the data field if it has enough remaining space\n   * Length-Value encoding is a way to encode data in a binary format with the first byte\n   * being the length of the data and the following bytes being the data itself\n   * @param value: Uint8Array - The value to add to the data\n   * @returns {ApduBuilder} - Returns the current instance of ApduBuilder\n   */\n  encodeInLVFromBuffer = (value: Uint8Array): ApduBuilder => {\n    this.data.encodeInLVFromBuffer(value);\n    return this;\n  };\n\n  /**\n   * Add a Length-Value encoded ascii string to the data field if it has enough remaining space\n   * Length-Value encoding is a way to encode data in a binary format with the first byte\n   * being the length of the data and the following bytes being the data itself\n   * @param value: string - The value to add to the data\n   * @returns {ApduBuilder} - Returns the current instance of ApduBuilder\n   */\n  encodeInLVFromAscii = (value: string): ApduBuilder => {\n    this.data.encodeInLVFromAscii(value);\n    return this;\n  };\n\n  /**\n   * Returns the remaining payload length\n   * @returns {number}\n   */\n  getAvailablePayloadLength = (): number =>\n    this.data.getAvailablePayloadLength();\n\n  /**\n   * Returns the current errors\n   * @returns {AppBuilderError[]} - Returns an array of errors\n   */\n  getErrors = (): AppBuilderError[] => this.data.getErrors();\n}\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,sBAAAE,EAAA,kBAAAC,EAAA,gBAAAC,EAAA,kBAAAC,IAAA,eAAAC,EAAAN,GAAA,IAAAO,EAAqB,gCAGrBC,EAAiC,8BAE1B,MAAMH,EAAgB,EAChBH,EAAmB,IACnBC,EAAgBD,EAAmB,EA0BzC,MAAME,CAAY,CACN,KACA,KACA,IACA,GACT,KAAyB,IAAI,mBAAiBF,CAAgB,EAEtE,YAAY,CAAE,IAAAO,EAAK,IAAAC,EAAK,GAAAC,EAAI,GAAAC,CAAG,EAAoB,CACjD,KAAK,KAAOF,EAAM,IAClB,KAAK,KAAOD,EAAM,IAClB,KAAK,IAAME,EAAK,IAChB,KAAK,GAAKC,EAAK,GACjB,CAUA,MAAQ,IACN,IAAI,OAAK,KAAK,KAAM,KAAK,KAAM,KAAK,IAAK,KAAK,GAAI,KAAK,KAAK,MAAM,CAAC,EAOrE,kBAAqBC,IACnB,KAAK,KAAK,kBAAkBA,CAAK,EAC1B,MAQT,mBAAsBA,IACpB,KAAK,KAAK,mBAAmBA,CAAK,EAC3B,MAQT,mBAAsBA,IACpB,KAAK,KAAK,mBAAmBA,CAAK,EAC3B,MAQT,gBAAmBA,IACjB,KAAK,KAAK,gBAAgBA,CAAK,EACxB,MAST,oBAAuBA,IACrB,KAAK,KAAK,oBAAoBA,CAAK,EAC5B,MAQT,qBAAwBA,IACtB,KAAK,KAAK,qBAAqBA,CAAK,EAC7B,MAUT,mBAAsBA,IACpB,KAAK,KAAK,mBAAmBA,CAAK,EAC3B,MAUT,qBAAwBA,IACtB,KAAK,KAAK,qBAAqBA,CAAK,EAC7B,MAUT,oBAAuBA,IACrB,KAAK,KAAK,oBAAoBA,CAAK,EAC5B,MAOT,0BAA4B,IAC1B,KAAK,KAAK,0BAA0B,EAMtC,UAAY,IAAyB,KAAK,KAAK,UAAU,CAC3D",
  "names": ["ApduBuilder_exports", "__export", "APDU_MAX_PAYLOAD", "APDU_MAX_SIZE", "ApduBuilder", "HEADER_LENGTH", "__toCommonJS", "import_Apdu", "import_ByteArrayBuilder", "ins", "cla", "p1", "p2", "value"]
}
