{
  "version": 3,
  "sources": ["../../../../../../src/api/device-model/data/StaticDeviceModelDataSource.ts"],
  "sourcesContent": ["import { injectable } from \"inversify\";\nimport semver from \"semver\";\n\nimport { DeviceModelId } from \"@api/device/DeviceModel\";\nimport { DeviceModelDataSource } from \"@api/device-model/data/DeviceModelDataSource\";\nimport { BleDeviceInfos } from \"@api/device-model/model/BleDeviceInfos\";\nimport { TransportDeviceModel } from \"@api/device-model/model/DeviceModel\";\n\n/**\n * Static/in memory implementation of the device model data source\n */\n@injectable()\nexport class StaticDeviceModelDataSource implements DeviceModelDataSource {\n  private static deviceModelByIds: {\n    [_key in DeviceModelId]: TransportDeviceModel;\n  } = {\n    [DeviceModelId.NANO_S]: new TransportDeviceModel({\n      id: DeviceModelId.NANO_S,\n      productName: \"Ledger Nano S\",\n      usbProductId: 0x10,\n      bootloaderUsbProductId: 0x0001,\n      usbOnly: true,\n      memorySize: 320 * 1024,\n      getBlockSize: (p: { firmwareVersion: string }) =>\n        semver.lt(semver.coerce(p.firmwareVersion) ?? \"\", \"2.0.0\")\n          ? 4 * 1024\n          : 2 * 1024,\n      masks: [0x31100000],\n    }),\n    [DeviceModelId.NANO_SP]: new TransportDeviceModel({\n      id: DeviceModelId.NANO_SP,\n      productName: \"Ledger Nano S Plus\",\n      usbProductId: 0x50,\n      bootloaderUsbProductId: 0x0005,\n      usbOnly: true,\n      memorySize: 1533 * 1024,\n      getBlockSize: () => 32,\n      masks: [0x33100000],\n    }),\n    [DeviceModelId.NANO_X]: new TransportDeviceModel({\n      id: DeviceModelId.NANO_X,\n      productName: \"Ledger Nano X\",\n      usbProductId: 0x40,\n      bootloaderUsbProductId: 0x0004,\n      usbOnly: false,\n      memorySize: 2 * 1024 * 1024,\n      getBlockSize: () => 4 * 1024,\n      masks: [0x33000000],\n      bluetoothSpec: [\n        {\n          serviceUuid: \"13d63400-2c97-0004-0000-4c6564676572\",\n          notifyUuid: \"13d63400-2c97-0004-0001-4c6564676572\",\n          writeUuid: \"13d63400-2c97-0004-0002-4c6564676572\",\n          writeCmdUuid: \"13d63400-2c97-0004-0003-4c6564676572\",\n        },\n      ],\n    }),\n    [DeviceModelId.STAX]: new TransportDeviceModel({\n      id: DeviceModelId.STAX,\n      productName: \"Ledger Stax\",\n      usbProductId: 0x60,\n      bootloaderUsbProductId: 0x0006,\n      usbOnly: false,\n      memorySize: 1533 * 1024,\n      getBlockSize: () => 32,\n      masks: [0x33200000],\n      bluetoothSpec: [\n        {\n          serviceUuid: \"13d63400-2c97-6004-0000-4c6564676572\",\n          notifyUuid: \"13d63400-2c97-6004-0001-4c6564676572\",\n          writeUuid: \"13d63400-2c97-6004-0002-4c6564676572\",\n          writeCmdUuid: \"13d63400-2c97-6004-0003-4c6564676572\",\n        },\n      ],\n    }),\n    [DeviceModelId.FLEX]: new TransportDeviceModel({\n      id: DeviceModelId.FLEX,\n      productName: \"Ledger Flex\",\n      usbProductId: 0x70,\n      bootloaderUsbProductId: 0x0007,\n      usbOnly: false,\n      memorySize: 1533 * 1024,\n      getBlockSize: () => 32,\n      masks: [0x33300000],\n      bluetoothSpec: [\n        {\n          serviceUuid: \"13d63400-2c97-3004-0000-4c6564676572\",\n          notifyUuid: \"13d63400-2c97-3004-0001-4c6564676572\",\n          writeUuid: \"13d63400-2c97-3004-0002-4c6564676572\",\n          writeCmdUuid: \"13d63400-2c97-3004-0003-4c6564676572\",\n        },\n      ],\n    }),\n    [DeviceModelId.APEX]: new TransportDeviceModel({\n      id: DeviceModelId.APEX,\n      productName: \"Ledger Apex\",\n      usbProductId: 0x80,\n      bootloaderUsbProductId: 0x0008,\n      usbOnly: false,\n      memorySize: 1533 * 1024,\n      getBlockSize: () => 32,\n      masks: [0x33400000],\n      bluetoothSpec: [\n        {\n          serviceUuid: \"13d63400-2c97-8004-0000-4c6564676572\",\n          notifyUuid: \"13d63400-2c97-8004-0001-4c6564676572\",\n          writeUuid: \"13d63400-2c97-8004-0002-4c6564676572\",\n          writeCmdUuid: \"13d63400-2c97-8004-0003-4c6564676572\",\n        },\n      ],\n    }),\n  };\n\n  getAllDeviceModels(): TransportDeviceModel[] {\n    return Object.values(StaticDeviceModelDataSource.deviceModelByIds);\n  }\n\n  getDeviceModel(params: { id: DeviceModelId }): TransportDeviceModel {\n    return StaticDeviceModelDataSource.deviceModelByIds[params.id];\n  }\n\n  /**\n   * Returns the list of device models that match all the given parameters\n   */\n  filterDeviceModels(\n    params: Partial<TransportDeviceModel>,\n  ): TransportDeviceModel[] {\n    return this.getAllDeviceModels().filter((deviceModel) => {\n      return Object.entries(params).every(([key, value]) => {\n        return deviceModel[key as keyof TransportDeviceModel] === value;\n      });\n    });\n  }\n\n  getBluetoothServicesInfos(): Record<string, BleDeviceInfos> {\n    return Object.values(StaticDeviceModelDataSource.deviceModelByIds).reduce<\n      Record<string, BleDeviceInfos>\n    >((acc, deviceModel) => {\n      const { bluetoothSpec } = deviceModel;\n      if (bluetoothSpec) {\n        return {\n          ...acc,\n          ...bluetoothSpec.reduce<Record<string, BleDeviceInfos>>(\n            (serviceToModel, bleSpec) => ({\n              ...serviceToModel,\n              [bleSpec.serviceUuid]: new BleDeviceInfos(\n                deviceModel,\n                bleSpec.serviceUuid,\n                bleSpec.writeUuid,\n                bleSpec.writeCmdUuid,\n                bleSpec.notifyUuid,\n              ),\n            }),\n            {},\n          ),\n        };\n      }\n      return acc;\n    }, {});\n  }\n\n  getBluetoothServices(): string[] {\n    return Object.values(StaticDeviceModelDataSource.deviceModelByIds)\n      .map((deviceModel) =>\n        (deviceModel.bluetoothSpec || []).map((spec) => spec.serviceUuid),\n      )\n      .flat()\n      .filter((uuid) => !!uuid);\n  }\n}\n"],
  "mappings": "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",
  "names": ["StaticDeviceModelDataSource_exports", "__export", "StaticDeviceModelDataSource", "__toCommonJS", "import_inversify", "import_semver", "import_DeviceModel", "import_BleDeviceInfos", "StaticDeviceModelDataSource", "params", "deviceModel", "key", "value", "acc", "bluetoothSpec", "serviceToModel", "bleSpec", "spec", "uuid", "__publicField", "p", "semver", "__decorateClass"]
}
