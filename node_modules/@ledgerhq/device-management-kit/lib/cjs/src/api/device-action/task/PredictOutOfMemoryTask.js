"use strict";var u=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var f=Object.prototype.hasOwnProperty;var v=(n,e)=>{for(var t in e)u(n,t,{get:e[t],enumerable:!0})},b=(n,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of M(e))!f.call(n,r)&&r!==t&&u(n,r,{get:()=>e[r],enumerable:!(o=k(e,r))||o.enumerable});return n};var B=n=>b(u({},"__esModule",{value:!0}),n);var A={};v(A,{PredictOutOfMemoryTask:()=>w});module.exports=B(A);var g=require("../../device-action/os/Errors"),y=require("../../device-session/DeviceSessionState");class w{constructor(e,t){this.api=e;this.args=t;this.deviceModel=e.getDeviceModel()}deviceModel;run(){const e=this.api.getDeviceSessionState();if(e.sessionStateType===y.DeviceSessionStateType.Connected)return{error:new g.UnknownDAError("Invalid device state")};const{firmwareUpdateContext:t,customImage:o,firmwareVersion:r,installedLanguages:a,installedApps:s}=e;if(t===void 0||o===void 0||r===void 0||a===void 0)return{error:new g.UnknownDAError("Device metadata not fetched")};const{blockSize:l,totalMemoryBlocks:c}=this.getMemoryConstants(r),m=this.getCurrentMemoryBlocksUsage({firmwareUpdateContext:t,customImage:o,installedApps:s,installedLanguages:a,blockSize:l}),p=this.getInstallPlanMemoryBlocksUsage(this.args.installPlan,l);return{outOfMemory:m+p>c}}getMemoryConstants(e){const t=this.deviceModel.getBlockSize({firmwareVersion:e.os}),o=Math.floor(this.deviceModel.memorySize/t);return{blockSize:t,totalMemoryBlocks:o}}getCurrentMemoryBlocksUsage({firmwareUpdateContext:e,customImage:t,installedApps:o,installedLanguages:r,blockSize:a}){const s=i=>Math.ceil(i/a),l=s(e.currentFirmware.bytes||0),c=s(t.size||0),m=o.reduce((i,d)=>i+s(d.bytes||0),0),p=r.reduce((i,d)=>i+s(d.size),0);return l+c+m+p}getInstallPlanMemoryBlocksUsage(e,t){const o=r=>Math.ceil(r/t);return e.reduce((r,a)=>r+o(a.bytes||0),0)}}0&&(module.exports={PredictOutOfMemoryTask});
//# sourceMappingURL=PredictOutOfMemoryTask.js.map
