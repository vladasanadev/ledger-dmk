"use strict";var D=require("../../../device-action/__test-utils__/makeInternalApi"),n=require("../../../device-action/__test-utils__/setupTestMachine"),p=require("../../../device-action/__test-utils__/testDeviceActionStates"),e=require("../../../device-action/model/DeviceActionState"),t=require("../../../device-action/model/UserInteractionRequired"),d=require("../../../device-action/os/Errors"),l=require("./OpenAppWithDependenciesDeviceAction");vi.mock("@api/device-action/os/OpenAppDeviceAction/OpenAppDeviceAction");vi.mock("@api/device-action/os/InstallOrUpdateApps/InstallOrUpdateAppsDeviceAction");vi.mock("@api/device-action/os/GetDeviceMetadata/GetDeviceMetadataDeviceAction");describe("OpenAppWithDependenciesDeviceAction",()=>{const c=(0,D.makeDeviceActionInternalApiMock)(),u={firmwareUpdateContext:{}},s={requiredUserInteraction:t.UserInteractionRequired.None,installPlan:{installPlan:[{versionName:"1inch"}],alreadyInstalled:["Ethereum","Uniswap"],missingApplications:[""],currentIndex:0,currentProgress:.5}},m={successfullyInstalled:[{versionName:"1inch"}],alreadyInstalled:["Ethereum","Uniswap"],missingApplications:[""]};beforeEach(()=>{vi.clearAllMocks()}),describe("success cases",()=>{it("Open app with dependencies",()=>new Promise((a,i)=>{(0,n.setupGetDeviceMetadataMock)(u),(0,n.setupInstallOrUpdateAppsMock)(m,s),(0,n.setupOpenAppMock)();const o=new l.OpenAppWithDependenciesDeviceAction({input:{application:{name:"Ethereum"},dependencies:[{name:"Uniswap"},{name:"1inch"}],requireLatestFirmware:!1}}),r=[{intermediateValue:{requiredUserInteraction:t.UserInteractionRequired.None,installPlan:null},status:e.DeviceActionStatus.Pending},{intermediateValue:{requiredUserInteraction:t.UserInteractionRequired.None,installPlan:null},status:e.DeviceActionStatus.Pending},{intermediateValue:{requiredUserInteraction:t.UserInteractionRequired.None,installPlan:null},status:e.DeviceActionStatus.Pending},{intermediateValue:s,status:e.DeviceActionStatus.Pending},{intermediateValue:s,status:e.DeviceActionStatus.Pending},{intermediateValue:{requiredUserInteraction:t.UserInteractionRequired.ConfirmOpenApp,installPlan:null},status:e.DeviceActionStatus.Pending},{output:{deviceMetadata:u,installResult:m},status:e.DeviceActionStatus.Completed}];(0,p.testDeviceActionStates)(o,r,c,{onDone:a,onError:i})}))}),describe("error cases",()=>{it("Get device metadata error",()=>new Promise((a,i)=>{(0,n.setupGetDeviceMetadataMock)(u,!0);const o=new l.OpenAppWithDependenciesDeviceAction({input:{application:{name:"Ethereum"},dependencies:[{name:"Uniswap"},{name:"1inch"}],requireLatestFirmware:!1}}),r=[{intermediateValue:{requiredUserInteraction:t.UserInteractionRequired.None,installPlan:null},status:e.DeviceActionStatus.Pending},{intermediateValue:{requiredUserInteraction:t.UserInteractionRequired.None,installPlan:null},status:e.DeviceActionStatus.Pending},{error:new d.UnknownDAError("GetDeviceMetadata failed"),status:e.DeviceActionStatus.Error}];(0,p.testDeviceActionStates)(o,r,c,{onDone:a,onError:i})})),it("Unsupported firmware",()=>new Promise((a,i)=>{(0,n.setupGetDeviceMetadataMock)({firmwareUpdateContext:{availableUpdate:"mockUpdate"}});const r=new l.OpenAppWithDependenciesDeviceAction({input:{application:{name:"Ethereum"},dependencies:[{name:"Uniswap"},{name:"1inch"}],requireLatestFirmware:!0}}),A=[{intermediateValue:{requiredUserInteraction:t.UserInteractionRequired.None,installPlan:null},status:e.DeviceActionStatus.Pending},{intermediateValue:{requiredUserInteraction:t.UserInteractionRequired.None,installPlan:null},status:e.DeviceActionStatus.Pending},{error:new d.UnsupportedFirmwareDAError("Firmware is not the latest version"),status:e.DeviceActionStatus.Error}];(0,p.testDeviceActionStates)(r,A,c,{onDone:a,onError:i})})),it("Install apps error",()=>new Promise((a,i)=>{(0,n.setupGetDeviceMetadataMock)({firmwareUpdateContext:{availableUpdate:"mockUpdate"}}),(0,n.setupInstallOrUpdateAppsMock)(m,s,!0);const r=new l.OpenAppWithDependenciesDeviceAction({input:{application:{name:"Ethereum"},dependencies:[{name:"Uniswap"},{name:"1inch"}],requireLatestFirmware:!1}}),A=[{intermediateValue:{requiredUserInteraction:t.UserInteractionRequired.None,installPlan:null},status:e.DeviceActionStatus.Pending},{intermediateValue:{requiredUserInteraction:t.UserInteractionRequired.None,installPlan:null},status:e.DeviceActionStatus.Pending},{intermediateValue:{requiredUserInteraction:t.UserInteractionRequired.None,installPlan:null},status:e.DeviceActionStatus.Pending},{intermediateValue:s,status:e.DeviceActionStatus.Pending},{error:new d.UnknownDAError("InstallOrUpdateApps failed"),status:e.DeviceActionStatus.Error}];(0,p.testDeviceActionStates)(r,A,c,{onDone:a,onError:i})})),it("Open app error",()=>new Promise((a,i)=>{(0,n.setupGetDeviceMetadataMock)(u),(0,n.setupInstallOrUpdateAppsMock)(m,s),(0,n.setupOpenAppMock)(!0);const o=new l.OpenAppWithDependenciesDeviceAction({input:{application:{name:"Ethereum"},dependencies:[{name:"Uniswap"},{name:"1inch"}],requireLatestFirmware:!1}}),r=[{intermediateValue:{requiredUserInteraction:t.UserInteractionRequired.None,installPlan:null},status:e.DeviceActionStatus.Pending},{intermediateValue:{requiredUserInteraction:t.UserInteractionRequired.None,installPlan:null},status:e.DeviceActionStatus.Pending},{intermediateValue:{requiredUserInteraction:t.UserInteractionRequired.None,installPlan:null},status:e.DeviceActionStatus.Pending},{intermediateValue:s,status:e.DeviceActionStatus.Pending},{intermediateValue:s,status:e.DeviceActionStatus.Pending},{intermediateValue:{requiredUserInteraction:t.UserInteractionRequired.ConfirmOpenApp,installPlan:null},status:e.DeviceActionStatus.Pending},{error:new d.UnknownDAError("OpenApp failed"),status:e.DeviceActionStatus.Error}];(0,p.testDeviceActionStates)(o,r,c,{onDone:a,onError:i})}))})});
//# sourceMappingURL=OpenAppWithDependenciesDeviceAction.test.js.map
