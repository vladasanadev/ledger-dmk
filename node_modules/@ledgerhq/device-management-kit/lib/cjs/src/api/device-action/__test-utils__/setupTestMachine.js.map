{
  "version": 3,
  "sources": ["../../../../../../src/api/device-action/__test-utils__/setupTestMachine.ts"],
  "sourcesContent": ["import { Left, Right } from \"purify-ts\";\nimport { type Mock } from \"vitest\";\nimport { assign, createMachine } from \"xstate\";\n\nimport { UserInteractionRequired } from \"@api/device-action/model/UserInteractionRequired\";\nimport { UnknownDAError } from \"@api/device-action/os/Errors\";\nimport { GetDeviceMetadataDeviceAction } from \"@api/device-action/os/GetDeviceMetadata/GetDeviceMetadataDeviceAction\";\nimport { type GetDeviceMetadataDAOutput } from \"@api/device-action/os/GetDeviceMetadata/types\";\nimport { GetDeviceStatusDeviceAction } from \"@api/device-action/os/GetDeviceStatus/GetDeviceStatusDeviceAction\";\nimport { GoToDashboardDeviceAction } from \"@api/device-action/os/GoToDashboard/GoToDashboardDeviceAction\";\nimport { InstallOrUpdateAppsDeviceAction } from \"@api/device-action/os/InstallOrUpdateApps/InstallOrUpdateAppsDeviceAction\";\nimport {\n  type InstallOrUpdateAppsDAIntermediateValue,\n  type InstallOrUpdateAppsDAOutput,\n} from \"@api/device-action/os/InstallOrUpdateApps/types\";\nimport { ListAppsDeviceAction } from \"@api/device-action/os/ListApps/ListAppsDeviceAction\";\nimport { OpenAppDeviceAction } from \"@api/device-action/os/OpenAppDeviceAction/OpenAppDeviceAction\";\nimport { type DmkError } from \"@api/Error\";\nimport { ListInstalledAppsDeviceAction } from \"@api/secure-channel/device-action/ListInstalledApps/ListInstalledAppsDeviceAction\";\nimport { type InstalledApp } from \"@api/secure-channel/device-action/ListInstalledApps/types\";\n\nimport { type BTC_APP } from \"./data\";\n\ntype App = typeof BTC_APP;\n\nexport const setupListAppsMock = (apps: App[], error = false) => {\n  (ListAppsDeviceAction as Mock).mockImplementation(() => ({\n    makeStateMachine: vi.fn().mockImplementation(() =>\n      createMachine({\n        id: \"MockListAppsDeviceAction\",\n        initial: \"ready\",\n        states: {\n          ready: {\n            after: {\n              0: \"done\",\n            },\n            entry: assign({\n              intermediateValue: () => ({\n                requiredUserInteraction: UserInteractionRequired.AllowListApps,\n              }),\n            }),\n          },\n          done: {\n            type: \"final\",\n          },\n        },\n        output: () => {\n          return error\n            ? Left(new UnknownDAError(\"ListApps failed\"))\n            : Right(apps);\n        },\n      }),\n    ),\n  }));\n};\n\nexport const setupGetDeviceMetadataMock = (\n  metadata: GetDeviceMetadataDAOutput,\n  error = false,\n) => {\n  (GetDeviceMetadataDeviceAction as Mock).mockImplementation(() => ({\n    makeStateMachine: vi.fn().mockImplementation(() =>\n      createMachine({\n        id: \"MockGetDeviceMetadataDeviceAction\",\n        initial: \"ready\",\n        states: {\n          ready: {\n            after: {\n              0: \"done\",\n            },\n            entry: assign({\n              intermediateValue: () => ({\n                requiredUserInteraction: UserInteractionRequired.None,\n              }),\n            }),\n          },\n          done: {\n            type: \"final\",\n          },\n        },\n        output: () => {\n          return error\n            ? Left(new UnknownDAError(\"GetDeviceMetadata failed\"))\n            : Right(metadata);\n        },\n      }),\n    ),\n  }));\n};\n\nexport const setupInstallOrUpdateAppsMock = (\n  result: InstallOrUpdateAppsDAOutput,\n  intermediateValue: InstallOrUpdateAppsDAIntermediateValue,\n  error = false,\n) => {\n  (InstallOrUpdateAppsDeviceAction as Mock).mockImplementation(() => ({\n    makeStateMachine: vi.fn().mockImplementation(() =>\n      createMachine({\n        id: \"MockInstallOrUpdateAppsDeviceAction\",\n        initial: \"ready\",\n        states: {\n          ready: {\n            after: {\n              0: \"done\",\n            },\n            entry: assign({\n              intermediateValue: () => intermediateValue,\n            }),\n          },\n          done: {\n            type: \"final\",\n          },\n        },\n        output: () => {\n          return error\n            ? Left(new UnknownDAError(\"InstallOrUpdateApps failed\"))\n            : Right(result);\n        },\n      }),\n    ),\n  }));\n};\n\nexport const setupOpenAppMock = (error: boolean = false) => {\n  (OpenAppDeviceAction as Mock).mockImplementation(() => ({\n    makeStateMachine: vi.fn().mockImplementation(() =>\n      createMachine({\n        initial: \"ready\",\n        states: {\n          ready: {\n            entry: assign({\n              intermediateValue: {\n                requiredUserInteraction: UserInteractionRequired.ConfirmOpenApp,\n              },\n            }),\n            after: {\n              0: \"done\",\n            },\n          },\n          done: {\n            type: \"final\",\n          },\n        },\n        output: () => {\n          return error\n            ? Left(new UnknownDAError(\"OpenApp failed\"))\n            : Right(undefined);\n        },\n      }),\n    ),\n  }));\n};\n\nexport const setupGoToDashboardMock = (error: boolean = false) => {\n  (GoToDashboardDeviceAction as Mock).mockImplementation(() => ({\n    makeStateMachine: vi.fn().mockImplementation(() =>\n      createMachine({\n        id: \"MockGoToDashboardDeviceAction\",\n        initial: \"ready\",\n        states: {\n          ready: {\n            after: {\n              0: \"done\",\n            },\n            entry: assign({\n              intermediateValue: () => ({\n                requiredUserInteraction: UserInteractionRequired.None,\n              }),\n            }),\n          },\n          done: {\n            type: \"final\",\n          },\n        },\n        output: () => {\n          return error\n            ? Left(new UnknownDAError(\"GoToDashboard failed\"))\n            : Right(undefined);\n        },\n      }),\n    ),\n  }));\n};\n\nexport const setupGetDeviceStatusMock = (\n  outputs: ReadonlyArray<\n    { currentApp: string; currentAppVersion: string } | DmkError\n  > = [\n    {\n      currentApp: \"BOLOS\",\n      currentAppVersion: \"1.0.0\",\n    },\n  ],\n) => {\n  const outputFn = vi.fn();\n\n  for (const output of outputs) {\n    outputFn.mockImplementationOnce(() =>\n      \"currentApp\" in output ? Right(output) : Left(output),\n    );\n  }\n  (GetDeviceStatusDeviceAction as Mock).mockImplementation(() => ({\n    makeStateMachine: vi.fn().mockImplementation(() =>\n      createMachine({\n        id: \"MockGetDeviceStatusDeviceAction\",\n        initial: \"ready\",\n        states: {\n          ready: {\n            after: {\n              0: \"done\",\n            },\n            entry: assign({\n              intermediateValue: () => ({\n                requiredUserInteraction: UserInteractionRequired.None,\n              }),\n            }),\n          },\n          done: {\n            type: \"final\",\n          },\n        },\n        output: outputFn,\n      }),\n    ),\n  }));\n};\n\nexport const setupListInstalledAppsMock = (\n  outputs: Array<{ installedApps: InstalledApp[] } | DmkError> = [],\n) => {\n  (ListInstalledAppsDeviceAction as Mock).mockImplementation(() => ({\n    makeStateMachine: vi.fn().mockImplementation(() =>\n      createMachine({\n        id: \"MockListInstalledAppsDeviceAction\",\n        initial: \"ready\",\n        states: {\n          ready: {\n            after: {\n              0: \"done\",\n            },\n            entry: assign({\n              intermediateValue: () => ({\n                requiredUserInteraction: UserInteractionRequired.None,\n              }),\n            }),\n          },\n          done: {\n            type: \"final\",\n          },\n        },\n        output: outputs\n          .reduce(\n            (mockFn, output) =>\n              mockFn.mockImplementationOnce(() =>\n                \"installedApps\" in output ? Right(output) : Left(output),\n              ),\n            vi.fn(),\n          )\n          .mockImplementation(() => Right([])),\n      }),\n    ),\n  }));\n};\n"],
  "mappings": "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",
  "names": ["setupTestMachine_exports", "__export", "setupGetDeviceMetadataMock", "setupGetDeviceStatusMock", "setupGoToDashboardMock", "setupInstallOrUpdateAppsMock", "setupListAppsMock", "setupListInstalledAppsMock", "setupOpenAppMock", "__toCommonJS", "import_purify_ts", "import_xstate", "import_UserInteractionRequired", "import_Errors", "import_GetDeviceMetadataDeviceAction", "import_GetDeviceStatusDeviceAction", "import_GoToDashboardDeviceAction", "import_InstallOrUpdateAppsDeviceAction", "import_ListAppsDeviceAction", "import_OpenAppDeviceAction", "import_ListInstalledAppsDeviceAction", "apps", "error", "metadata", "result", "intermediateValue", "outputs", "outputFn", "output", "mockFn"]
}
