"use strict";var d=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var R=(n,t)=>{for(var i in t)d(n,i,{get:t[i],enumerable:!0})},V=(n,t,i,p)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of L(t))!I.call(n,s)&&s!==i&&d(n,s,{get:()=>t[s],enumerable:!(p=k(t,s))||p.enumerable});return n};var F=n=>V(d({},"__esModule",{value:!0}),n);var x={};R(x,{GetApplicationsMetadataTask:()=>P});module.exports=F(x);var h=require("semver"),m=require("../../command/Errors"),r=require("../../command/model/CommandResult"),v=require("../../command/os/ListLanguagePackCommand");const M="0000000000000000000000000000000000000000000000000000000000000000";class P{constructor(t,i){this.api=t;this.args=i}async run(){const t=this.args.installedApps.filter(a=>this.isApplication(a)),i=this.api.getManagerApiService(),p=t.map(a=>a.hash),s=await i.getAppsByHash(p).chain(a=>i.getAppList(this.args.firmwareVersion.metadata).map(e=>({applications:a,catalog:e})));if(s.isLeft())return(0,r.CommandResultFactory)({error:new m.InvalidStatusWordError("Cannot get the application catalog")});const{applications:u,catalog:l}=s.unsafeCoerce(),y=u.reduce((a,e,o)=>{if(e!==null)return[...a,e];const g=t[o],f=l.find(w=>w.versionName===g.name);return f?[...a,f]:a},[]),C=u.filter(a=>a!==null).reduce((a,e)=>{const o=l.find(g=>g.versionName===e.versionName);return o&&(0,h.gt)(o.version,e.version)?[...a,o]:a},[]);let c=[];for(let a=0;;a++){const e=await this.api.sendCommand(new v.ListLanguagePackCommand({firstChunk:a===0}));if(!(0,r.isSuccessCommandResult)(e)||e.data===void 0)break;c=[...c,e.data]}const A=await i.getLanguagePackages(this.args.deviceVersion,this.args.firmware);return A.isRight()?(0,r.CommandResultFactory)({data:{applications:y,applicationsUpdates:C,installedLanguages:c,catalog:{applications:l,languagePackages:A.extract()}}}):(0,r.CommandResultFactory)({error:new m.InvalidStatusWordError("Cannot get the languages catalog")})}isApplication(t){return t.hashCode!==M}}0&&(module.exports={GetApplicationsMetadataTask});
//# sourceMappingURL=GetApplicationsMetadataTask.js.map
