{
  "version": 3,
  "sources": ["../../../../../../../src/api/device-action/os/OpenAppWithDependencies/OpenAppWithDependenciesDeviceAction.test.ts"],
  "sourcesContent": ["import { makeDeviceActionInternalApiMock } from \"@api/device-action/__test-utils__/makeInternalApi\";\nimport {\n  setupGetDeviceMetadataMock,\n  setupInstallOrUpdateAppsMock,\n  setupOpenAppMock,\n} from \"@api/device-action/__test-utils__/setupTestMachine\";\nimport { testDeviceActionStates } from \"@api/device-action/__test-utils__/testDeviceActionStates\";\nimport { DeviceActionStatus } from \"@api/device-action/model/DeviceActionState\";\nimport { UserInteractionRequired } from \"@api/device-action/model/UserInteractionRequired\";\nimport {\n  UnknownDAError,\n  UnsupportedFirmwareDAError,\n} from \"@api/device-action/os/Errors\";\nimport type { GetDeviceMetadataDAOutput } from \"@api/device-action/os/GetDeviceMetadata/types\";\nimport type { InstallOrUpdateAppsDAIntermediateValue } from \"@api/device-action/os/InstallOrUpdateApps/types\";\nimport type { Application } from \"@internal/manager-api/model/Application\";\n\nimport { OpenAppWithDependenciesDeviceAction } from \"./OpenAppWithDependenciesDeviceAction\";\nimport type { OpenAppWithDependenciesDAState } from \"./types\";\n\nvi.mock(\"@api/device-action/os/OpenAppDeviceAction/OpenAppDeviceAction\");\nvi.mock(\n  \"@api/device-action/os/InstallOrUpdateApps/InstallOrUpdateAppsDeviceAction\",\n);\nvi.mock(\n  \"@api/device-action/os/GetDeviceMetadata/GetDeviceMetadataDeviceAction\",\n);\n\ndescribe(\"OpenAppWithDependenciesDeviceAction\", () => {\n  const apiMock = makeDeviceActionInternalApiMock();\n\n  const DEVICE_METADATA = {\n    firmwareUpdateContext: {},\n  } as unknown as GetDeviceMetadataDAOutput;\n\n  const INSTALL_INTERMEDIATE_VALUE: InstallOrUpdateAppsDAIntermediateValue = {\n    requiredUserInteraction: UserInteractionRequired.None,\n    installPlan: {\n      installPlan: [{ versionName: \"1inch\" }] as unknown as Application[],\n      alreadyInstalled: [\"Ethereum\", \"Uniswap\"],\n      missingApplications: [\"\"],\n      currentIndex: 0,\n      currentProgress: 0.5,\n    },\n  };\n\n  const INSTALL_RESULT = {\n    successfullyInstalled: [\n      { versionName: \"1inch\" },\n    ] as unknown as Application[],\n    alreadyInstalled: [\"Ethereum\", \"Uniswap\"],\n    missingApplications: [\"\"],\n  };\n\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  describe(\"success cases\", () => {\n    it(\"Open app with dependencies\", () =>\n      new Promise<void>((resolve, reject) => {\n        setupGetDeviceMetadataMock(DEVICE_METADATA);\n        setupInstallOrUpdateAppsMock(\n          INSTALL_RESULT,\n          INSTALL_INTERMEDIATE_VALUE,\n        );\n        setupOpenAppMock();\n        const deviceAction = new OpenAppWithDependenciesDeviceAction({\n          input: {\n            application: { name: \"Ethereum\" },\n            dependencies: [{ name: \"Uniswap\" }, { name: \"1inch\" }],\n            requireLatestFirmware: false,\n          },\n        });\n\n        const expectedStates: Array<OpenAppWithDependenciesDAState> = [\n          // GetDeviceMetadata\n          {\n            intermediateValue: {\n              requiredUserInteraction: UserInteractionRequired.None,\n              installPlan: null,\n            },\n            status: DeviceActionStatus.Pending,\n          },\n          {\n            intermediateValue: {\n              requiredUserInteraction: UserInteractionRequired.None,\n              installPlan: null,\n            },\n            status: DeviceActionStatus.Pending,\n          },\n          // InstallOrUpdateApps\n          {\n            intermediateValue: {\n              requiredUserInteraction: UserInteractionRequired.None,\n              installPlan: null,\n            },\n            status: DeviceActionStatus.Pending,\n          },\n          {\n            intermediateValue: INSTALL_INTERMEDIATE_VALUE,\n            status: DeviceActionStatus.Pending,\n          },\n          // OpenApp\n          {\n            intermediateValue: INSTALL_INTERMEDIATE_VALUE,\n            status: DeviceActionStatus.Pending,\n          },\n          {\n            intermediateValue: {\n              requiredUserInteraction: UserInteractionRequired.ConfirmOpenApp,\n              installPlan: null,\n            },\n            status: DeviceActionStatus.Pending,\n          },\n          // Success\n          {\n            output: {\n              deviceMetadata: DEVICE_METADATA,\n              installResult: INSTALL_RESULT,\n            },\n            status: DeviceActionStatus.Completed,\n          },\n        ];\n\n        testDeviceActionStates(deviceAction, expectedStates, apiMock, {\n          onDone: resolve,\n          onError: reject,\n        });\n      }));\n  });\n\n  describe(\"error cases\", () => {\n    it(\"Get device metadata error\", () =>\n      new Promise<void>((resolve, reject) => {\n        setupGetDeviceMetadataMock(DEVICE_METADATA, true);\n        const deviceAction = new OpenAppWithDependenciesDeviceAction({\n          input: {\n            application: { name: \"Ethereum\" },\n            dependencies: [{ name: \"Uniswap\" }, { name: \"1inch\" }],\n            requireLatestFirmware: false,\n          },\n        });\n\n        const expectedStates: Array<OpenAppWithDependenciesDAState> = [\n          // GetDeviceMetadata\n          {\n            intermediateValue: {\n              requiredUserInteraction: UserInteractionRequired.None,\n              installPlan: null,\n            },\n            status: DeviceActionStatus.Pending,\n          },\n          {\n            intermediateValue: {\n              requiredUserInteraction: UserInteractionRequired.None,\n              installPlan: null,\n            },\n            status: DeviceActionStatus.Pending,\n          },\n          // Error\n          {\n            error: new UnknownDAError(\"GetDeviceMetadata failed\"),\n            status: DeviceActionStatus.Error,\n          },\n        ];\n\n        testDeviceActionStates(deviceAction, expectedStates, apiMock, {\n          onDone: resolve,\n          onError: reject,\n        });\n      }));\n\n    it(\"Unsupported firmware\", () =>\n      new Promise<void>((resolve, reject) => {\n        const metadataWithUpdate = {\n          firmwareUpdateContext: {\n            availableUpdate: \"mockUpdate\",\n          },\n        } as unknown as GetDeviceMetadataDAOutput;\n        setupGetDeviceMetadataMock(metadataWithUpdate);\n        const deviceAction = new OpenAppWithDependenciesDeviceAction({\n          input: {\n            application: { name: \"Ethereum\" },\n            dependencies: [{ name: \"Uniswap\" }, { name: \"1inch\" }],\n            requireLatestFirmware: true,\n          },\n        });\n\n        const expectedStates: Array<OpenAppWithDependenciesDAState> = [\n          // GetDeviceMetadata\n          {\n            intermediateValue: {\n              requiredUserInteraction: UserInteractionRequired.None,\n              installPlan: null,\n            },\n            status: DeviceActionStatus.Pending,\n          },\n          {\n            intermediateValue: {\n              requiredUserInteraction: UserInteractionRequired.None,\n              installPlan: null,\n            },\n            status: DeviceActionStatus.Pending,\n          },\n          // Error\n          {\n            error: new UnsupportedFirmwareDAError(\n              \"Firmware is not the latest version\",\n            ),\n            status: DeviceActionStatus.Error,\n          },\n        ];\n\n        testDeviceActionStates(deviceAction, expectedStates, apiMock, {\n          onDone: resolve,\n          onError: reject,\n        });\n      }));\n\n    it(\"Install apps error\", () =>\n      new Promise<void>((resolve, reject) => {\n        const metadataWithUpdate = {\n          firmwareUpdateContext: {\n            availableUpdate: \"mockUpdate\",\n          },\n        } as unknown as GetDeviceMetadataDAOutput;\n        setupGetDeviceMetadataMock(metadataWithUpdate);\n        setupInstallOrUpdateAppsMock(\n          INSTALL_RESULT,\n          INSTALL_INTERMEDIATE_VALUE,\n          true,\n        );\n        const deviceAction = new OpenAppWithDependenciesDeviceAction({\n          input: {\n            application: { name: \"Ethereum\" },\n            dependencies: [{ name: \"Uniswap\" }, { name: \"1inch\" }],\n            requireLatestFirmware: false,\n          },\n        });\n\n        const expectedStates: Array<OpenAppWithDependenciesDAState> = [\n          // GetDeviceMetadata\n          {\n            intermediateValue: {\n              requiredUserInteraction: UserInteractionRequired.None,\n              installPlan: null,\n            },\n            status: DeviceActionStatus.Pending,\n          },\n          {\n            intermediateValue: {\n              requiredUserInteraction: UserInteractionRequired.None,\n              installPlan: null,\n            },\n            status: DeviceActionStatus.Pending,\n          },\n          // InstallOrUpdateApps\n          {\n            intermediateValue: {\n              requiredUserInteraction: UserInteractionRequired.None,\n              installPlan: null,\n            },\n            status: DeviceActionStatus.Pending,\n          },\n          {\n            intermediateValue: INSTALL_INTERMEDIATE_VALUE,\n            status: DeviceActionStatus.Pending,\n          },\n          // Error\n          {\n            error: new UnknownDAError(\"InstallOrUpdateApps failed\"),\n            status: DeviceActionStatus.Error,\n          },\n        ];\n\n        testDeviceActionStates(deviceAction, expectedStates, apiMock, {\n          onDone: resolve,\n          onError: reject,\n        });\n      }));\n\n    it(\"Open app error\", () =>\n      new Promise<void>((resolve, reject) => {\n        setupGetDeviceMetadataMock(DEVICE_METADATA);\n        setupInstallOrUpdateAppsMock(\n          INSTALL_RESULT,\n          INSTALL_INTERMEDIATE_VALUE,\n        );\n        setupOpenAppMock(true);\n        const deviceAction = new OpenAppWithDependenciesDeviceAction({\n          input: {\n            application: { name: \"Ethereum\" },\n            dependencies: [{ name: \"Uniswap\" }, { name: \"1inch\" }],\n            requireLatestFirmware: false,\n          },\n        });\n\n        const expectedStates: Array<OpenAppWithDependenciesDAState> = [\n          // GetDeviceMetadata\n          {\n            intermediateValue: {\n              requiredUserInteraction: UserInteractionRequired.None,\n              installPlan: null,\n            },\n            status: DeviceActionStatus.Pending,\n          },\n          {\n            intermediateValue: {\n              requiredUserInteraction: UserInteractionRequired.None,\n              installPlan: null,\n            },\n            status: DeviceActionStatus.Pending,\n          },\n          // InstallOrUpdateApps\n          {\n            intermediateValue: {\n              requiredUserInteraction: UserInteractionRequired.None,\n              installPlan: null,\n            },\n            status: DeviceActionStatus.Pending,\n          },\n          {\n            intermediateValue: INSTALL_INTERMEDIATE_VALUE,\n            status: DeviceActionStatus.Pending,\n          },\n          // OpenApp\n          {\n            intermediateValue: INSTALL_INTERMEDIATE_VALUE,\n            status: DeviceActionStatus.Pending,\n          },\n          {\n            intermediateValue: {\n              requiredUserInteraction: UserInteractionRequired.ConfirmOpenApp,\n              installPlan: null,\n            },\n            status: DeviceActionStatus.Pending,\n          },\n          // Error\n          {\n            error: new UnknownDAError(\"OpenApp failed\"),\n            status: DeviceActionStatus.Error,\n          },\n        ];\n\n        testDeviceActionStates(deviceAction, expectedStates, apiMock, {\n          onDone: resolve,\n          onError: reject,\n        });\n      }));\n  });\n});\n"],
  "mappings": "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",
  "names": ["import_makeInternalApi", "import_setupTestMachine", "import_testDeviceActionStates", "import_DeviceActionState", "import_UserInteractionRequired", "import_Errors", "import_OpenAppWithDependenciesDeviceAction", "apiMock", "DEVICE_METADATA", "INSTALL_INTERMEDIATE_VALUE", "INSTALL_RESULT", "resolve", "reject", "deviceAction", "expectedStates"]
}
